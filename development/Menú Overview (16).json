{
  "name": "Men√∫ Overview",
  "nodes": [
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2006573822,
          "mode": "list",
          "cachedResultName": "USUARIOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=2006573822"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2048,
        6576
      ],
      "id": "e39b12a0-058f-4086-917b-ccb683205f55",
      "name": "verificar_usuario",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -2272,
        6576
      ],
      "id": "a056b38b-2f88-4416-89f4-a747ec7b9e9e",
      "name": "Telegram Trigger1",
      "webhookId": "b9545048-0e69-4262-a3bf-ea600b19fb38",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1600,
        6576
      ],
      "id": "2ee9ad71-79c9-4db2-86ff-c175fa364de8",
      "name": "verificar_sesi√≥n",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "3dc0d987-8bed-4e00-aa71-d5f8a79c1cd0",
              "leftValue": "={{ $json[\"permitido\"] }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -1824,
        6576
      ],
      "id": "e92080df-d6c2-454d-a747-9b9b1a8962c7",
      "name": "IF_usuario_existe"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "65b059c5-adb9-4fa8-b3a7-781da7836ce6",
              "leftValue": "={{ $json.pantalla_actual }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -1376,
        6576
      ],
      "id": "a7bd6b06-9462-4ae7-acb4-2564c0c3558f",
      "name": "IF_sesion_iniciada"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_PRINCIPAL",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f3f4f434-051e-44c0-8efc-a4999d4e9480"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "2b381b4c-36e3-43b7-a1e6-85fdc2cab3f7",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "AGENDAR",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4bc74d3f-e04d-4ba8-9ea2-b5c552e58045",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "VER_TAREAS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "c2c1da07-4dec-40ba-b975-8136a3d1716c",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_CITAS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5fe7b320-8cd9-4a51-a352-8e9597ae88d6",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "CONFIRMACION_CITA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "3036d160-6de1-42bf-9fab-2ec09275ba88",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_EDITAR",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "2b4b63cb-c605-4e31-928f-9c2ac0eb4bda",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "EDITAR_FECHA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f402180b-d94f-4ccf-944b-b7ed7af32094",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "EDITAR_NOMBRE",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "0bc45694-e9b0-47bf-977f-0f96875fe1d7",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "EDITAR_HORA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "2d3b638b-f9f4-4afc-8cc9-4bc37c907729",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "EDITAR_MOTIVO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "6cd9ea69-7844-440c-80c2-410ae0acf72a",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "EDITAR_CANAL",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "00ceec0c-d319-4ab9-8370-44251b5c6d05",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "REPROGRAMAR_ESPERAR_ID",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "3f79320d-4e00-4702-b9a4-2dd5cc8918e8",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "REPROGRAMAR_FECHA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "82494dc6-c6e0-41cc-a649-5cb6ac55d6eb",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "REPROGRAMAR_HORA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "dd1ab552-b179-421e-8dc1-2c21d6d7927e",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "CANCELAR_ESPERAR_ID",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "9b801476-b0c3-4ad0-8adc-a6614f99e7dc",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "COMPLETAR_ESPERAR_ID",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b677689b-5a9f-4903-82c3-7df31b4d1481",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_CONFIGURACION",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "11e32e75-854d-49ed-b1d7-0c4514db52b9",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_ADMIN",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "498d9634-699d-49e5-b15f-765b8b30cb99",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "ADMIN_BROADCAST",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "945cbe81-f3ed-4902-aa28-6f16a3c87e20",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "ADMIN_BROADCAST_CONFIRMAR",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "853c6c63-8af7-4cc7-a5ad-82a3925d3d97",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "VERIFICACION",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -928,
        6256
      ],
      "id": "7d71e45b-efad-4d4c-8112-79b67f26f175",
      "name": "CEREBRO_PRINCIPAL"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "0",
            "timestamp_ultima_interaccion": "={{$now}}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1152,
        6504
      ],
      "id": "a9f30d7a-e26f-4cf8-ab51-50380ef6e61c",
      "name": "Append_session",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        2352
      ],
      "id": "c6fa687e-df59-4bc0-a01d-72cc01db3265",
      "name": "Menu Principal",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "Men√∫ de administrador üîê\n\n¬øQu√© deseas hacer?\n\n1. Ver usuarios registrados\n\n2. Autorizar usuario\n\n3. Bloquear usuario\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nUsa estas opciones con cuidado üòâ",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2272,
        13136
      ],
      "id": "bf6eaa85-052d-450c-a9c2-e9f786aa1686",
      "name": "Men√∫ Admin",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "Aqu√≠ tienes tus reportes üìä\n\n¬øQu√© deseas hacer?\n\n1. Ver resumen de hoy\n\n2. Ver resumen semanal\n\n3. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Resumen de hoy).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2272,
        -336
      ],
      "id": "cdc2c437-128e-4dae-ae0d-1a312abbd63e",
      "name": "Men√∫ Reportes",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "Perfecto üòä vamos con tus listas üóÇÔ∏è\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva lista\n\n2. Ver mis listas\n\n3. Agregar √≠tems a una lista\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva lista).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2272,
        -560
      ],
      "id": "9efb5532-e262-479f-b51b-e05d4bc30010",
      "name": "Men√∫ Listas",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "Genial üòä vamos con tus h√°bitos üîÅ\n\n¬øQu√© deseas hacer?\n\n1. Crear un nuevo h√°bito\n\n2. Ver mis h√°bitos\n\n3. Activar / desactivar un h√°bito\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear un nuevo h√°bito).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2272,
        -784
      ],
      "id": "f75ec8fd-6e48-444c-8f36-90820567b1ba",
      "name": "Men√∫ Habitos",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "Perfecto, vamos con tus tareas üìù\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva tarea\n\n2. Ver mis tareas\n\n3. Cambiar estado de una tarea\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva tarea).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2272,
        -1008
      ],
      "id": "d44c2fe7-3d73-4c2e-9d28-cbe1072946d5",
      "name": "Men√∫ Tareas",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "=¬°Listo! üéâ  Tu cita qued√≥ agendada correctamente.\nID de la cita: {{id_cita?id_cita:\"\"}}\n\n¬øQu√© deseas hacer ahora?\n  1. Volver a Agenda\n  2. Ir al men√∫ principal\n\nüí° Sugerencia: Te recomiendo 1 (Volver a Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2272,
        -1456
      ],
      "id": "6d639ccd-8cbb-4c0a-9cf6-4a83ec9f3ff9",
      "name": "Send a text message",
      "webhookId": "4cb527ae-9929-496d-806e-afea0d9b0a77",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=Ups üò¨ ya tienes una cita agendada\nen esa misma fecha y hora.\n\nPor favor escribe otra hora.\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        640,
        720
      ],
      "id": "5f76ddd1-7515-4549-8830-b13b06ba4375",
      "name": "Error Doble Reserva",
      "webhookId": "a60929b2-6f11-4032-926d-05a0c072384d",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ $json.canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        416,
        1776
      ],
      "id": "6ee25806-3e74-4c3d-94e8-5f7570f65263",
      "name": "Agendar Cita Paso 6 Confirmar",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Perfecto üòä\n\nPaso 5 de 6 ‚Äî Canal\n\n¬øC√≥mo ser√° la atenci√≥n?\n\n1. Presencial\n\n2. Virtual\n\n3. Llamada\n\n4. Cancelar\n\nüí° Sugerencia:\nNormalmente se usa 2 (Virtual).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        1392
      ],
      "id": "6ab4a40e-0979-4e43-ab3d-51e34bf494b5",
      "name": "Agendar Cita Paso 5",
      "webhookId": "68cb4abc-ec1d-4a8a-953b-da48a167af0b",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Muy bien üëç\n\nPaso 4 de 6 ‚Äî Motivo\n\nCu√©ntame brevemente el motivo de la cita.\n\nEjemplo: Asesor√≠a t√©cnica\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        1200
      ],
      "id": "84509979-0650-47b4-840b-2534422d09bb",
      "name": "Agendar Cita Paso 4",
      "webhookId": "68cb4abc-ec1d-4a8a-953b-da48a167af0b",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "Genial üòä\n\nPaso 3 de 6 ‚Äî Nombre\n\n¬øA nombre de qui√©n es la cita?\n\nEscribe el nombre completo.\n\nEjemplo: Pedro G√≥mez\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        864,
        912
      ],
      "id": "4e83067e-5a8d-4460-aaa4-017de0cf13db",
      "name": "Agendar Cita Paso 3",
      "webhookId": "68cb4abc-ec1d-4a8a-953b-da48a167af0b",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la hora no tiene un formato v√°lido.\n\nRecuerda usar formato 24 horas:\nHH:MM\n\nEjemplo: 14:30\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        1008
      ],
      "id": "ebe59dfa-7a98-4d16-a41b-8959fd805420",
      "name": "Hora Invalida",
      "webhookId": "89a3d27f-d5de-425c-8c71-1bdf700a711e",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Perfecto üëç\n\nPaso 2 de 6 ‚Äî Hora\n\n¬øA qu√© hora ser√° la cita?\n\nFormato 24 horas: HH:MM\nEjemplo: 14:30\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        416,
        336
      ],
      "id": "1e5a34a6-d4f2-42a3-af46-0c8023bccaa4",
      "name": "Agendar Cita Paso 2",
      "webhookId": "51955384-d352-46f0-a7db-4ba879bc682f",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Hmm ü§î esa fecha ya pas√≥.\n\nPor favor ingresa una fecha futura.\n\nEjemplo: 2026-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        192,
        528
      ],
      "id": "e00cfa27-e1e9-46b5-952d-43ada092c85f",
      "name": "Fecha en el pasado",
      "webhookId": "431e9db7-ea8c-443c-bb82-65fa90992bd9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la fecha no tiene el formato correcto.\n\nRecuerda usar: YYYY-MM-DD\nEjemplo: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        624
      ],
      "id": "023397dc-6a49-4587-bbc4-d3fad26f0416",
      "name": "Fecha Invalida",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Perfecto, vamos con tu agenda üìÖ\n\n¬øQu√© deseas hacer?\n\n1. Agendar una nueva cita\n\n2. Consultar tu agenda\n\n3. Reprogramar una cita\n\n4. Cancelar una cita\n\n5. Marcar una cita como completada\n\n6. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo la opci√≥n 1 (Agendar una nueva cita).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        2160
      ],
      "id": "f37a6be8-ebb2-48ce-8141-db9aeaa78289",
      "name": "Men√∫ Agenda",
      "webhookId": "95c2e7db-d561-4644-9f1a-dfd17f305b61",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "Claro, te ayudo üòä\n\nSoy AgendaBot y puedo ayudarte a:\n\n- Agendar y gestionar citas\n\n- Crear y organizar tareas\n\n- Llevar recordatorios\n\n- Registrar h√°bitos\n\n- Crear listas personalizadas\n\nPara usarme, solo escribe el n√∫mero de la opci√≥n que quieras.\n\n¬øQu√© deseas hacer ahora?\n\n1. Ir al men√∫ principal\n\n2. Salir\n\nüí° Sugerencia:\nTe recomiendo ir al men√∫ principal (1) para empezar.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2272,
        -1232
      ],
      "id": "5db7c55b-3988-4528-b8a3-02fcada21784",
      "name": "Men√∫ Ayuda",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups, esa opci√≥n no existe en este men√∫ üòÖ\n\nPor favor escribe uno de los n√∫meros que ves en pantalla.\n\nEst√°s en: {{ $json.pantalla_actual }}\nOpciones disponibles: 0 al 8\n\nüëâ Tip: escribe solo el n√∫mero (por ejemplo: 1).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -704,
        9088
      ],
      "id": "a6085c90-a4ad-4f48-bd20-526dea486712",
      "name": "Opci√≥n No Valida",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "2",
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  try {\n    data = $json[\"datos_parciales\"] ? JSON.parse($json[\"datos_parciales\"]) : {};\n  } catch (e) {\n    data = {};\n  }\n\n  const mensaje = $('Telegram Trigger1').item.json.message.text;\n\n  data.fecha = mensaje;\n\n  return JSON.stringify(data);\n})()\n}}",
            "pantalla_actual": "=AGENDAR"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        192,
        336
      ],
      "id": "43234e30-6168-4471-9055-c6d6d2b1e770",
      "name": "Agendar_paso_1",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        336
      ],
      "id": "74c246d4-0ce9-4381-9285-fd31c33f519e",
      "name": "Cancelar_agendamiento",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  \n  // 1. RESCATAR: Leemos la sesi√≥n desde el nodo seguro (verificar_sesi√≥n)\n  // As√≠ no importa si venimos de un IF, un Code o un Filter.\n  try {\n    // Aseg√∫rate de que 'verificar_sesi√≥n' sea el nombre de tu nodo verde\n    const rawData = $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"];\n    data = rawData ? JSON.parse(rawData) : {};\n  } catch (e) {\n    data = {};\n  }\n\n  // 2. AGREGAR: Leemos la hora usando la referencia absoluta al Trigger\n  // Usamos $node[\"Nombre\"] en vez de $('Nombre').item para evitar errores\n  const horaTelegram = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n\n  data.hora = horaTelegram;\n\n  // 3. RETORNAR\n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
            "paso_actual": "3"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        640,
        912
      ],
      "id": "3d2348cd-0914-412e-aea3-11aef588c190",
      "name": "Agendar_paso_2",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  try {\n    data = $json[\"datos_parciales\"] ? JSON.parse($json[\"datos_parciales\"]) : {};\n  } catch (e) {\n    data = {};\n  }\n\n  const mensaje = $('Telegram Trigger1').item.json.message.text;\n\n  data.nombre = mensaje;\n\n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "4"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -256,
        1200
      ],
      "id": "111a4219-cffb-4c5d-936e-05510e3f00d2",
      "name": "Agendar_paso_3",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  try {\n    data = $json[\"datos_parciales\"] ? JSON.parse($json[\"datos_parciales\"]) : {};\n  } catch (e) {\n    data = {};\n  }\n\n  const mensaje = $('Telegram Trigger1').item.json.message.text;\n\n  data.motivo = mensaje;\n\n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "5"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -256,
        1392
      ],
      "id": "ab6122d8-1fce-4129-865c-23f3e982147f",
      "name": "Agendar_paso_4",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json[\"paso_actual\"].toString() }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "27c28973-9ef6-49bf-8f43-efd8ee1d30b2"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "bc90d83a-3bca-4d2e-8b84-dd245e0fcf5e",
                    "leftValue": "={{ $json[\"paso_actual\"].toString() }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "06e2a91d-cba1-4a92-8f1a-f8c3d73b9b17",
                    "leftValue": "={{ $json[\"paso_actual\"].toString() }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ad24f2c7-509e-449d-8cc3-c3ae986befca",
                    "leftValue": "={{ $json[\"paso_actual\"].toString() }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "36ef200f-aac4-4028-9ac9-bcb26be001a6",
                    "leftValue": "={{ $json[\"paso_actual\"].toString() }}",
                    "rightValue": "5",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -480,
        1152
      ],
      "id": "aafebb0b-c727-4086-abec-86d7cb5437d7",
      "name": "Monitor_edici√≥n"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  // Intentamos leer lo que hay. Si est√° vac√≠o o da error, iniciamos vacio.\n  try {\n    data = JSON.parse($json[\"datos_parciales\"]);\n  } catch (e) {\n    data = {};\n  }\n  \n  // AQU√ç AGREGAMOS EL DATO NUEVO (Cambia 'fecha' seg√∫n el nodo)\n  data.canal = \"presencial\"\n  \n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "",
            "pantalla_actual": "VERIFICACION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -32,
        1584
      ],
      "id": "7558de93-fd1b-46e5-8c74-bd8e84578780",
      "name": "Agendar_paso_5 (presencial)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  // Intentamos leer lo que hay. Si est√° vac√≠o o da error, iniciamos vacio.\n  try {\n    data = JSON.parse($json[\"datos_parciales\"]);\n  } catch (e) {\n    data = {};\n  }\n  \n  // AQU√ç AGREGAMOS EL DATO NUEVO (Cambia 'fecha' seg√∫n el nodo)\n  data.canal = \"virtual\";\n  \n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "",
            "pantalla_actual": "VERIFICACION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -32,
        1776
      ],
      "id": "5866db75-4f3d-4bbb-aba8-35d7234225a3",
      "name": "Agendar_paso_5 (virtual)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  // Intentamos leer lo que hay. Si est√° vac√≠o o da error, iniciamos vacio.\n  try {\n    data = JSON.parse($json[\"datos_parciales\"]);\n  } catch (e) {\n    data = {};\n  }\n  \n  // AQU√ç AGREGAMOS EL DATO NUEVO (Cambia 'fecha' seg√∫n el nodo)\n  data.canal = \"llamada\";\n  \n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "",
            "pantalla_actual": "VERIFICACION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -32,
        1968
      ],
      "id": "47e10978-e8ed-43d9-b693-44fb5316e030",
      "name": "Agendar_paso_5 (llamada)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Hola, soy AgendaBot üëã\n\nEstoy aqu√≠ para ayudarte a organizar tus citas, tareas y recordatorios\nde forma sencilla y sin complicaciones.\n\nPuedes escribirme en cualquier momento.\nPara avanzar, solo tienes que escribir el n√∫mero de la opci√≥n que quieras usar.\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nTip r√°pido:\nescribe solo el n√∫mero (por ejemplo: 1) y presiona enviar.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        2352
      ],
      "id": "885f3444-e595-41fd-a52c-9101281f612b",
      "name": "Bienvenida",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "9cc5a521-6683-43af-a5e1-802bd6b92274",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -704,
        720
      ],
      "id": "8f9f21a1-02e2-409d-9ed5-e404b56a0412",
      "name": "IF_cancelar_agendamiento"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (presencial)\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        192,
        1584
      ],
      "id": "b8438568-51b9-4fa6-98da-3585277a6cfe",
      "name": "field_presencial"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (virtual)\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        192,
        1776
      ],
      "id": "df6aaaf2-bd2b-4469-aa09-aed17468720b",
      "name": "field_virtual"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (llamada)\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        192,
        1968
      ],
      "id": "71a5db4e-0076-41be-b7a3-a0094822e7c3",
      "name": "field_llamada"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cita": "={{ 'CITA-' + $now.format('yyyyMMddHHmmss') }}",
            "fecha": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).fecha }}",
            "hora": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).hora }}",
            "nombre": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).nombre }}",
            "motivo": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).motivo }}",
            "creado_por": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}",
            "timestamp_creacion": "={{$now}}",
            "estado": "Pendiente",
            "canal": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).canal }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        9744
      ],
      "id": "1370f0cd-d7b7-4459-9128-9227b1443945",
      "name": "Append_cita",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "eb38a67e-f4fe-4761-b573-11dc55c8e227",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "={{ \"1\" }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -480,
        2256
      ],
      "id": "b854033d-1b98-49c1-9b01-ba9a620e4aa4",
      "name": "IF_agendar_cita"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Empecemos a crear tu cita üòä\n\nPaso 1 de 6 ‚Äî Fecha\n\n¬øCu√°l es la fecha de la cita?\n\nFormato: YYYY-MM-DD\nEjemplo: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2272,
        -112
      ],
      "id": "e41279ac-0176-4d37-8411-4f104bc9813d",
      "name": "Agendar Cita Paso 1",
      "webhookId": "40f5c2e5-ba01-4e1d-8e67-331e88961fc0",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CITAS",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -256,
        2160
      ],
      "id": "01b1bb00-b21f-4680-a518-d30d1657abea",
      "name": "Actualizar_estado (MENU_CITAS)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "4cbc81a2-8cf4-405f-9e1c-0061a99bcafe"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8af760ed-a14c-48e3-815f-7750da444a02",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8aee58a1-a925-4798-ab0a-3bbd70e9b5cb",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d5478f88-f019-4760-899e-5aca37f0901d",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"4\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "562ad6ff-08b0-4905-b876-4875ba64a11c",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"5\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4f6bc30e-1d43-4e8b-97c6-11d3b1364835",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"6\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -704,
        11392
      ],
      "id": "e75094ae-6727-4319-9820-13a3cbe24321",
      "name": "Switch_MENU_CITAS"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "AGENDAR",
            "paso_actual": "1"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        10512
      ],
      "id": "2c545865-587b-43d8-b810-ccb5651e14b2",
      "name": "Actualizar_estado (AGENDAR)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "AGENDAR",
            "paso_actual": "1"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        12048
      ],
      "id": "99b9ef9e-f672-4463-b3dc-cbd287afeb4b",
      "name": "Actualizar_estado (MENU_PRINCIPAL) /SWITCH MENU_CITAS",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups, esa opci√≥n no existe en este men√∫ üòÖ\n\nPor favor escribe uno de los n√∫meros que ves en pantalla.\n\nEst√°s en: {{pantalla_actual != null ? pantalla_actual:\"\"}}\nOpciones disponibles: {{rango_opciones != null ? rango_opciones:\"\"}}\n\nüëâ Tip: escribe solo el n√∫mero (por ejemplo: 1).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2272,
        112
      ],
      "id": "795ffdd4-5b6c-4f40-b2d6-d552c08b115c",
      "name": "Opci√≥n No Valida2",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Operaci√≥n cancelada. Est√°s en el men√∫ principal.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        336
      ],
      "id": "f26051f9-9452-4f05-9603-64a9d83990be",
      "name": "Cancelar_agendamiento_message",
      "webhookId": "51955384-d352-46f0-a7db-4ba879bc682f",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Empecemos a crear tu cita üòä\n\nPaso 1 de 6 ‚Äî Fecha\n\n¬øCu√°l es la fecha de la cita?\n\nFormato: YYYY-MM-DD\nEjemplo: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        10512
      ],
      "id": "c12b9cbe-70f9-4770-b1d8-206dc32d29b3",
      "name": "Agendar Cita Paso inicial",
      "webhookId": "51955384-d352-46f0-a7db-4ba879bc682f",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=¬°Listo! Tu cita qued√≥ agendada correctamente.\n\nID de la cita: {{ $('Append_cita').item.json.id_cita }}\n\n¬øQu√© deseas hacer ahora?\n1. Volver a Agenda\n2. Ir al men√∫ principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        9744
      ],
      "id": "a0a329e2-f3c4-4de8-9990-7b83ea88cf31",
      "name": "Mensaje_registro_exitoso",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "a7189d17-b037-404f-baf4-24eed23819e6"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "41448d46-c520-42a0-9394-a4ef6269320b",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "746bee75-46a6-4597-a700-00477ecf3b07",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -256,
        1784
      ],
      "id": "d877bcc3-9ef1-47af-b694-36664c0c9587",
      "name": "Switch_tipo_canal"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{\"1\"}}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "93dabcdb-4b32-4dd8-8c73-731828d793d3"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f315a1ec-da4f-4a2f-b6e1-75159a79e01a",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f4d361a8-4163-4764-8739-d51cebd886b3",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{\"3\"}}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -704,
        9856
      ],
      "id": "f9ae45f8-e8e3-45ce-8ae6-de4d2d7b69cc",
      "name": "Switch_edicion_creaci√≥n"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "689583d8-cb58-4338-9cde-e5c1a6e78c8d"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8bf08cda-2e27-42c1-baff-56c13179eb64",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -704,
        10256
      ],
      "id": "0ef507ad-d817-4bbd-a17a-01a9ad676277",
      "name": "Switch_CONFIRMACION_CITA"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CITAS",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        10128
      ],
      "id": "dab7e8e9-c2f4-4a00-8874-53c32170e339",
      "name": "Actualizar_estado (volver MENU_CITAS)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        10320
      ],
      "id": "9cbbdc17-e45f-4666-b2c1-05534b61f85a",
      "name": "Actualizar_estado (volver MENU_PRINCIPAL)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Perfecto, vamos con tu agenda üìÖ\n\n¬øQu√© deseas hacer?\n\n1. Agendar una nueva cita\n\n2. Consultar tu agenda\n\n3. Reprogramar una cita\n\n4. Cancelar una cita\n\n5. Marcar una cita como completada\n\n6. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo la opci√≥n 1 (Agendar una nueva cita).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        10128
      ],
      "id": "2370d246-2265-445c-a751-c2e260368f87",
      "name": "Mostrar_Menu_agenda",
      "webhookId": "95c2e7db-d561-4644-9f1a-dfd17f305b61",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        10320
      ],
      "id": "4a23b3ba-986c-4e12-adc6-b0d6673132b8",
      "name": "Mostrar_menu_principal",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "CONFIRMACION_CITA",
            "paso_actual": "0",
            "datos_parciales": ""
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -256,
        9744
      ],
      "id": "9dfe8682-f7b7-4b35-8881-23ef46e9df6c",
      "name": "Actualizar_estado (CONFIRMACION_CITA)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=‚úèÔ∏è *Modo Edici√≥n*\n\n¬øQu√© dato quieres corregir?\n\n1. Nombre\n2. Fecha\n3. Hora\n4. Motivo\n5. Canal\n6. üîô Volver sin cambios",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        9936
      ],
      "id": "310e8c5e-9b92-48ad-ae49-bd3d626b440c",
      "name": "Mensaje_edicion_cita",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "28f0bbc3-8195-4dbd-85cb-dd11c85789a3"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e8f021de-f6d2-4c70-9231-5194c2f1da57",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5215c1bb-1f54-4b04-95a1-21469533279f",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "c9e79605-7c9c-4b8b-a37d-2923bf6a3291",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"4\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "eb617738-ec83-4d86-87ec-96db7c23bb74",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"5\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "1cf6c36b-abbc-498b-ba67-5987245d9847",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"6\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -704,
        3712
      ],
      "id": "cae507a8-22f1-43be-9904-79c3842dec4f",
      "name": "Switch_edici√≥n_cita"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üìÖ Por favor, escribe la nueva fecha (Ej: 2025-12-25):",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        3792
      ],
      "id": "9dff1025-0611-45ee-af58-67748e5b1b43",
      "name": "Mensaje_nueva_fecha",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "EDITAR_FECHA",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        3792
      ],
      "id": "47e3b08d-9769-411e-b4d9-9f035f9b6e3e",
      "name": "Actualizar_estado (EDITAR FECHA)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üìÖ Por favor, escribe la nueva fecha (Ej: 2025-12-25):",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2048,
        12912
      ],
      "id": "36174f1e-a157-46e0-ae1f-5eb888a37ed0",
      "name": "Mensaje_nueva_fecha4",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "EDITAR_FECHA",
            "paso_actual": "1"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2272,
        12912
      ],
      "id": "e43ae83a-8fd9-462f-9eb9-fa2cdedc376f",
      "name": "Actualizar_estado (EDITAR NOMBRE)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "EDITAR_NOMBRE",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        3216
      ],
      "id": "2fd5f08f-6213-44fe-bf92-3778f229a06e",
      "name": "Actualizar_estado (EDITAR_NOMBRE)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üìÖ Por favor, escribe un nuevo nombre:",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        3216
      ],
      "id": "79bb3b2a-b2f6-4f76-bdb7-2238fa0aa222",
      "name": "Mensaje_nuevo_nombre",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "EDITAR_HORA",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        3408
      ],
      "id": "7a9ee260-14e5-42d0-9ba2-3fa5254da6a4",
      "name": "Actualizar_estado (EDITAR_HORA)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "= Por favor, escribe la nueva hora (Ej: 14:30):",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        3408
      ],
      "id": "675b5be3-87fd-4fe1-ac0c-2fc669dcfdda",
      "name": "Mensaje_nueva_hora",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "datos_parciales": "={{\n(() => {\n  const rawInfo = $node[\"verificar_sesi√≥n\"] ? $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"] : \"\";\n  \n  let data = {};\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) {\n          data = {};\n      }\n  }\n\n  const nuevoDato = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n  \n  data.fecha = nuevoDato; \n\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -256,
        4560
      ],
      "id": "3a787cab-cddf-406f-b55b-cdda243b9e6b",
      "name": "Actualizar_campo (fecha)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_EDITAR",
            "paso_actual": "6"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        9936
      ],
      "id": "ea6dcf6c-ba4d-49aa-9b87-ea47e487eb30",
      "name": "Actualizar_estado (MENU_EDITAR)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ JSON.parse($json[\"datos_parciales\"]).canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        4560
      ],
      "id": "b9739b6a-999d-4e51-87af-6ecc3bf59be1",
      "name": "Agendar Cita Paso 6 Confirmar (EDITAR_FECHA)",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "datos_parciales": "={{\n(() => {\n  const rawInfo = $node[\"verificar_sesi√≥n\"] ? $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"] : \"\";\n  \n  let data = {};\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) {\n          data = {};\n      }\n  }\n\n  const nuevoDato = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n  \n  data.nombre = nuevoDato; \n\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -704,
        5040
      ],
      "id": "2530607a-abb9-444b-a489-993356a56afb",
      "name": "Actualizar_campo (nombre)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ JSON.parse($json[\"datos_parciales\"]).canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        5040
      ],
      "id": "738cb64b-b77d-4b4b-8f35-e8406de342bb",
      "name": "Agendar Cita Paso 6 Confirmar (EDITAR_NOMBRE)",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "datos_parciales": "={{\n(() => {\n  const rawInfo = $node[\"verificar_sesi√≥n\"] ? $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"] : \"\";\n  \n  let data = {};\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) {\n          data = {};\n      }\n  }\n\n  const nuevoDato = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n  \n  data.nombre = nuevoDato; \n\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2272,
        12688
      ],
      "id": "9ad27ead-54e9-4ada-bf47-e045b8c9529d",
      "name": "Actualizar_campo (nombre)2",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ JSON.parse($json[\"datos_parciales\"]).canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        5232
      ],
      "id": "c0784a2a-d95b-449c-9857-69f6b3c56ac0",
      "name": "Agendar Cita Paso 6 Confirmar (EDITAR_HORA)",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ JSON.parse($json[\"datos_parciales\"]).canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        5616
      ],
      "id": "209cfc98-3116-4961-9c1f-b5a08a922f9f",
      "name": "Agendar Cita Paso 6 Confirmar (EDITAR_MOTIVO)",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ JSON.parse($json[\"datos_parciales\"]).canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2272,
        12464
      ],
      "id": "a84b9d9f-cfa0-4c59-97f2-be0a7016825e",
      "name": "Agendar Cita Paso 6 Confirmar (EDITAR_HORA)1",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "datos_parciales": "={{\n(() => {\n  const rawInfo = $node[\"verificar_sesi√≥n\"] ? $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"] : \"\";\n  \n  let data = {};\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) {\n          data = {};\n      }\n  }\n\n  const nuevoDato = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n  \n  data.motivo = nuevoDato; \n\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -704,
        5616
      ],
      "id": "bf554451-bcc9-49f9-8695-10dc1731bdde",
      "name": "Actualizar_campo (motivo)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "datos_parciales": "={{\n(() => {\n  const rawInfo = $node[\"verificar_sesi√≥n\"] ? $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"] : \"\";\n  \n  let data = {};\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) {\n          data = {};\n      }\n  }\n\n  const nuevoDato = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n  \n  data.hora = nuevoDato; \n\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        5232
      ],
      "id": "65d8571b-fe91-4d30-8d91-b681d395b72f",
      "name": "Actualizar_campo (hora)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  // Intentamos leer lo que hay. Si est√° vac√≠o o da error, iniciamos vacio.\n  try {\n    data = JSON.parse($json[\"datos_parciales\"]);\n  } catch (e) {\n    data = {};\n  }\n  \n  // AQU√ç AGREGAMOS EL DATO NUEVO (Cambia 'fecha' seg√∫n el nodo)\n  data.canal = \"virtual\";\n  \n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "",
            "pantalla_actual": "VERIFICACION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        9360
      ],
      "id": "3fc0ec93-f7a4-4d21-85d1-14b566300534",
      "name": "Agendar_paso_5 (virtual)1",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (presencial)1\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -256,
        9168
      ],
      "id": "e40c37cd-b496-4db3-8444-f0126dca3985",
      "name": "field_presencial1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (virtual)1\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -256,
        9360
      ],
      "id": "166c823a-0344-4dc2-8ee8-94fe7b50dee1",
      "name": "field_virtual1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  // Intentamos leer lo que hay. Si est√° vac√≠o o da error, iniciamos vacio.\n  try {\n    data = JSON.parse($json[\"datos_parciales\"]);\n  } catch (e) {\n    data = {};\n  }\n  \n  // AQU√ç AGREGAMOS EL DATO NUEVO (Cambia 'fecha' seg√∫n el nodo)\n  data.canal = \"llamada\";\n  \n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "",
            "pantalla_actual": "VERIFICACION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        9552
      ],
      "id": "1b501d85-d909-42a3-9108-635e993af053",
      "name": "Agendar_paso_5 (llamada)1",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (llamada)1\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -256,
        9552
      ],
      "id": "c8ca6dfb-332d-45b6-9a96-dad5837235d1",
      "name": "field_llamada1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).motivo }}\nüì° *Canal:* {{ $json.canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        9392
      ],
      "id": "850fc163-f245-47e2-afc0-f641a3e29206",
      "name": "Agendar Cita Paso 6 Confirmar (EDITAR_CANAL)",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "a7189d17-b037-404f-baf4-24eed23819e6"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "41448d46-c520-42a0-9394-a4ef6269320b",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "746bee75-46a6-4597-a700-00477ecf3b07",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -704,
        9344
      ],
      "id": "3b9641d7-6715-42d5-be78-2735e610873e",
      "name": "Switch_editar_tipo_canal"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "datos_parciales": "={{\n(() => {\n  const rawInfo = $node[\"verificar_sesi√≥n\"] ? $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"] : \"\";\n  \n  let data = {};\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) {\n          data = {};\n      }\n  }\n\n  const nuevoDato = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n  \n  data.canal = \"presencial\"; \n\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        9168
      ],
      "id": "7574eab4-2825-4902-a2fa-46e541698709",
      "name": "Actualizar_campo (motivo)1",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=¬øC√≥mo ser√° la atenci√≥n?\n\n1. Presencial\n\n2. Virtual\n\n3. Llamada\n\n4. Cancelar\n\nüí° Sugerencia:\nNormalmente se usa 2 (Virtual).",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        3984
      ],
      "id": "75576790-71c7-4257-8005-3cd561a41a2d",
      "name": "Mensaje_nuevo_canal",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "EDITAR_CANAL",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        3984
      ],
      "id": "fcd94eef-2225-48a4-87f5-fdf5ac92e255",
      "name": "Actualizar_estado (EDITAR_CANAL)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "EDITAR_MOTIVO",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        3600
      ],
      "id": "bf691763-0b87-4398-91f4-a49239938b37",
      "name": "Actualizar_estado (EDITAR_MOTIVO)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Por favor, escribe un nuevo motivo: ",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        3600
      ],
      "id": "a1fb8f03-071f-49e9-b5b6-97b02a980dab",
      "name": "Mensaje_nuevo_motivo",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        4368
      ],
      "id": "3b103492-a5a2-4be0-bbf3-e38cd16f0b3f",
      "name": "Actualizar_estado (VALIDACION)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Volviendo...",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        4368
      ],
      "id": "43e6091e-e936-4eed-b826-0dde16bd2bc9",
      "name": "Mensaje_cancelaci√≥n_edici√≥n",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        4368
      ],
      "id": "3a3ccb49-fc53-4874-96d1-69abd203362e",
      "name": "Agendar Cita Paso 6 Confirmar1",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Volviendo al men√∫ principal...",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        12048
      ],
      "id": "5fa0a9db-736f-4dbf-8fe3-19d9c2ae9303",
      "name": "mensaje_regreso_MENU_CITAS",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups, esa opci√≥n no existe en este men√∫ üòÖ\n\nPor favor escribe uno de los n√∫meros que ves en pantalla.\n\nEst√°s en: {{ $json.pantalla_actual }}\nOpciones disponibles: 0 al 8\n\nüëâ Tip: escribe solo el n√∫mero (por ejemplo: 1).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        12240
      ],
      "id": "cdb28735-3ff7-46a4-a35a-1efd07292afc",
      "name": "Opci√≥n_no_valida (MENU_CITAS)",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups, esa opci√≥n no existe en este men√∫ üòÖ\n\nPor favor escribe uno de los n√∫meros que ves en pantalla.\n\nEst√°s en: {{ $json.pantalla_actual }}\nOpciones disponibles: 0 al 8\n\nüëâ Tip: escribe solo el n√∫mero (por ejemplo: 1).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        4176
      ],
      "id": "25c28d87-4456-4946-a08f-d5003e2dd776",
      "name": "Opci√≥n_no_valida (MENU_EDITAR)",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        10704
      ],
      "id": "6693078b-4b84-43ec-84be-fcfeb1edf882",
      "name": "Obtener_citas",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "VJaPpLM5hhLBGBjj",
          "name": "Google Service Account account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üì≠ *No tienes citas pendientes.*\n\nTu agenda est√° libre por ahora. Si quieres agendar una, elige la opci√≥n 1 en el men√∫ anterior.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        10800
      ],
      "id": "28d98c75-8857-4599-ac59-36766c62f581",
      "name": "Mensaje_sin_citas",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "\nlet mensaje = \"üìÖ *Tu Agenda Actual:*\\n\\n\";\n\nfor (let i = 0; i < items.length; i++) {\n  const cita = items[i].json;\n  \n  // 3. Construimos el bloque de texto para cada cita\n  mensaje += `*${i + 1}.* üóì ${cita.fecha || \"Sin fecha\"} - ‚è∞ ${cita.hora || \"Sin hora\"}\\n`;\n  mensaje += `    üë§ Nombre: ${cita.nombre}\\n`;\n  mensaje += `    üìù Motivo: ${cita.motivo}\\n`;\n  mensaje += `    üîπ Estado: \\`${cita.estado}\\`\\n`; \n  mensaje += `    üÜî ID: \\`${cita.id_cita}\\`\\n`;\n  mensaje += `    -------------------------\\n`;\n}\n\nmensaje += \"\\n¬øQu√© deseas hacer ahora? (Elige una opci√≥n del men√∫ anterior)\";\n\nreturn [{ json: { texto_final: mensaje } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        10320
      ],
      "id": "9eb50c3a-43c3-43a7-a39b-e5e9fa809cef",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "={{ $json.texto_final }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        192,
        10320
      ],
      "id": "9b76b19f-5324-44c0-8869-17d4c0b66774",
      "name": "Mensaje_citas_resultado",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "Pendiente"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        11856
      ],
      "id": "c1b4cdf9-16e3-4225-bc87-03787ffe6b9c",
      "name": "Obtener_citas1",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "VJaPpLM5hhLBGBjj",
          "name": "Google Service Account account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "641737a1-1452-4fd6-a1fb-c7272fbe711c",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -256,
        10704
      ],
      "id": "6ef827b0-721c-4e36-b88c-151a8509dca7",
      "name": "IF_revisar_citas1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üì≠ *No tienes citas para reprogramar.*",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        11952
      ],
      "id": "2ac02f5e-7233-4e9c-a8ae-674812cdab76",
      "name": "Mensaje_sin_citas_reprogramar",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "641737a1-1452-4fd6-a1fb-c7272fbe711c",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -256,
        11856
      ],
      "id": "dbc83d0b-56e4-4b51-9e3b-e910fafd2c79",
      "name": "IF_revisar_citas_reprogramar"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "REPROGRAMAR_FECHA",
            "paso_actual": "0",
            "datos_parciales": "={{ JSON.stringify({ \"id_cita_editar\":  $('Telegram Trigger1').item.json.message.text}) }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -704,
        5808
      ],
      "id": "b883ddc4-47cf-47ef-a110-41539f812cbf",
      "name": "Actualizar_estado (REPROGRAMAR_FECHA)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=‚úÖ ID recibido. ¬øPara qu√© Nueva Fecha la deseas? (Ej: 2026-02-15)",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        5808
      ],
      "id": "073a8a74-4e86-4cd5-a3c9-743c4bd9ca60",
      "name": "Mensaje_reprogramar_citas",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "REPROGRAMAR_HORA",
            "paso_actual": "0",
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  const rawInfo = $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"];\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) { data = {}; }\n  }\n\n  data.nueva_fecha = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"]; \n\n  // 3. RETORNAR\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -256,
        6768
      ],
      "id": "6a057f5d-b12a-4729-83d8-785cdbcb797b",
      "name": "Actualizar_estado (REPROGRAMAR_HORA)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üìÖ Fecha guardada. ¬øA qu√© Nueva Hora? (Ej: 15:30)",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        6768
      ],
      "id": "4bfe91f0-d9a4-4896-8d92-cd949a7747bf",
      "name": "Mensaje_reprogramar_hora",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cita": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).id_cita_editar }}",
            "fecha": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).nueva_fecha }}",
            "hora": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"] }}"
          },
          "matchingColumns": [
            "id_cita"
          ],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        6000
      ],
      "id": "3d1622a3-d613-43ff-a7a1-ac0e3f65fb91",
      "name": "Reprogramar_cita",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CITAS",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -256,
        6000
      ],
      "id": "76f3c620-d44b-46ae-9fa3-9e57950bc7b9",
      "name": "Actualizar_estado-reprogramar (volver MENU_CITAS)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "\nlet mensaje = \"üìÖ *Tu Agenda Actual:*\\n\\n\";\n\nfor (let i = 0; i < items.length; i++) {\n  const cita = items[i].json;\n  \n  // 3. Construimos el bloque de texto para cada cita\n  mensaje += `*${i + 1}.* üóì ${cita.fecha || \"Sin fecha\"} - ‚è∞ ${cita.hora || \"Sin hora\"}\\n`;\n  mensaje += `    üë§ Nombre: ${cita.nombre}\\n`;\n  mensaje += `    üìù Motivo: ${cita.motivo}\\n`;\n  mensaje += `    üîπ Estado: \\`${cita.estado}\\`\\n`; \n  mensaje += `    üÜî ID: \\`${cita.id_cita}\\`\\n`; \n  mensaje += `    -------------------------\\n`;\n}\n\nreturn [{ json: { texto_final: mensaje } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        11760
      ],
      "id": "86ae5878-08d1-4b37-b6bd-00256cacd6ff",
      "name": "Obtener_formater_citas (REPROGRAMAR_CITA)"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "={{ $('Obtener_formater_citas (REPROGRAMAR_CITA)').item.json.texto_final }}\n\nüëÜ Arriba tienes tus citas.\n\n‚úçÔ∏è Por favor, **copia y pega el ID** de la cita que deseas cambiar (Ej: `CITA-20260124...`).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        416,
        11760
      ],
      "id": "ff61af10-ba2b-40d3-ac6f-c68ca7c20d1d",
      "name": "Mensaje_solicitar_cita_id",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
            "pantalla_actual": "REPROGRAMAR_ESPERAR_ID",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        192,
        11760
      ],
      "id": "0bd139ea-33af-4757-988e-e6720e139992",
      "name": "Actualizar_estado (REPROGRAMAR_ESPERAR_ID)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üîÑ *¬°Cita Reprogramada con √âxito!*  Se ha actualizado la fecha y hora de tu cita.  ¬øQu√© deseas hacer ahora? \n\n1. Agendar nueva \n2. Consultar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        6000
      ],
      "id": "7e4225de-9f40-45bd-9ec2-f2f863b01d84",
      "name": "Mensaje_reprogramar_cita_resultado",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "Pendiente"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        11088
      ],
      "id": "f4c549bb-61c9-4b04-9000-bc51c3831480",
      "name": "Obtener_citas2",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "VJaPpLM5hhLBGBjj",
          "name": "Google Service Account account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "641737a1-1452-4fd6-a1fb-c7272fbe711c",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -256,
        11088
      ],
      "id": "613a11b2-5ea9-44dc-bedf-6c5f196f05b3",
      "name": "IF_revisar_citas_cancelar"
    },
    {
      "parameters": {
        "jsCode": "\nlet mensaje = \"üìÖ *Tu Agenda Actual:*\\n\\n\";\n\nfor (let i = 0; i < items.length; i++) {\n  const cita = items[i].json;\n\n  mensaje += `*${i + 1}.* üóì ${cita.fecha || \"Sin fecha\"} - ‚è∞ ${cita.hora || \"Sin hora\"}\\n`;\n  mensaje += `    üë§ Nombre: ${cita.nombre}\\n`;\n  mensaje += `    üìù Motivo: ${cita.motivo}\\n`;\n  mensaje += `    üîπ Estado: \\`${cita.estado}\\`\\n`; \n  mensaje += `    üÜî ID: \\`${cita.id_cita}\\`\\n`; \n  mensaje += `    -------------------------\\n`;\n}\n\nreturn [{ json: { texto_final: mensaje } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        10992
      ],
      "id": "02db3d9e-7ec2-498d-9edd-f1f1ef7ad984",
      "name": "Obtener_cancelar_citas (CANCELAR_CITA)"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
            "pantalla_actual": "CANCELAR_ESPERAR_ID",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        192,
        10992
      ],
      "id": "eefc6d40-ccb0-4405-b998-4658f69c089a",
      "name": "Actualizar_estado (CANCELAR_ESPERAR_ID)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "={{ $node[\"Obtener_cancelar_citas (CANCELAR_CITA)\"].json[\"texto_final\"] }}\n\nüëÜ Aqu√≠ tienes tus citas activas.\n\nüóëÔ∏è Para cancelar una, por favor **copia y pega el ID** de la cita (Ej: `CITA-2025...`).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        416,
        10992
      ],
      "id": "1165b737-5e1a-497f-b21c-aa17aa7012d7",
      "name": "Mensaje_solicitar_cita_id_cancelar",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üóëÔ∏è *¬°Cita Cancelada!*\n\nLa cita ha sido eliminada de tu agenda activa.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        6576
      ],
      "id": "9038eba2-ea93-4ea7-8c17-3266a5d6397a",
      "name": "Mensaje_cancelar_cita_resultado",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cita": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"] }}",
            "estado": "Cancelada"
          },
          "matchingColumns": [
            "id_cita"
          ],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -704,
        6576
      ],
      "id": "cbe82dbe-8232-4689-91e2-7db34d32ef7c",
      "name": "Actualizar_campo (CANCELAR)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CITAS",
            "paso_actual": "0",
            "datos_parciales": "-"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        6576
      ],
      "id": "102d6713-c266-417d-9b65-c11bf07ff47e",
      "name": "Actualizar_estado_cancelar (MENU_CITAS)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "Pendiente"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        11472
      ],
      "id": "8730c3b8-fd84-4803-9325-db285e40de0f",
      "name": "Obtener_citas3",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "VJaPpLM5hhLBGBjj",
          "name": "Google Service Account account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "641737a1-1452-4fd6-a1fb-c7272fbe711c",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -256,
        11472
      ],
      "id": "f6c08a4b-a36c-45f8-87ec-27f3107c4e8b",
      "name": "IF_revisar_citas_completar"
    },
    {
      "parameters": {
        "jsCode": "\nlet mensaje = \"üìÖ *Tu Agenda Actual:*\\n\\n\";\n\nfor (let i = 0; i < items.length; i++) {\n  const cita = items[i].json;\n\n  mensaje += `*${i + 1}.* üóì ${cita.fecha || \"Sin fecha\"} - ‚è∞ ${cita.hora || \"Sin hora\"}\\n`;\n  mensaje += `    üë§ Nombre: ${cita.nombre}\\n`;\n  mensaje += `    üìù Motivo: ${cita.motivo}\\n`;\n  mensaje += `    üîπ Estado: \\`${cita.estado}\\`\\n`; \n  mensaje += `    üÜî ID: \\`${cita.id_cita}\\`\\n`; \n  mensaje += `    -------------------------\\n`;\n}\n\nreturn [{ json: { texto_final: mensaje } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        11376
      ],
      "id": "dbe5eb54-1bf5-4296-b867-da5f3d2749e9",
      "name": "Obtener_completar_citas (CCOMPLETAR_CITA)"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
            "pantalla_actual": "COMPLETAR_ESPERAR_ID",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        192,
        11376
      ],
      "id": "93331191-e20e-44cb-a506-935f4d29995f",
      "name": "Actualizar_estado (COMPLETAR_ESPERAR_ID)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "={{ $node[\"Obtener_completar_citas (CCOMPLETAR_CITA)\"].json[\"texto_final\"] }}\n\nüëÜ Aqu√≠ tienes tus citas pendientes.\n\n‚úÖ Para marcar una como realizada, **copia y pega el ID** de la cita (Ej: `CITA-2025...`).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        416,
        11376
      ],
      "id": "6cdeb52f-c594-43f6-9437-c084c5a3946b",
      "name": "Mensaje_solicitar_cita_id_completar",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cita": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"] }}",
            "estado": "Completada"
          },
          "matchingColumns": [
            "id_cita"
          ],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -704,
        6384
      ],
      "id": "22cf40d8-32f0-4dd7-97e3-deca48b682e1",
      "name": "Actualizar_campo (COMPLETAR)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CITAS",
            "paso_actual": "0",
            "datos_parciales": "-"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        6384
      ],
      "id": "5ac263c1-e48b-40c6-8120-c54f7870e7b6",
      "name": "Actualizar_estado_completar (MENU_CITAS)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üéâ *¬°Excelente! Cita marcada como completada.*\n\nSe ha guardado en tu historial.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        6384
      ],
      "id": "ac89e09a-18d1-416a-9f83-dd2434296397",
      "name": "Mensaje_completar_cita_resultado",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üì≠ *No tienes citas para cancrlar.*\n\nTu agenda est√° libre por ahora. Si quieres agendar una, elige la opci√≥n 1 en el men√∫ anterior.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        11184
      ],
      "id": "e4cdc767-9894-4420-985c-baca3afa8c48",
      "name": "Mensaje_sin_citas_cancelar",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üì≠ *No tienes citas pendientes.*\n\nTu agenda est√° libre por ahora. Si quieres agendar una, elige la opci√≥n 1 en el men√∫ anterior.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        11568
      ],
      "id": "db9e0d01-4991-48dd-a811-2cd367959070",
      "name": "Mensaje_sin_citas_completar",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "38f29dd4-22dc-4f60-8034-104b08f759c2"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "7822bff0-b809-448a-bc3b-546eeb2ea936",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"7\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5900d2d6-4eb6-42a5-b6e7-0792e9b6745e",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"8\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -704,
        2704
      ],
      "id": "5361de50-4710-4966-9218-c5c7944dc56f",
      "name": "Switch_menu_principal"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CONFIGURACION",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        2832
      ],
      "id": "944afa37-7cae-4dda-9921-db3fddbe91c7",
      "name": "Actualizar_estado (MENU_CONFIGURACION)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=‚öôÔ∏è *Configuraci√≥n*\n\nAqu√≠ puedes gestionar tu cuenta y el bot.\n\n1. üë§ Ver mi perfil\n2Ô∏è. üîÑ Reiniciar conversaci√≥n (Si algo falla)\n3Ô∏è. üîô Volver al men√∫ principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        2832
      ],
      "id": "72654f08-d62f-43b0-bcac-201915b9948d",
      "name": "Mensaje_menu_configuracion",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e69cfef1-495d-4e90-9e9d-5ff6ea637623"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f4c25ecd-267c-4c0f-a971-b5b38d38d2b4",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "9f5e1107-b9bc-4848-a57f-2a6b8146238e",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -704,
        8768
      ],
      "id": "62d98c7d-4100-48e9-974c-ff9db2d58d8b",
      "name": "Switch_menu_configuracion"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üë§ *Tu Perfil de Usuario*\n\n*Nombre:* {{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"first_name\"] }}\n*Apellido:* {{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"last_name\"] }}\n*ID de Usuario:* `{{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}`\n*Idioma:* {{ $node[\"Telegram Trigger1\"].json[\"message\"][\"from\"][\"language_code\"] }}\n\n‚ÑπÔ∏è _Este ID es √∫nico y sirve para identificar tu agenda._",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        8592
      ],
      "id": "0babfc90-3447-44f5-8d3f-574ffb64afc4",
      "name": "Mensaje_user_info",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "",
            "datos_parciales": "={}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        8784
      ],
      "id": "ba2812e9-5e56-490f-bda8-450248618f1c",
      "name": "Actualizar_estado_reinicio (MENU_PRINCIPAL)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üîÑ *¬°Bot Reiniciado!*\n\nHe borrado la memoria temporal de nuestra conversaci√≥n. Estamos listos para empezar de nuevo.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        8784
      ],
      "id": "3f5d4d71-9b08-4159-84eb-be3e96f4133a",
      "name": "Mensaje_user_reinicio",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=Hola, soy AgendaBot üëã\n\nEstoy aqu√≠ para ayudarte a organizar tus citas, tareas y recordatorios\nde forma sencilla y sin complicaciones.\n\nPuedes escribirme en cualquier momento.\nPara avanzar, solo tienes que escribir el n√∫mero de la opci√≥n que quieras usar.\n\nMen√∫ principal:\n0. Ayuda\n1. Agenda (citas)\n2. Tareas\n3. Recordatorios\n4. H√°bitos\n5. Listas\n6. Reportes\n7. Configuraci√≥n\n8. Administrador",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        8784
      ],
      "id": "43ed4e76-4a4d-4080-8607-3d3e330c34d8",
      "name": "Mensaje_user_menu_principal",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "",
            "datos_parciales": "={}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        8976
      ],
      "id": "55e3e83c-ebe7-4719-aebf-a3a41968aec8",
      "name": "Actualizar_estado_regreso (MENU_PRINCIPAL)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        8976
      ],
      "id": "ee4d82cb-ead8-4f10-bdf1-73c84bc8dcfd",
      "name": "Menu Principal_regreso",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "e556100d-4272-4a61-8297-59b04fba537a",
              "leftValue": "={{ $json.rol }}",
              "rightValue": "administrador",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -256,
        2640
      ],
      "id": "c46f1be6-d4ff-4fd6-8cd9-533c92b4d9a3",
      "name": "If_es_ADMIN?"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2006573822,
          "mode": "list",
          "cachedResultName": "USUARIOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=2006573822"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "rol",
              "lookupValue": "administrador"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        2640
      ],
      "id": "e722e0fe-329e-4240-90fc-a17f1207101c",
      "name": "Obtener_usuario",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "VJaPpLM5hhLBGBjj",
          "name": "Google Service Account account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=‚õî *Acceso Denegado*\n\nEsta opci√≥n est√° reservada √∫nicamente para administradores del sistema.\n\nüëÆ‚Äç‚ôÇÔ∏è Tu intento ha sido registrado.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        3408
      ],
      "id": "1523e9b8-88a4-4a84-96aa-4fd17bd611da",
      "name": "Mensaje_denegacion_permiso",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_ADMIN",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -32,
        2544
      ],
      "id": "f7c8b71f-b559-4b03-a9bb-110b06b59696",
      "name": "Actualizar_estado (MENU_ADMIN)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üïµÔ∏è‚Äç‚ôÇÔ∏è *Panel de Administrador*\n\nBienvenido, Jefe. ¬øQu√© deseas supervisar?\n\n1Ô∏è. üåç Ver TODAS las citas (Global)\n2Ô∏è. üìä Ver Estad√≠sticas (Usuarios/Citas)\n3Ô∏è. üì¢ Enviar Anuncio Global (Broadcast)\n4Ô∏è. üîô Volver al Men√∫ Principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        192,
        2544
      ],
      "id": "3be3c7aa-a2c4-4278-8a9f-3a1135aad319",
      "name": "Mensaje_MENU_ADMIN",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "19ceeda5-942f-465e-85e4-7fc624f631ed"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28eafc6a-73a5-46c5-b43b-4e312f7742c5",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "84e5e911-17f3-43cc-a901-71de7f7bea54",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4ffed133-ead8-46d0-b73d-7e2de83accc0",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"4\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -704,
        8080
      ],
      "id": "2f2621ee-8d79-43ab-aff1-90e815b9b17d",
      "name": "Switch_ADMIN"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        7824
      ],
      "id": "b235d71f-b4ff-494f-82c7-ed8cdc4352bf",
      "name": "Obtener_citas_global",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "VJaPpLM5hhLBGBjj",
          "name": "Google Service Account account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "641737a1-1452-4fd6-a1fb-c7272fbe711c",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -256,
        7824
      ],
      "id": "3cf6ddd7-650c-4d3e-bcd8-d1e04ead67f2",
      "name": "IF_revisar_citas_global"
    },
    {
      "parameters": {
        "jsCode": "\nlet mensaje = \"üìÖ *Tu Agenda Actual:*\\n\\n\";\n\nfor (let i = 0; i < items.length; i++) {\n  const cita = items[i].json;\n\n  mensaje += `*${i + 1}.* üóì ${cita.fecha || \"Sin fecha\"} - ‚è∞ ${cita.hora || \"Sin hora\"}\\n`;\n  mensaje += `    üë§ Nombre: ${cita.nombre}\\n`;\n  mensaje += `    üìù Motivo: ${cita.motivo}\\n`;\n  mensaje += `    üîπ Estado: \\`${cita.estado}\\`\\n`; \n  mensaje += `    üÜî ID: \\`${cita.id_cita}\\`\\n`; \n  mensaje += `    -------------------------\\n`;\n}\n\nreturn [{ json: { texto_final: mensaje } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        7728
      ],
      "id": "212aae6a-7d11-47cb-90e0-84723fd2f614",
      "name": "Obtener_citas (global)"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=No hay citas agendadas globalmente.\n\n(ADMIN)",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        7920
      ],
      "id": "1d6a3fd4-e092-4c05-8ab6-c1aa06ebff94",
      "name": "Mensaje_sin citas_global",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=AGENDAMIENTOS GLOBALES:\n\n{{ $json.texto_final }}\n\nADMIN",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        192,
        7728
      ],
      "id": "3954df72-1d6e-485b-bd5d-667b0d49942b",
      "name": "Mensaje_citas_global",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -256,
        8400
      ],
      "id": "dca5f37a-fe1b-41a9-9d13-f99195b4ab17",
      "name": "Obtener_citas_global_estadisticas",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleApi": {
          "id": "VJaPpLM5hhLBGBjj",
          "name": "Google Service Account account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        8400
      ],
      "id": "8b37887f-b180-4342-940a-c8fdf247b092",
      "name": "Obtener_sesiones_global_estadisticas",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "VJaPpLM5hhLBGBjj",
          "name": "Google Service Account account 3"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let usuariosRaw = [];\nlet citasRaw = [];\n\ntry {\n    usuariosRaw = $items(\"Obtener_sesiones_global_estadisticas\"); \n} catch (e) {}\n\ntry {\n    citasRaw = $items(\"Obtener_citas_global_estadisticas\"); \n} catch (e) {\n    citasRaw = [];\n}\n\nconst usuariosReales = usuariosRaw.filter(u => u.json.telegram_user && u.json.telegram_user !== \"\");\n\nconst citasReales = citasRaw.filter(c => c.json.id_cita && c.json.id_cita !== \"\");\n\nconst citasPendientes = citasReales.filter(c => c.json.estado === 'Pendiente').length;\n\nconst msg = `üìä *Estad√≠sticas del Bot*\n\nüë• *Usuarios Reales:* ${usuariosReales.length}\nüìÖ *Citas Totales:* ${citasReales.length}\n‚è≥ *Pendientes:* ${citasPendientes}\n\n‚úÖ _Datos verificados._`;\n\nreturn [{ json: { msg: msg } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        8400
      ],
      "id": "3a1d79c7-6909-4981-9761-c9a89395bcfc",
      "name": "Formatear_campos_estadisticas",
      "executeOnce": true
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "={{ $json[\"msg\"] }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        192,
        8400
      ],
      "id": "ea11a0e8-56c1-4138-908a-0e5a6c162aca",
      "name": "Mensaje_sin citas_global1",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "ADMIN_BROADCAST",
            "paso_actual": "0",
            "datos_parciales": "-"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        8016
      ],
      "id": "060d4357-38c3-4115-9e8d-64d8f2c0266b",
      "name": "Actualizar_estado (ADMIN_BROADCAST)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üì¢ *Nuevo Anuncio Global*\n\nPor favor, escribe el mensaje que quieres enviar a TODOS los usuarios.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        8016
      ],
      "id": "6fc01095-1ecb-4061-bf64-f910c3bad761",
      "name": "Mensaje_solicitar_broadcast_global",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "ADMIN_BROADCAST_CONFIRMAR",
            "paso_actual": "0",
            "datos_parciales": "={{ JSON.stringify({ \"mensaje_broadcast\": $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"] }) }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -704,
        7248
      ],
      "id": "ac4fcedb-171d-4ca0-b355-131986412607",
      "name": "Actualizar_estado (ADMIN_BROADCAST_CONFIRMAR)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üëÅÔ∏è *VISTA PREVIA DEL ANUNCIO:*\n--------------------------------\n{{ $('Telegram Trigger1').item.json.message.text }}\n--------------------------------\n\n¬øEst√°s seguro de enviar esto a todos los usuarios?\n1. ‚úÖ S√ç, ENVIAR AHORA\n2. ‚ùå NO, CANCELAR",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        7248
      ],
      "id": "26c24b57-365b-446f-9d47-33d1d01fa467",
      "name": "Mensaje_previo_global",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "9226d60b-f282-4492-900b-6dbd5ab3dc54"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "aa959bfe-d3e3-406a-bd96-da0c69bc03a6",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -704,
        7568
      ],
      "id": "3a41f5b4-29ee-4643-bf16-a2360aaebeba",
      "name": "Switch_confirmar_mensaje_global"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_ADMIN",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        7632
      ],
      "id": "44670064-aa8a-4c8e-8a39-8114c7f0c8a2",
      "name": "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=Operaci√≥n cancelada.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        7632
      ],
      "id": "bab6c1dd-b0d8-44e3-97cd-6b8ab8ac3e21",
      "name": "Mensaje_cancelaci√≥n_global",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        7440
      ],
      "id": "94229052-1613-42c7-9206-72dba437a837",
      "name": "Obtener_sesiones_mensaje_global",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "VJaPpLM5hhLBGBjj",
          "name": "Google Service Account account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "031761d0-329c-4c50-a02e-55f8162049f6",
              "leftValue": "={{ $json.telegram_user }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.3,
      "position": [
        -256,
        7440
      ],
      "id": "e47b49b4-25ee-4d99-acc4-32b812238f00",
      "name": "Filter"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_ADMIN",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        192,
        7440
      ],
      "id": "f42291b6-9bf7-4f0b-abf1-16e7347d7567",
      "name": "Actualizar_estado_exitoso (MENU_ADMIN)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json[\"telegram_user\"] }}",
        "text": "=üì¢ *Anuncio Importante:*\n\nüì¢ *Anuncio Importante:*\n\n{{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).mensaje_broadcast }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        7440
      ],
      "id": "a3556f40-ef3c-4429-94c1-2d1075261cd5",
      "name": "Mensaje_envio_global",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Mensaje enviado con exito, has sido devuelto al panel del administrador\n\nüïµÔ∏è‚Äç‚ôÇÔ∏è *Panel de Administrador*\n\n1Ô∏è. üåç Ver TODAS las citas (Global)\n2Ô∏è. üìä Ver Estad√≠sticas (Usuarios/Citas)\n3Ô∏è. üì¢ Enviar Anuncio Global (Broadcast)\n4Ô∏è. üîô Volver al Men√∫ Principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        416,
        7440
      ],
      "id": "fb68b4a6-0b47-42e7-8298-22b58fea7b0c",
      "name": "Mensaje_MENU_ADMIN1",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -480,
        8208
      ],
      "id": "0fab22c3-2f99-45cb-878d-245e69b1c552",
      "name": "Actualizar_estado_cancelaci√≥n (MENU_PRINCIPAL)",
      "credentials": {
        "googleApi": {
          "id": "0GKqSdtRDeq9BTEj",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=Saliendo al Men√∫ principal...\n(ADMIN)",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        8208
      ],
      "id": "2f50899d-dc5d-4e8e-9991-4ca8f1df382a",
      "name": "Mensaje_salir_admin",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        8208
      ],
      "id": "fd3a34c6-65bb-4297-921f-ec2aa6949fb2",
      "name": "Menu Principal1",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        3024
      ],
      "id": "a1d57f25-d3c4-4f37-8fdf-c54a338f5ef6",
      "name": "Menu Principal2",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -32,
        816
      ],
      "id": "47004820-712a-4f42-9f19-f70f60a4695a",
      "name": "Obtener_citas_verificacion_dovle_reserva",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "VJaPpLM5hhLBGBjj",
          "name": "Google Service Account account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "1cd39e6d-23ff-4171-a149-57e5fbb9bf61",
              "leftValue": "={{ $json[\"conflictCount\"] }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        416,
        816
      ],
      "id": "4566a898-5212-4752-971a-bbc02a9acfd4",
      "name": "If_citas_repetidas_fecha"
    },
    {
      "parameters": {
        "jsCode": "// 1. Traemos todas las citas\nconst citas = $input.all();\n\nlet fechaDeseada = \"\";\nlet horaDeseada = \"\";\n\ntry {\n    // Obtenemos los datos del usuario\n    fechaDeseada = JSON.parse($items(\"verificar_sesi√≥n\")[0].json[\"datos_parciales\"]).fecha;\n    horaDeseada = $items(\"Telegram Trigger1\")[0].json[\"message\"][\"text\"];\n} catch (e) { }\n\n// FUNCI√ìN DE AYUDA: Limpia la hora para quedarse solo con HH:MM\n// Convierte \"14:30:00\" -> \"14:30\" y \"14:30\" -> \"14:30\"\nconst limpiarHora = (h) => {\n    if (!h) return \"\";\n    return h.toString().trim().substring(0, 5); // Toma solo los primeros 5 caracteres\n};\n\n// 2. Buscamos conflictos usando la hora limpia\nconst conflictos = citas.filter(item => {\n    const c = item.json;\n    \n    // Normalizamos las horas antes de comparar\n    const horaSheet = limpiarHora(c.hora);\n    const horaUser = limpiarHora(horaDeseada);\n\n    // LOGICA DE COLISI√ìN:\n    // - Misma Fecha\n    // - Misma Hora (ignorando segundos)\n    // - Estado NO es 'Cancelada' (Ocupado si es Pendiente, Completada, etc.)\n    return c.fecha == fechaDeseada && \n           horaSheet == horaUser && \n           c.estado != 'Cancelada';\n});\n\n// 3. Devolvemos el resultado\nreturn [{\n    json: {\n        conflictCount: conflictos.length,\n        debug: `Compar√© ${fechaDeseada} ${limpiarHora(horaDeseada)} con ${citas.length} citas.` // Info extra para ti\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        192,
        816
      ],
      "id": "8a270f6d-471a-4819-9eb3-aa1cc2378e70",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^\\d{4}-\\d{2}-\\d{2}$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -256,
        528
      ],
      "id": "e77bcf83-31e0-44e7-9b86-21a6cfdb1da5",
      "name": "If_validar_formato_fecha"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^([01]\\d|2[0-3]):[0-5]\\d$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -256,
        912
      ],
      "id": "55f8e6f0-3807-484e-b1a8-16596d286e34",
      "name": "If_validar_formato_hora"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "2c064515-ed9d-4706-aafd-b6338a08fcdf",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "={{ $now.setZone('America/Bogota').toFormat('yyyy-MM-dd') }}",
              "operator": {
                "type": "dateTime",
                "operation": "afterOrEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -32,
        432
      ],
      "id": "e97b5627-e761-403b-a885-f0044ed10996",
      "name": "If"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "2c064515-ed9d-4706-aafd-b6338a08fcdf",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "={{ $now.setZone('America/Bogota').toFormat('yyyy-MM-dd') }}",
              "operator": {
                "type": "dateTime",
                "operation": "afterOrEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -480,
        6864
      ],
      "id": "a3102254-cb4d-4d52-b1d1-a7e2ffb6088a",
      "name": "If_validar_fecha_reprogramar1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^\\d{4}-\\d{2}-\\d{2}$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -704,
        6992
      ],
      "id": "5345c5a0-bb52-417e-9322-50d999d14240",
      "name": "If_validar_formato_fecha_reprogramar1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la fecha no tiene el formato correcto.\n\nRecuerda usar: YYYY-MM-DD\nEjemplo: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        7056
      ],
      "id": "31e1b7fb-c612-463f-969a-febead252f3c",
      "name": "Fecha Invalida_reprogramar1",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Hmm ü§î esa fecha ya pas√≥.\n\nPor favor ingresa una fecha futura.\n\nEjemplo: 2026-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        7056
      ],
      "id": "b288831e-3f6c-444b-b3e5-0db41825d292",
      "name": "Fecha en el pasado_reprogramar1",
      "webhookId": "431e9db7-ea8c-443c-bb82-65fa90992bd9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^([01]\\d|2[0-3]):[0-5]\\d$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -704,
        6096
      ],
      "id": "ee0d580e-4c6b-4389-9f16-83c6f540d8d3",
      "name": "If_validar_formato_hora_reprogramar"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la hora no tiene un formato v√°lido.\n\nRecuerda usar formato 24 horas:\nHH:MM\n\nEjemplo: 14:30\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        6192
      ],
      "id": "22ec4dfc-9154-4684-a673-c9e87ac69bf7",
      "name": "Hora Invalida_reprogramar",
      "webhookId": "89a3d27f-d5de-425c-8c71-1bdf700a711e",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^([01]\\d|2[0-3]):[0-5]\\d$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -704,
        5328
      ],
      "id": "84be209b-110a-4278-bc6f-b2b6260fe5e3",
      "name": "If_validar_formato_hora_actualizar"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la hora no tiene un formato v√°lido.\n\nRecuerda usar formato 24 horas:\nHH:MM\n\nEjemplo: 14:30\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        5424
      ],
      "id": "923481c6-6e9a-4d51-a1e3-37fe238aed47",
      "name": "Hora Invalida_actualizar",
      "webhookId": "89a3d27f-d5de-425c-8c71-1bdf700a711e",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la fecha no tiene el formato correcto.\n\nRecuerda usar: YYYY-MM-DD\nEjemplo: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -480,
        4848
      ],
      "id": "2d2e66af-d0dd-469c-92aa-578d5fd654f1",
      "name": "Fecha Invalida_reprogramar",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Hmm ü§î esa fecha ya pas√≥.\n\nPor favor ingresa una fecha futura.\n\nEjemplo: 2026-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        4848
      ],
      "id": "e11d1240-dbfc-4d22-b486-5106944e250d",
      "name": "Fecha en el pasado_reprogramar",
      "webhookId": "431e9db7-ea8c-443c-bb82-65fa90992bd9",
      "credentials": {
        "telegramApi": {
          "id": "ZwELOJsts6YCD2Un",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^\\d{4}-\\d{2}-\\d{2}$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -704,
        4752
      ],
      "id": "981ab74b-b7d2-49d0-9a36-d233af29683e",
      "name": "If_validar_formato_fecha_reprogramar"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "2c064515-ed9d-4706-aafd-b6338a08fcdf",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "={{ $now.setZone('America/Bogota').toFormat('yyyy-MM-dd') }}",
              "operator": {
                "type": "dateTime",
                "operation": "afterOrEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -480,
        4656
      ],
      "id": "46106b41-9dcf-4cf9-9a75-1c027bffedb6",
      "name": "If_fecha_v√°lida_reprogramar"
    }
  ],
  "pinData": {},
  "connections": {
    "verificar_usuario": {
      "main": [
        [
          {
            "node": "IF_usuario_existe",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger1": {
      "main": [
        [
          {
            "node": "verificar_usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verificar_sesi√≥n": {
      "main": [
        [
          {
            "node": "IF_sesion_iniciada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_usuario_existe": {
      "main": [
        [
          {
            "node": "verificar_sesi√≥n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_sesion_iniciada": {
      "main": [
        [
          {
            "node": "Append_session",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "CEREBRO_PRINCIPAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append_session": {
      "main": [
        [
          {
            "node": "CEREBRO_PRINCIPAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CEREBRO_PRINCIPAL": {
      "main": [
        [
          {
            "node": "Switch_menu_principal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF_cancelar_agendamiento",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "Switch_MENU_CITAS",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_CONFIRMACION_CITA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_edici√≥n_cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If_validar_formato_fecha_reprogramar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_campo (nombre)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If_validar_formato_hora_actualizar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_campo (motivo)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_editar_tipo_canal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (REPROGRAMAR_FECHA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If_validar_formato_fecha_reprogramar1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If_validar_formato_hora_reprogramar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_campo (CANCELAR)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_campo (COMPLETAR)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_menu_configuracion",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_ADMIN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (ADMIN_BROADCAST_CONFIRMAR)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_confirmar_mensaje_global",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_edicion_creaci√≥n",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opci√≥n No Valida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Doble Reserva": {
      "main": [
        []
      ]
    },
    "Agendar Cita Paso 6 Confirmar": {
      "main": [
        []
      ]
    },
    "Agendar Cita Paso 5": {
      "main": [
        []
      ]
    },
    "Agendar Cita Paso 4": {
      "main": [
        []
      ]
    },
    "Agendar Cita Paso 3": {
      "main": [
        []
      ]
    },
    "Agendar Cita Paso 2": {
      "main": [
        []
      ]
    },
    "Agendar_paso_1": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar_agendamiento": {
      "main": [
        [
          {
            "node": "Cancelar_agendamiento_message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_2": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_3": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_4": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Monitor_edici√≥n": {
      "main": [
        [
          {
            "node": "If_validar_formato_fecha",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If_validar_formato_hora",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_tipo_canal",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Agendar_paso_5 (presencial)": {
      "main": [
        [
          {
            "node": "field_presencial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_5 (virtual)": {
      "main": [
        [
          {
            "node": "field_virtual",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_5 (llamada)": {
      "main": [
        [
          {
            "node": "field_llamada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Bienvenida": {
      "main": [
        [
          {
            "node": "Menu Principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_cancelar_agendamiento": {
      "main": [
        [
          {
            "node": "Cancelar_agendamiento",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Monitor_edici√≥n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_presencial": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_virtual": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_llamada": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append_cita": {
      "main": [
        [
          {
            "node": "Actualizar_estado (CONFIRMACION_CITA)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_agendar_cita": {
      "main": [
        [
          {
            "node": "Actualizar_estado (MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Bienvenida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_CITAS)": {
      "main": [
        [
          {
            "node": "Men√∫ Agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_MENU_CITAS": {
      "main": [
        [
          {
            "node": "Actualizar_estado (AGENDAR)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_citas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_citas1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_citas2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_citas3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (MENU_PRINCIPAL) /SWITCH MENU_CITAS",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opci√≥n_no_valida (MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (AGENDAR)": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso inicial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_PRINCIPAL) /SWITCH MENU_CITAS": {
      "main": [
        [
          {
            "node": "mensaje_regreso_MENU_CITAS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_registro_exitoso": {
      "main": [
        []
      ]
    },
    "Switch_tipo_canal": {
      "main": [
        [
          {
            "node": "Agendar_paso_5 (presencial)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_5 (virtual)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_5 (llamada)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_edicion_creaci√≥n": {
      "main": [
        [
          {
            "node": "Append_cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (MENU_EDITAR)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_CONFIRMACION_CITA": {
      "main": [
        [
          {
            "node": "Actualizar_estado (volver MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (volver MENU_PRINCIPAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (volver MENU_CITAS)": {
      "main": [
        [
          {
            "node": "Mostrar_Menu_agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (volver MENU_PRINCIPAL)": {
      "main": [
        [
          {
            "node": "Mostrar_menu_principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (CONFIRMACION_CITA)": {
      "main": [
        [
          {
            "node": "Mensaje_registro_exitoso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_edici√≥n_cita": {
      "main": [
        [
          {
            "node": "Actualizar_estado (EDITAR_NOMBRE)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (EDITAR FECHA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (EDITAR_HORA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (EDITAR_MOTIVO)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (EDITAR_CANAL)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (VALIDACION)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opci√≥n_no_valida (MENU_EDITAR)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (EDITAR FECHA)": {
      "main": [
        [
          {
            "node": "Mensaje_nueva_fecha",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (EDITAR NOMBRE)": {
      "main": [
        [
          {
            "node": "Mensaje_nueva_fecha4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (EDITAR_NOMBRE)": {
      "main": [
        [
          {
            "node": "Mensaje_nuevo_nombre",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (EDITAR_HORA)": {
      "main": [
        [
          {
            "node": "Mensaje_nueva_hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_EDITAR)": {
      "main": [
        [
          {
            "node": "Mensaje_edicion_cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (fecha)": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_FECHA)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (nombre)": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_NOMBRE)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (motivo)": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_MOTIVO)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (hora)": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_HORA)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_5 (virtual)1": {
      "main": [
        [
          {
            "node": "field_virtual1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_presencial1": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_CANAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_virtual1": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_CANAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_5 (llamada)1": {
      "main": [
        [
          {
            "node": "field_llamada1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_llamada1": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_CANAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_editar_tipo_canal": {
      "main": [
        [
          {
            "node": "Actualizar_campo (motivo)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_5 (virtual)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_5 (llamada)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (motivo)1": {
      "main": [
        [
          {
            "node": "field_presencial1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (EDITAR_CANAL)": {
      "main": [
        [
          {
            "node": "Mensaje_nuevo_canal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (EDITAR_MOTIVO)": {
      "main": [
        [
          {
            "node": "Mensaje_nuevo_motivo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (VALIDACION)": {
      "main": [
        [
          {
            "node": "Mensaje_cancelaci√≥n_edici√≥n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_cancelaci√≥n_edici√≥n": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas": {
      "main": [
        [
          {
            "node": "IF_revisar_citas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Mensaje_citas_resultado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas1": {
      "main": [
        [
          {
            "node": "IF_revisar_citas_reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_revisar_citas1": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_sin_citas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_revisar_citas_reprogramar": {
      "main": [
        [
          {
            "node": "Obtener_formater_citas (REPROGRAMAR_CITA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_sin_citas_reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (REPROGRAMAR_FECHA)": {
      "main": [
        [
          {
            "node": "Mensaje_reprogramar_citas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (REPROGRAMAR_HORA)": {
      "main": [
        [
          {
            "node": "Mensaje_reprogramar_hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reprogramar_cita": {
      "main": [
        [
          {
            "node": "Actualizar_estado-reprogramar (volver MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado-reprogramar (volver MENU_CITAS)": {
      "main": [
        [
          {
            "node": "Mensaje_reprogramar_cita_resultado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_formater_citas (REPROGRAMAR_CITA)": {
      "main": [
        [
          {
            "node": "Actualizar_estado (REPROGRAMAR_ESPERAR_ID)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (REPROGRAMAR_ESPERAR_ID)": {
      "main": [
        [
          {
            "node": "Mensaje_solicitar_cita_id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas2": {
      "main": [
        [
          {
            "node": "IF_revisar_citas_cancelar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_revisar_citas_cancelar": {
      "main": [
        [
          {
            "node": "Obtener_cancelar_citas (CANCELAR_CITA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_sin_citas_cancelar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_cancelar_citas (CANCELAR_CITA)": {
      "main": [
        [
          {
            "node": "Actualizar_estado (CANCELAR_ESPERAR_ID)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (CANCELAR_ESPERAR_ID)": {
      "main": [
        [
          {
            "node": "Mensaje_solicitar_cita_id_cancelar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (CANCELAR)": {
      "main": [
        [
          {
            "node": "Actualizar_estado_cancelar (MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_cancelar (MENU_CITAS)": {
      "main": [
        [
          {
            "node": "Mensaje_cancelar_cita_resultado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas3": {
      "main": [
        [
          {
            "node": "IF_revisar_citas_completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_revisar_citas_completar": {
      "main": [
        [
          {
            "node": "Obtener_completar_citas (CCOMPLETAR_CITA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_sin_citas_completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_completar_citas (CCOMPLETAR_CITA)": {
      "main": [
        [
          {
            "node": "Actualizar_estado (COMPLETAR_ESPERAR_ID)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (COMPLETAR_ESPERAR_ID)": {
      "main": [
        [
          {
            "node": "Mensaje_solicitar_cita_id_completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (COMPLETAR)": {
      "main": [
        [
          {
            "node": "Actualizar_estado_completar (MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_completar (MENU_CITAS)": {
      "main": [
        [
          {
            "node": "Mensaje_completar_cita_resultado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_menu_principal": {
      "main": [
        [
          {
            "node": "IF_agendar_cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (MENU_CONFIGURACION)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_usuario",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Menu Principal2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_CONFIGURACION)": {
      "main": [
        [
          {
            "node": "Mensaje_menu_configuracion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_menu_configuracion": {
      "main": [
        [
          {
            "node": "Mensaje_user_info",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_reinicio (MENU_PRINCIPAL)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_regreso (MENU_PRINCIPAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_reinicio (MENU_PRINCIPAL)": {
      "main": [
        [
          {
            "node": "Mensaje_user_reinicio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_user_reinicio": {
      "main": [
        [
          {
            "node": "Mensaje_user_menu_principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_regreso (MENU_PRINCIPAL)": {
      "main": [
        [
          {
            "node": "Menu Principal_regreso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_usuario": {
      "main": [
        [
          {
            "node": "If_es_ADMIN?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_es_ADMIN?": {
      "main": [
        [
          {
            "node": "Actualizar_estado (MENU_ADMIN)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_denegacion_permiso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_ADMIN)": {
      "main": [
        [
          {
            "node": "Mensaje_MENU_ADMIN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_ADMIN": {
      "main": [
        [
          {
            "node": "Obtener_citas_global",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_sesiones_global_estadisticas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (ADMIN_BROADCAST)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_cancelaci√≥n (MENU_PRINCIPAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas_global": {
      "main": [
        [
          {
            "node": "IF_revisar_citas_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_revisar_citas_global": {
      "main": [
        [
          {
            "node": "Obtener_citas (global)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_sin citas_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas (global)": {
      "main": [
        [
          {
            "node": "Mensaje_citas_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_user_info": {
      "main": [
        []
      ]
    },
    "Obtener_sesiones_global_estadisticas": {
      "main": [
        [
          {
            "node": "Obtener_citas_global_estadisticas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas_global_estadisticas": {
      "main": [
        [
          {
            "node": "Formatear_campos_estadisticas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatear_campos_estadisticas": {
      "main": [
        [
          {
            "node": "Mensaje_sin citas_global1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (ADMIN_BROADCAST)": {
      "main": [
        [
          {
            "node": "Mensaje_solicitar_broadcast_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (ADMIN_BROADCAST_CONFIRMAR)": {
      "main": [
        [
          {
            "node": "Mensaje_previo_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_confirmar_mensaje_global": {
      "main": [
        [
          {
            "node": "Obtener_sesiones_mensaje_global",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)": {
      "main": [
        [
          {
            "node": "Mensaje_cancelaci√≥n_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_sesiones_mensaje_global": {
      "main": [
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "Mensaje_envio_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_exitoso (MENU_ADMIN)": {
      "main": [
        [
          {
            "node": "Mensaje_MENU_ADMIN1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_envio_global": {
      "main": [
        [
          {
            "node": "Actualizar_estado_exitoso (MENU_ADMIN)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_cancelaci√≥n (MENU_PRINCIPAL)": {
      "main": [
        [
          {
            "node": "Mensaje_salir_admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_salir_admin": {
      "main": [
        [
          {
            "node": "Menu Principal1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar Cita Paso inicial": {
      "main": [
        []
      ]
    },
    "Obtener_citas_verificacion_dovle_reserva": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_citas_repetidas_fecha": {
      "main": [
        [
          {
            "node": "Error Doble Reserva",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "If_citas_repetidas_fecha",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_fecha": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha Invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_hora": {
      "main": [
        [
          {
            "node": "Obtener_citas_verificacion_dovle_reserva",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Hora Invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Agendar_paso_1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha en el pasado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_fecha_reprogramar1": {
      "main": [
        [
          {
            "node": "Actualizar_estado (REPROGRAMAR_HORA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha en el pasado_reprogramar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_fecha_reprogramar1": {
      "main": [
        [
          {
            "node": "If_validar_fecha_reprogramar1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha Invalida_reprogramar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_hora_reprogramar": {
      "main": [
        [
          {
            "node": "Reprogramar_cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Hora Invalida_reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_hora_actualizar": {
      "main": [
        [
          {
            "node": "Actualizar_campo (hora)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Hora Invalida_actualizar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_fecha_reprogramar": {
      "main": [
        [
          {
            "node": "If_fecha_v√°lida_reprogramar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha Invalida_reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_fecha_v√°lida_reprogramar": {
      "main": [
        [
          {
            "node": "Actualizar_campo (fecha)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha en el pasado_reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "92b11e85-16e5-45ea-be55-6ffe96610801",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "56786992bfd0a0623dc9deb33cd7de7108a81be9d60180553dee3cf7cf3476d3"
  },
  "id": "UNNvDEf7m4lXcqrvcFKlb",
  "tags": []
}