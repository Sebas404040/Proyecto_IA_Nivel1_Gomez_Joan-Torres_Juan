{
  "name": "FLUJO MERGE COMPLETO",
  "nodes": [
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2006573822,
          "mode": "list",
          "cachedResultName": "USUARIOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=2006573822"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2880,
        31936
      ],
      "id": "c517b44c-eb6b-4525-a140-5f7e6678de6b",
      "name": "verificar_usuario",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        2656,
        31936
      ],
      "id": "42c8285d-7d5c-400c-b91e-b99fae498f5f",
      "name": "Telegram Trigger1",
      "webhookId": "b9545048-0e69-4262-a3bf-ea600b19fb38",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3328,
        31840
      ],
      "id": "b07e8b20-a3c7-4ce9-b090-0c966cd1f22e",
      "name": "verificar_sesi√≥n",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "3dc0d987-8bed-4e00-aa71-d5f8a79c1cd0",
              "leftValue": "={{ $json[\"permitido\"] }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        3104,
        31936
      ],
      "id": "477151ee-4131-4fb7-b5d9-12cbe28191c9",
      "name": "IF_usuario_existe"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "65b059c5-adb9-4fa8-b3a7-781da7836ce6",
              "leftValue": "={{ $json.pantalla_actual }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        3552,
        31936
      ],
      "id": "2947139a-e5bc-4706-a3f1-0a3c64d0fe0e",
      "name": "IF_sesion_iniciada"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_PRINCIPAL",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f3f4f434-051e-44c0-8efc-a4999d4e9480"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "2b381b4c-36e3-43b7-a1e6-85fdc2cab3f7",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "_FALLBACK",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4bc74d3f-e04d-4ba8-9ea2-b5c552e58045",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "VER_TAREAS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "a479d554-8e41-4b26-9a98-543d18fd74f0",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_AYUDA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "281d1e00-6636-4a0b-8ab8-a7be39a84856",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_TAREAS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "29fd0132-ef59-483a-87d6-466a5d27da35",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "CREAR_TAREA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5741e65f-fed6-43aa-96fa-0a1b10795853",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_HABITOS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "196d5f3c-fcab-4bad-be30-e1b901d65783",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "COMPLETAR_TAREA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "690c9dbb-afa6-4d0d-8dc9-3982d76ead11",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "BIENVENIDO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8c04cc3b-e2e5-433d-aef2-796370cb8cb3",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "COMPLETAR_HABITO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "608ed967-f735-451d-b71c-a435348fbaab",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "CREAR_HABITO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "84af09e4-a8ff-4cc2-ad09-fc1e3effb355",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_LISTAS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ef886759-8771-4f52-b158-c35475f43229",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "CREAR_LISTA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "0c611ecb-8d06-4cd8-9b87-c03f915f7ef3",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "ADD_ITEM_LISTA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ee50183a-5b65-4858-be8d-c0829faebfcc",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "AGREGAR_ITEM_A_LISTA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4000,
        31712
      ],
      "id": "c2359d53-46d1-4b9c-a3cc-5961e7cfbd46",
      "name": "CEREBRO_PRINCIPAL"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $json.telegram_user }}",
            "pantalla_actual": "BIENVENIDO",
            "paso_actual": "0",
            "timestamp_ultima_interaccion": "={{$now}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3776,
        31872
      ],
      "id": "32329a32-1a20-42e2-ab09-fe6be15126fb",
      "name": "Append_session",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto üòä vamos con tus listas üóÇÔ∏è\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva lista\n\n2. Ver mis listas\n\n3. Agregar √≠tems a una lista\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva lista).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        35344
      ],
      "id": "df204d41-4ee7-400b-9a8e-3657bf03d7cf",
      "name": "Men√∫ Listas",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Hmm ü§î esa fecha ya pas√≥.\n\nPor favor ingresa una fecha futura.\n\nVuelve a intentarlo üòÅ.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        31344
      ],
      "id": "8f7fc203-50fd-40a1-8f14-2e9a0f8b6a87",
      "name": "Fecha en el pasado",
      "webhookId": "431e9db7-ea8c-443c-bb82-65fa90992bd9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Ups üòÖ la fecha no tiene el formato correcto.\n\nRecuerda usar: YYYY-MM-DD\nEjemplo: 2025-12-20\n\nVuelve a intentarlo. üòÅ",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        31440
      ],
      "id": "64f10b5f-cf1b-4dbd-a123-cf1aacd91d38",
      "name": "Fecha Invalida",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Hola, soy AgendaBot üëã\n\nEstoy aqu√≠ para ayudarte a organizar tus citas, tareas y recordatorios\nde forma sencilla y sin complicaciones.\n\nPuedes escribirme en cualquier momento.\nPara avanzar, solo tienes que escribir el n√∫mero de la opci√≥n que quieras usar.\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nTip r√°pido:\nescribe solo el n√∫mero (por ejemplo: 1) y presiona enviar.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4224,
        29712
      ],
      "id": "02e16b10-612b-44cf-a908-570643430604",
      "name": "Bienvenida",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Ups, esa opci√≥n no existe en este men√∫ üòÖ\n\nPor favor escribe uno de los n√∫meros que ves en el menu.\n\n  üëâ Tip: escribe solo el n√∫mero (por ejemplo: 1). ",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        29328
      ],
      "id": "931bc55b-3c20-47fc-9745-986c7cefb4c4",
      "name": "Opci√≥n No Valida",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "59ec2c01-acd7-45e6-8fc0-e448481b5018",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        27120
      ],
      "id": "76f4fa44-7b6b-49b6-948a-2914ddbd9524",
      "name": "IF_ayuda"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Claro, te ayudo üòä\n\nSoy AgendaBot y puedo ayudarte a:\n\n- Agendar y gestionar citas\n\n- Crear y organizar tareas\n\n- Llevar recordatorios\n\n- Registrar h√°bitos\n\n- Crear listas personalizadas\n\nPara usarme, solo escribe el n√∫mero de la opci√≥n que quieras.\n\n¬øQu√© deseas hacer ahora?\n\n1. Ir al men√∫ principal\n\n2. Salir\n\nüí° Sugerencia:\nTe recomiendo ir al men√∫ principal (1) para empezar.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        27120
      ],
      "id": "8ea6f535-354f-468b-9b1f-4d24211c7830",
      "name": "Men√∫ Ayuda",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "3fa5b9ad-92f0-4a62-8e17-26eb334ccd80",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        27648
      ],
      "id": "5e56abc6-66ac-482b-99e0-feb20b8eaaf9",
      "name": "IF_menu_ayuda_opcion_2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "f4420a47-aa1e-4af0-a46a-cc18451837ad",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        27360
      ],
      "id": "306ebc5e-fd25-446d-9464-59031a319e2e",
      "name": "IF_menu_ayuda_opcion_1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "d6e404d8-8d75-4792-84b6-069a79cb7d26",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        27888
      ],
      "id": "1f7565e4-9a1d-43f1-9997-c7bfda47a957",
      "name": "IF_tarea"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "5630fc3c-757e-40b0-8323-6ff5372bde8a",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "4",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        29520
      ],
      "id": "80fed5c1-2a30-4237-b828-ad05bd541ecb",
      "name": "IF_habitos"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto, vamos con tus tareas üìù\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva tarea\n\n2. Ver mis tareas\n\n3. Cambiar estado de una tarea\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva tarea).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        27888
      ],
      "id": "18782cc9-1e25-47a2-8c2d-2bd9332e642e",
      "name": "Men√∫ Tareas",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Genial üòä vamos con tus h√°bitos üîÅ\n\n¬øQu√© deseas hacer?\n\n1. Crear un nuevo h√°bito\n\n2. Ver mis h√°bitos\n\n3. Activar / desactivar un h√°bito\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear un nuevo h√°bito).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        29520
      ],
      "id": "7ff137e2-6d78-45b7-bc8d-44035b050e74",
      "name": "Men√∫ Habitos",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        28128
      ],
      "id": "536aac86-ed4e-4c61-b0bd-01413eab8931",
      "name": "IF_menu_tareas_opcion_1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        28368
      ],
      "id": "276c5690-9abc-40af-90f9-7cd25d3ebd82",
      "name": "IF_menu_tareas_opcion_2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "3",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        28896
      ],
      "id": "763bfd9c-f1fa-4cdf-9ec7-c5e9b43eca17",
      "name": "IF_menu_tareas_opcion_3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "4",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        29088
      ],
      "id": "16b46445-f558-48a4-9df2-60d1d5bee041",
      "name": "IF_menu_tareas_opcion_4"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        32256
      ],
      "id": "ffce9c9b-d8b8-4129-ad89-415be18d8511",
      "name": "IF_menu_habitos_opcion_1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        32544
      ],
      "id": "cb580187-4e17-4011-99e3-993825d03cfc",
      "name": "IF_menu_habitos_opcion_2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "3",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        32976
      ],
      "id": "d5f05290-3986-4293-b1d5-9677218b6b93",
      "name": "IF_menu_habitos_opcion_3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "4",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        33168
      ],
      "id": "7548ab0d-d5ce-4488-bbf7-65364db9e14c",
      "name": "IF_menu_habitos_opcion_4"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=¬°Todo listo por ahora! üòä\n\nHe cerrado tu sesi√≥n correctamente.\n\nCuando quieras volver, solo escr√≠beme cualquier mensaje\ny retomamos desde el men√∫ principal.\n\n¬°Que tengas un excelente d√≠a! üëã",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        27696
      ],
      "id": "c07b2da9-e10d-4a44-af0c-e3c08788ee78",
      "name": "Mensaje de Salida",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_AYUDA"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        27120
      ],
      "id": "8bb67d09-a784-4c8e-833f-4afd0293f73b",
      "name": "Update State MENU_AYUDA",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        27312
      ],
      "id": "9414f7e8-9ea7-42df-8a98-bc00181a4e49",
      "name": "Menu Principal_",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_PRINCIPAL"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        27312
      ],
      "id": "d66c29fa-383a-42c9-aa6d-44e6489918a6",
      "name": "Update State MENU_PRINCIPAL",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "BIENVENIDA"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        27696
      ],
      "id": "4604e07d-62e3-4081-a57c-69e6d7db1869",
      "name": "Update State BIENVENIDA",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_TAREAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        27888
      ],
      "id": "f9e10f3e-f8e5-4b53-99a0-c75cbb121df4",
      "name": "Update State MENU_TAREAS",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Genial üòä vamos a crear tu tarea.\n\nPaso 1 de 4 ‚Äî T√≠tulo\n\n¬øCu√°l es el t√≠tulo de la tarea?\n\nEscribe una frase corta y clara.\n\nEjemplo:\nPreparar presentaci√≥n del lunes\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        28080
      ],
      "id": "606066fe-aa48-4281-abf1-1bd14532e29f",
      "name": "Crear Tarea Paso 1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "CREAR_TAREA",
            "paso_actual": "1"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        28080
      ],
      "id": "12ba241e-2789-462a-bcb8-87968577aea3",
      "name": "Update State CREAR TAREA - PASO 1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.paso_actual }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    },
                    "id": "5dd6228f-228c-4aa8-8216-762179799a50"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "6082eeb4-8f82-44e9-b24e-fb33addcb845",
                    "leftValue": "={{ $json.paso_actual }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8e9650e2-ceb9-42bb-adbc-9b34fb9c7285",
                    "leftValue": "={{ $json.paso_actual }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "98c64646-fbe1-4613-a061-b9ff1ed3a97a",
                    "leftValue": "={{ $json.paso_actual }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        30896
      ],
      "id": "61f56a93-2308-42fd-a533-480a4363ccc6",
      "name": "Pasos Tareas",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto üëç\n\nPaso 2 de 4 ‚Äî Prioridad\n\n¬øQu√© prioridad tiene esta tarea?\n\n1. Alta\n\n2. Media\n\n3. Baja\n\n4. Cancelar\n\nüí° Sugerencia:\nNormalmente se usa 2 (Media).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        30192
      ],
      "id": "4dc1e489-117a-4a6e-9873-65bfbeea1cdf",
      "name": "Crear Tarea Paso 2",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Muy bien üòä\n\nPaso 3 de 4 ‚Äî Fecha objetivo\n\n¬øPara qu√© fecha te gustar√≠a completar esta tarea?\n\nFormato: YYYY-MM-DD\nEjemplo: 2025-02-15\n\n9. Cancelar\n\nüí° Sugerencia:\nSi no tienes una fecha exacta,\npuedes usar una aproximada y la puedes editar a futuro üòä",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        30480
      ],
      "id": "b21425b9-2f21-4b30-a9b0-78f9a0dbfb8b",
      "name": "Crear Tarea Paso 3",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "datos_parciales": "={{\n{\"titulo\":$('Telegram Trigger1').item.json.message.text,\"prioridad\": \"\",\n\"estado\":\"PENDIENTE\",\n\"fecha_objetivo\":\"\",\n\"creado_por\":$('Telegram Trigger1').item.json.message.from.id}\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        30192
      ],
      "id": "02413da0-574b-48df-80bb-bc6fcd81a3b3",
      "name": "Update DATOS PARCIALES TITULO",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text.trim() }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f927f65c-783e-4952-8515-93dc69250e56"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b537dbbf-00e3-4e29-9bd1-9afb646665f2",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text.trim() }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "9202ef44-4e06-4733-ace3-962bce73f83b",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text.trim() }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "1e3b64ac-9751-4922-a393-a024840743d3",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text.trim() }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4672,
        30736
      ],
      "id": "6735c036-8960-446a-b437-2a37022765e9",
      "name": "Switch1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0b302e9e-e735-4a8a-8914-438078516210",
              "name": "datos_parciales",
              "value": "={{\n  Object.assign(\n    $('IF_sesion_iniciada').item.json.datos_parciales.parseJson(),\n    { prioridad: \"ALTA\" }\n  )\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4896,
        30384
      ],
      "id": "e347386c-a73d-472d-a902-0fc886154398",
      "name": "PARSE AND ADD PRIORIDAD ALTA"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0b302e9e-e735-4a8a-8914-438078516210",
              "name": "datos_parciales",
              "value": "={{\n  Object.assign(\n    $('IF_sesion_iniciada').item.json.datos_parciales.parseJson(),\n    { prioridad: \"MEDIA\" }\n  )\n}}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4896,
        30576
      ],
      "id": "6a56ba05-e383-4c06-a4f8-a6f7f77c1df9",
      "name": "PARSE AND ADD PRIORIDAD MEDIA"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0b302e9e-e735-4a8a-8914-438078516210",
              "name": "datos_parciales",
              "value": "={{\n  Object.assign(\n    $('IF_sesion_iniciada').item.json.datos_parciales.parseJson(),\n    { prioridad: \"BAJA\" }\n  )\n}}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4896,
        30768
      ],
      "id": "e5068106-5e7b-4e3e-ae47-51669d6c0501",
      "name": "PARSE AND ADD PRIORIDAD BAJA"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto, vamos con tus tareas üìù\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva tarea\n\n2. Ver mis tareas\n\n3. Cambiar estado de una tarea\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva tarea).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        30960
      ],
      "id": "cd1e9ab3-4e92-4bca-bd19-9fa7286af0be",
      "name": "Men√∫ Tareas1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_TAREAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        30960
      ],
      "id": "3081e935-daec-4c91-b5b1-086d7a079450",
      "name": "Update State MENU_TAREAS1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Est√° bien üòä\n\nHe cancelado la creaci√≥n de la tarea.\n\nVolviendo al men√∫ tareas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        30960
      ],
      "id": "a884fa9f-45e9-44b4-a05c-76a0deaefe88",
      "name": "TEXTO CANCELACION TAREA",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_HABITOS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        29520
      ],
      "id": "573dec26-9e21-4b4d-8a15-5808cfa9e897",
      "name": "Update State MENU_HABITOS",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "paso_actual": "3"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5568,
        30480
      ],
      "id": "cba413bb-1a42-448d-bf25-648a7dc56fbb",
      "name": "Update State CREAR TAREA - PASO 3",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "4463328a-2d11-4ad0-8d40-59e3c62d6419",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^(19|20)\\d{2}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|02-(?:0[1-9]|1\\d|2[0-8]))$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        31344
      ],
      "id": "2fa22a35-8140-40ee-9dbe-9ddb142ad3fc",
      "name": "Fecha Formato Valido?"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "paso_actual": "4"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5792,
        31152
      ],
      "id": "c22feabe-8456-4728-b6fb-b703d27e050b",
      "name": "Update State CREAR TAREA - PASO 4  ",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "f741d9d5-3078-4d39-92ac-9f635887baec",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "={{ $now.format('yyyy-MM-dd') }}",
              "operator": {
                "type": "dateTime",
                "operation": "afterOrEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4896,
        31248
      ],
      "id": "d826935d-2140-4bd0-9caa-20edfaa4ebef",
      "name": "Fecha Futura?"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0b302e9e-e735-4a8a-8914-438078516210",
              "name": "datos_parciales",
              "value": "={{\n  Object.assign(\n    $('IF_sesion_iniciada').item.json.datos_parciales.parseJson(),\n    { fecha_objetivo: $('Telegram Trigger1').item.json.message.text }\n  )\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5120,
        31152
      ],
      "id": "24a917d0-1608-4c6e-9d43-505bb74f2c66",
      "name": "PARSE AND ADD FECHA OBJETIVO"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "datos_parciales": "={{ $json.datos_parciales }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        31152
      ],
      "id": "848534fb-ed4b-414d-a1a7-4415a4a35361",
      "name": "Update DATOS PARCIALES E1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "datos_parciales": "={{ $json.datos_parciales }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        30480
      ],
      "id": "0a7f4edd-ca48-4444-9c9e-7416152a079a",
      "name": "Update DATOS PARCIALES PRIORIDAD",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Revisa la informaci√≥n de tu tarea üëÄ\n\nT√≠tulo: {{ $json.datos_parciales.parseJson().titulo }}\nPrioridad: {{ $json.datos_parciales.parseJson().prioridad }}\nFecha objetivo: {{ $json.datos_parciales.parseJson().fecha_objetivo }}\nEstado: {{ $json.datos_parciales.parseJson().estado }}\n\n¬øQu√© deseas hacer?\n\n1. Confirmar y guardar\n\n2. Cancelar\n\nüí° Sugerencia:\nTe recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        31152
      ],
      "id": "aca9d64e-65ef-48f3-aae5-b60b4060e29c",
      "name": "Crear Tarea PASO 3 Confirmaci√≥n",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text.trim() }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "3b662b24-d82b-4ace-a3ca-d319919fd413"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "c52b8a1e-cdc0-4dd4-a5c8-3139b9c94dcf",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text.trim() }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4672,
        31728
      ],
      "id": "13b22ab2-c1d2-4934-a09d-839c6d9b44af",
      "name": "Confirmar tarea?"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 817811180,
          "mode": "list",
          "cachedResultName": "TAREAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=817811180"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "titulo": "={{ $json.datos_parciales.parseJson().titulo }}",
            "prioridad": "={{ $json.datos_parciales.parseJson().prioridad }}",
            "estado": "={{ $json.datos_parciales.parseJson().estado }}",
            "creado_por": "={{ $json.datos_parciales.parseJson().creado_por }}",
            "fecha_objetivo": "={{ $json.datos_parciales.parseJson().fecha_objetivo }}",
            "id_tarea": "={{ $json.tarea_id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_tarea",
              "displayName": "id_tarea",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "titulo",
              "displayName": "titulo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "prioridad",
              "displayName": "prioridad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_objetivo",
              "displayName": "fecha_objetivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        31632
      ],
      "id": "02c9fb61-8668-4486-bd96-b11318ab547c",
      "name": "Append TAREA",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        31632
      ],
      "id": "4e963199-3a54-4ffd-9d03-03dae682abd2",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "tarea_id"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        5120,
        31632
      ],
      "id": "fcde72da-6e59-4366-bf4f-d287fa91ecf7",
      "name": "Crypto"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "¬°Listo! üéâ\n\nTu tarea fue creada correctamente.\n\nVolviendo al men√∫ de tareas",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        31632
      ],
      "id": "1c69ba74-2770-4f7d-9ce5-40f3822c0d90",
      "name": "Tarea Guardada Correctamente",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        4896,
        28368
      ],
      "id": "b21b31b8-af08-41df-8bc0-ae5e790f4f4a",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=-------------------------------------------------------------\n\nT√≠tulo: {{ $json.titulo }}\nPrioridad: {{ $json.prioridad }}\nFecha objetivo: {{ $json.fecha_objetivo }}\nEstado: {{ $json.estado }} {{ $json.estado === 'COMPLETADO' ? '‚úÖ' : '‚õî' }}\n\n-------------------------------------------------------------",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        28368
      ],
      "id": "32cbbcd2-f75f-49c8-9961-20e7c9652bd9",
      "name": "Mostrar Tarea Mensaje",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Est√° bien üòä\n\nHe cancelado la creaci√≥n de la tarea.\n\nVolviendo al men√∫ tareas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        31824
      ],
      "id": "86b4fd96-aa1f-45b3-afda-f6d5d6d97f46",
      "name": "Cancelado Creaci√≥n Tarea Texto",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_TAREAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6016,
        31728
      ],
      "id": "7900acab-7cde-4dab-8a0f-03f73f4c6b1f",
      "name": "Update State MENU_TAREAS2",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto, vamos con tus tareas üìù\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva tarea\n\n2. Ver mis tareas\n\n3. Cambiar estado de una tarea\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva tarea).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5792,
        31728
      ],
      "id": "45577752-69d3-4a3d-b9d7-6da5d4166989",
      "name": "Men√∫ Tareas2",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Est√° bien üòä\n\nHe cancelado la creaci√≥n de la tarea.\n\nVolviendo al men√∫ tareas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        32016
      ],
      "id": "dde68d66-5c32-4f91-b7a2-03b83618c573",
      "name": "Cancelado Creaci√≥n Tarea Texto1",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_TAREAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        32016
      ],
      "id": "c8082534-1eae-4264-9bf7-cae48a8e1edf",
      "name": "Update State MENU_TAREAS4",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto, vamos con tus tareas üìù\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva tarea\n\n2. Ver mis tareas\n\n3. Cambiar estado de una tarea\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva tarea).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        32016
      ],
      "id": "ac996382-ed0f-4772-820b-600409271e00",
      "name": "Men√∫ Tareas4",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        29136
      ],
      "id": "b3651abf-196f-41e1-b398-24b18e807f82",
      "name": "Menu Principal_1",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_PRINCIPAL"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        29136
      ],
      "id": "4d761bc9-a34d-43cd-9776-44a3affbf550",
      "name": "Update State MENU_PRINCIPAL1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        4896,
        29328
      ],
      "id": "48411dc4-ee2d-4fbb-8f6b-63a8f0bf26e1",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=-------------------------------------------------------------\n\nID: {{ $json.id_tarea }}\nT√≠tulo: {{ $json.titulo }}\nPrioridad: {{ $json.prioridad }}\nFecha objetivo: {{ $json.fecha_objetivo }}\nEstado: {{ $json.estado }} {{ $json.estado === 'COMPLETADO' ? '‚úÖ' : '‚õî' }}\n\n-------------------------------------------------------------",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        29328
      ],
      "id": "8db72377-6f93-428e-83e1-75ac03230ab6",
      "name": "Mostrar Tarea Mensaje1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Dame el id de la tarea que desees marcar como completada üòÅ.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        29136
      ],
      "id": "15927724-a50b-45c0-bb2a-036104571f96",
      "name": "Pedir ID Tarea para completar",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "paso_actual": "1",
            "pantalla_actual": "COMPLETAR_TAREA"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        29136
      ],
      "id": "3d3780cb-5e9a-434f-9c19-c62d2705a683",
      "name": "Update State COMPLETAR TAREA - PASO 1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 817811180,
          "mode": "list",
          "cachedResultName": "TAREAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=817811180"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_tarea": "={{ $('Telegram Trigger1').item.json.message.text }}",
            "estado": "COMPLETADO"
          },
          "matchingColumns": [
            "id_tarea"
          ],
          "schema": [
            {
              "id": "id_tarea",
              "displayName": "id_tarea",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "titulo",
              "displayName": "titulo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "prioridad",
              "displayName": "prioridad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_objetivo",
              "displayName": "fecha_objetivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4224,
        29904
      ],
      "id": "52b2079c-3f3c-4c71-a268-9932ec1f99b1",
      "name": "Update row Marcar Tarea Completada",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto, vamos con tus tareas üìù\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva tarea\n\n2. Ver mis tareas\n\n3. Cambiar estado de una tarea\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva tarea).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        28176
      ],
      "id": "ad500540-ce69-4642-a3a5-e5d9f467638b",
      "name": "Men√∫ Tareas5",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_TAREAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        28176
      ],
      "id": "ee6e461d-f5f7-421e-aa03-5610449bc26a",
      "name": "Update State MENU_TAREAS5",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "ddd619b2-6740-45de-a958-a8bf36816a53",
              "leftValue": "={{ $json.id_tarea }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4448,
        29904
      ],
      "id": "4c4f5c6b-dabc-4326-9dc8-a80972b82303",
      "name": "Se actualizo correcto?"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Excelente üòä\n\nSe a marcado la tarea de ID:{{ $('Update row Marcar Tarea Completada').item.json.id_tarea }} , como completada\n\nVolviendo al men√∫ tareas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        29808
      ],
      "id": "67688cea-40b3-441b-9b57-1f5dcb913d59",
      "name": "TAREA ACTUALIZADA TEXTO",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Oh oh, no hemos encontrado ninguna tarea con esa ID ü•∫\n\nVolviendo al men√∫ tareas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        30000
      ],
      "id": "8b5c9440-4c05-4b84-b786-0496a5fbe67b",
      "name": "VOLVIENDO MENU TAREAS TEXTO",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto, vamos con tus tareas üìù\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva tarea\n\n2. Ver mis tareas\n\n3. Cambiar estado de una tarea\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva tarea).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        29904
      ],
      "id": "77004b6e-adb7-4fee-a703-5031e7b4c967",
      "name": "Men√∫ Tareas6",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_TAREAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        29904
      ],
      "id": "f78ff755-acfa-47b1-b0f9-c4c1ee03d73d",
      "name": "Update State MENU_TAREAS6",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2006573822,
          "mode": "list",
          "cachedResultName": "USUARIOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=2006573822"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "nombre": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}",
            "rol": "USER",
            "permitido": "TRUE"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "rol",
              "displayName": "rol",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "permitido",
              "displayName": "permitido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3328,
        32032
      ],
      "id": "f0d26315-4ffd-45ff-a873-df67367a32e8",
      "name": "Crear Usuario",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_PRINCIPAL"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        29712
      ],
      "id": "fd4aacc9-742c-49ca-9ee3-3142fa850bd3",
      "name": "Update State MENU_PRINCIPAL2",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "5afdbbd6-d21b-4fe1-b42f-dc891e23d7f3",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "18ea7c38-a443-4c28-b1c7-e3ae748007d3",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "3",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "a33cff58-dafb-484a-82eb-44bc6bd4d0ce",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=4",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        29328
      ],
      "id": "517a7ab9-8ea2-48d5-9698-0b964679c976",
      "name": "IF_menu_tareas_opcion_no_valida"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto, vamos con tus tareas üìù\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva tarea\n\n2. Ver mis tareas\n\n3. Cambiar estado de una tarea\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva tarea).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        29328
      ],
      "id": "65785642-f232-453b-a769-b209c202da8a",
      "name": "Men√∫ Tareas7",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Genial üòä vamos a crear tu h√°bito.\n\nPaso 1 de 4 ‚Äî Nombre\n\n¬øC√≥mo se llama el h√°bito?\n\nEscribe una frase corta y clara.\n\nEjemplo:\nTomar 2 litros de agua\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        32208
      ],
      "id": "4c21f278-548c-4518-ad75-c098e97e0ad0",
      "name": "CREAR HABITO PASO 1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "befa34cd-bb19-4c26-94a2-8c4711de9bb9",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        30960
      ],
      "id": "5b929d82-5f12-4037-804b-46a78eef2e50",
      "name": "IF no cancelar crear tarea?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "befa34cd-bb19-4c26-94a2-8c4711de9bb9",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        34160
      ],
      "id": "6262b2da-301d-4e54-9fb3-e2790d4d2b62",
      "name": "IF no cancelar crear habito?"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.paso_actual }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "d71c40af-b85a-44be-9408-6e0c697ea94b"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "2c3caf4c-3b74-485b-8391-a38442e1d7e0",
                    "leftValue": "={{ $json.paso_actual }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "854d4ea5-7853-4137-ab76-1ce938e854e0",
                    "leftValue": "={{ $json.paso_actual }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "681e83b5-68c5-4d1c-abc0-0c93aea12581",
                    "leftValue": "={{ $json.paso_actual }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        34128
      ],
      "id": "640088ee-2903-4007-99b1-4a7061ea4dc5",
      "name": "Pasos Habitos"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Est√° bien üòä\n\nHe cancelado la creaci√≥n del habito.\n\nVolviendo al men√∫ de h√°bitos.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        34864
      ],
      "id": "ba023dde-4bca-405e-bd70-0855e2c0e687",
      "name": "Cancelado Creaci√≥n Habito",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Genial üòä vamos con tus h√°bitos üîÅ\n\n¬øQu√© deseas hacer?\n\n1. Crear un nuevo h√°bito\n\n2. Ver mis h√°bitos\n\n3. Activar / desactivar un h√°bito\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear un nuevo h√°bito).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        34864
      ],
      "id": "8a89b470-14d7-4089-a109-b914343e5090",
      "name": "Men√∫ Habitos1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_HABITOS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        34864
      ],
      "id": "d55c2cf7-1652-45ec-be57-5af62820900a",
      "name": "Update State MENU_HABITOS1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "paso_actual": "2"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        33312
      ],
      "id": "a0001663-ecec-4008-a86b-35213709452d",
      "name": "Update State CREAR HABITO - PASO 2",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "CREAR_HABITO",
            "paso_actual": "1"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        32208
      ],
      "id": "ac783d81-f495-4e7f-9fb2-cf3795a210ac",
      "name": "Update State CREAR HABITO - PASO 1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "datos_parciales": "={{\n{\"nombre\":$('Telegram Trigger1').item.json.message.text,\"prioridad\": \"\",\n\"frecuencia\":\"\",\n\"estado\":\"ACTIVO\",\n\"hora_recordatorio\":\"\",\n\"creado_por\":$('Telegram Trigger1').item.json.message.from.id}\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        33312
      ],
      "id": "7f9a42f1-eacd-41f3-bff8-c1bf216da1de",
      "name": "Update DATOS PARCIALES Nombre HABITO",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text.trim() }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f927f65c-783e-4952-8515-93dc69250e56"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b537dbbf-00e3-4e29-9bd1-9afb646665f2",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text.trim() }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "9202ef44-4e06-4733-ace3-962bce73f83b",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text.trim() }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4672,
        33968
      ],
      "id": "c74b0b70-db44-47fe-ac56-30dabd698e25",
      "name": "Switch2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0b302e9e-e735-4a8a-8914-438078516210",
              "name": "datos_parciales",
              "value": "={{\n  Object.assign(\n    $('IF_sesion_iniciada').item.json.datos_parciales.parseJson(),\n    { frecuencia: \"DIARIA\" }\n  )\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4896,
        33696
      ],
      "id": "0f52dbe2-ab95-44a0-b3ca-05af214e5b89",
      "name": "PARSE AND ADD PRIORIDAD ALTA1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0b302e9e-e735-4a8a-8914-438078516210",
              "name": "datos_parciales",
              "value": "={{\n  Object.assign(\n    $('IF_sesion_iniciada').item.json.datos_parciales.parseJson(),\n    { prioridad: \"SEMANAL\" }\n  )\n}}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4896,
        33888
      ],
      "id": "4b3c0b93-2f49-4d31-8ab6-cff16f11fbc7",
      "name": "PARSE AND ADD PRIORIDAD MEDIA1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0b302e9e-e735-4a8a-8914-438078516210",
              "name": "datos_parciales",
              "value": "={{\n  Object.assign(\n    $('IF_sesion_iniciada').item.json.datos_parciales.parseJson(),\n    { prioridad: \"MENSUAL\" }\n  )\n}}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4896,
        34080
      ],
      "id": "5a56a057-8002-4371-aba9-a7b0b5ddfa0c",
      "name": "PARSE AND ADD PRIORIDAD BAJA1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "datos_parciales": "={{ $json.datos_parciales }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        33792
      ],
      "id": "3af07802-afe2-48b9-9464-644278f97b66",
      "name": "Update DATOS PARCIALES FRECUENCIA Crear Habito",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Muy bien üòä\n\nPaso 3 de 4 ‚Äî Hora de recordatorio\n\n¬øA qu√© hora te gustar√≠a que te recuerde este h√°bito?\n\nFormato 24 horas: HH:MM\nEjemplo: 08:00\n\n9. Cancelar\n\nüí° Sugerencia:\nUna buena hora suele ser en la ma√±ana üòä",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        33792
      ],
      "id": "f2cc50d7-cbf6-4919-a1ca-70b5e9dfa4a7",
      "name": "Crear Habito Paso 3",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto üëç\n\nPaso 2 de 4 ‚Äî Frecuencia\n\n¬øCon qu√© frecuencia quieres realizar este h√°bito?\n\n1. Diario\n\n2. Semanal\n\n3. Mensual\n\n9. Cancelar\n\nüí° Sugerencia:\nNormalmente se usa 1 (Diario).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        33312
      ],
      "id": "1e2b8dd5-e107-4f22-b9eb-93fba239ce6f",
      "name": "Crear Habito Paso 2",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "paso_actual": "3"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5568,
        33792
      ],
      "id": "544238e6-a67c-4e88-ba7b-7a9754f678dc",
      "name": "Update State CREAR HABITO - PASO 3",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Ups üòÖ la hora no tiene un formato v√°lido.\n\nRecuerda usar formato 24 horas:\nHH:MM\n\nEjemplo: 08:00\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        34464
      ],
      "id": "9d918a1d-5b01-4abf-9eee-6c9134fea2b2",
      "name": "Fecha Invalida1",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "4463328a-2d11-4ad0-8d40-59e3c62d6419",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^([01]\\d|2[0-3]):[0-5]\\d$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        34368
      ],
      "id": "bb3c3755-6516-4d15-bc89-6c49d9eea395",
      "name": "Fecha Formato Valido?1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "paso_actual": "4"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5568,
        34272
      ],
      "id": "e413a927-cac0-43ce-912a-1db4d099f4a2",
      "name": "Update State CREAR TAREA - PASO 4  1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0b302e9e-e735-4a8a-8914-438078516210",
              "name": "datos_parciales",
              "value": "={{\n  Object.assign(\n    $('IF_sesion_iniciada').item.json.datos_parciales.parseJson(),\n    { hora_recordatorio: $('Telegram Trigger1').item.json.message.text }\n  )\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4896,
        34272
      ],
      "id": "9b442ffc-4b66-480a-9859-78a8f97fc4e1",
      "name": "PARSE AND ADD Hora Recordatorio Habito"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "datos_parciales": "={{ $json.datos_parciales }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        34272
      ],
      "id": "5401364a-ea61-43d3-be26-e0b4c634f33e",
      "name": "Update DATOS PARCIALES HORA Crear Habito",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Revisa la informaci√≥n de tu h√°bito üëÄ\n\nNombre: {{ $json.datos_parciales.parseJson().nombre }}\nFrecuencia: {{$json.datos_parciales.parseJson().frecuencia}}\nHora de recordatorio: {{$json.datos_parciales.parseJson().hora_recordatorio}}\nEstado: {{$json.datos_parciales.parseJson().estado}}\n\n¬øQu√© deseas hacer?\n\n1. Confirmar y guardar\n\n9. Cancelar\n\nüí° Sugerencia:\nTe recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        34272
      ],
      "id": "0cb3e6bb-d947-4e12-824a-b3c97dd7bce1",
      "name": "Crear Habito PASO 3 Confirmaci√≥n1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Genial üòä vamos con tus h√°bitos üîÅ\n\n¬øQu√© deseas hacer?\n\n1. Crear un nuevo h√°bito\n\n2. Ver mis h√°bitos\n\n3. Activar / desactivar un h√°bito\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear un nuevo h√°bito).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        34656
      ],
      "id": "d0f2c0cb-1dd9-49f9-a2b5-e8a94113e32a",
      "name": "Men√∫ Habitos2",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_HABITOS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5792,
        34656
      ],
      "id": "2b3463ff-a21b-4cd1-9594-1066f5dff113",
      "name": "Update State MENU_HABITOS2",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        34656
      ],
      "id": "63a6aacd-e797-477d-a3fe-e85b6a98525c",
      "name": "Get row(s) in sheet3",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "habito_id"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        4896,
        34656
      ],
      "id": "31a62b5b-0d9a-4c32-89c0-3945ba93da7a",
      "name": "Crypto1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1702648085,
          "mode": "list",
          "cachedResultName": "HABITOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1702648085"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_habito": "={{ $json.habito_id }}",
            "nombre": "={{ $json.datos_parciales.parseJson().nombre }}",
            "hora_recordatorio": "={{ $json.datos_parciales.parseJson().hora_recordatorio }}",
            "frecuencia": "={{ $json.datos_parciales.parseJson().frecuencia }}",
            "estado": "={{ $json.datos_parciales.parseJson().estado }}",
            "creado_por": "={{ $json.datos_parciales.parseJson().creado_por }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_habito",
              "displayName": "id_habito",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "frecuencia",
              "displayName": "frecuencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_recordatorio",
              "displayName": "hora_recordatorio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        34656
      ],
      "id": "e8b69e1f-f541-467d-a2e4-d929e7395e08",
      "name": "Append HABITO",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "¬°Listo! üéâ\n\nTu h√°bito fue creado correctamente.\n\nVolviendo al men√∫ de habitos",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        34656
      ],
      "id": "ca270327-0861-44ab-8e9f-300d866ec88e",
      "name": "Habito Guardado Correctamente",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        33216
      ],
      "id": "2b7aea20-121f-4179-96ca-5eb3f2b2dbf8",
      "name": "Menu Principal_2",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_PRINCIPAL"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        33216
      ],
      "id": "04e86ba0-b5e3-4533-b3de-58759f7a55b6",
      "name": "Update State MENU_PRINCIPAL3",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 817811180,
          "mode": "list",
          "cachedResultName": "TAREAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=817811180"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        28464
      ],
      "id": "4bb138e5-4d92-46e9-b5d2-8b3361123c0c",
      "name": "Get row(s) Traer Tareas",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 817811180,
          "mode": "list",
          "cachedResultName": "TAREAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=817811180"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.id }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "PENDIENTE"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        28944
      ],
      "id": "b8682689-e582-4542-aa3b-b1a20ff5ad37",
      "name": "Get row(s) Traer Tareas No Completadas2",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        4896,
        32400
      ],
      "id": "298a42b9-e705-4653-8c17-ae227099fd72",
      "name": "Loop Over Items2"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1702648085,
          "mode": "list",
          "cachedResultName": "HABITOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1702648085"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        32592
      ],
      "id": "075f5e09-f45b-4edc-8b67-a0f581862478",
      "name": "Get row(s) Traer Habitos",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Genial üòä vamos con tus h√°bitos üîÅ\n\n¬øQu√© deseas hacer?\n\n1. Crear un nuevo h√°bito\n\n2. Ver mis h√°bitos\n\n3. Activar / desactivar un h√°bito\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear un nuevo h√°bito).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        32160
      ],
      "id": "a4b1a837-d8b9-45c8-8d6c-a352d8a80b11",
      "name": "Men√∫ Habitos3",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_HABITOS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        32160
      ],
      "id": "381c32b3-3daf-40bd-af64-45af8da60f29",
      "name": "Update State MENU_HABITOS3",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        4896,
        33120
      ],
      "id": "ab281811-f354-4bde-8a43-8261c72658c2",
      "name": "Loop Over Items3"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=-------------------------------------------------------------\nID: {{ $json.id_habito }}\nNombre: {{ $json.nombre }}\nFrecuencia: {{ $json.frecuencia }}\nHora de recordatorio: {{ $json.hora_recordatorio }}\nEstado: {{ $json.estado }} {{ $json.estado == 'ACTIVO' ? '‚úÖ' : '‚õî' }}\n\n-------------------------------------------------------------",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        33120
      ],
      "id": "968732aa-87f6-496a-a1d8-8b3df0890dd5",
      "name": "Mostrar Tarea Mensaje3",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "paso_actual": "1",
            "pantalla_actual": "COMPLETAR_HABITO"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        32928
      ],
      "id": "71e3667f-ba57-4543-bdc4-a649da5ec53a",
      "name": "Update State COMPLETAR TAREA - PASO ",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1702648085,
          "mode": "list",
          "cachedResultName": "HABITOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1702648085"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        33024
      ],
      "id": "7fc5ff50-d856-4fd4-8de7-7cab75057982",
      "name": "Get row(s) Traer Habitos1",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Dame el id de la tarea para cambiar su estado (ACTIVADA -> DESACTIVADA) o (DESACTIVADA -> ACTIVADA) üòÅ.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        32928
      ],
      "id": "8d53d5e1-9803-4a33-8c67-3f09beda449d",
      "name": "Pedir ID Habito para Toogle",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "ddd619b2-6740-45de-a958-a8bf36816a53",
              "leftValue": "={{ $json.id_habito }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        35152
      ],
      "id": "ae0bdf06-5165-4799-a250-1231b31d3ddd",
      "name": "Se actualizo correcto?1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Oh oh, no hemos encontrado ningun habito con esa ID ü•∫\n\nVolviendo al men√∫ habitos.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        35392
      ],
      "id": "41036acb-de22-41bf-a733-36b89cfe4502",
      "name": "VOLVIENDO MENU TAREAS TEXTO1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1702648085,
          "mode": "list",
          "cachedResultName": "HABITOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1702648085"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4224,
        35152
      ],
      "id": "68e57c44-b49b-4446-b4f7-1c52c5c6ae23",
      "name": "Get row(s) in sheet2",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1702648085,
          "mode": "list",
          "cachedResultName": "HABITOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1702648085"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "estado": "={{ $json.estado == 'ACTIVO' ? 'DESACTIVADO' : 'ACTIVO' }}",
            "id_habito": "={{ $json.id_habito }}"
          },
          "matchingColumns": [
            "id_habito"
          ],
          "schema": [
            {
              "id": "id_habito",
              "displayName": "id_habito",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "frecuencia",
              "displayName": "frecuencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_recordatorio",
              "displayName": "hora_recordatorio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        35152
      ],
      "id": "f8228335-f301-4e1c-b1bd-e4602a9f2bc8",
      "name": "Update row Marcar Habito Activado / Desactivado",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Excelente üòä\n\nSe a marcado el habito de ID:{{ $('Update row Marcar Habito Activado / Desactivado').item.json.id_habito }} , como {{ $('Update row Marcar Habito Activado / Desactivado').item.json.estado }}\n\nVolviendo al men√∫ tareas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        35056
      ],
      "id": "8da4b881-8b87-4a36-871b-4d0c1e815e04",
      "name": "HABITO ACTUALIZADA TEXTO1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Genial üòä vamos con tus h√°bitos üîÅ\n\n¬øQu√© deseas hacer?\n\n1. Crear un nuevo h√°bito\n\n2. Ver mis h√°bitos\n\n3. Activar / desactivar un h√°bito\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear un nuevo h√°bito).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        35152
      ],
      "id": "5342d5a5-83b0-4ae2-aae6-bdf241477d56",
      "name": "Men√∫ Habitos4",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_HABITOS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        35152
      ],
      "id": "c44ba5d1-2b6a-4024-8cd4-a9244a7e5674",
      "name": "Update State MENU_HABITOS4",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "paso_actual": "2"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        30192
      ],
      "id": "170eed76-e75c-4963-8d95-13ba3fbaeabc",
      "name": "Update State CREAR HABITO- PASO 2",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "72667c0d-ae70-4412-83b6-eaa1e51c4dd7",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        33408
      ],
      "id": "c24ed913-16f0-4244-bf96-137e7fbac7bf",
      "name": "If"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Ups üòÖ el nombre del h√°bito no puede estar vac√≠o.\n\nPor favor escribe un nombre m√°s claro.\n\nEjemplo:\nTomar 2 litros de agua\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        33504
      ],
      "id": "b83abdc2-f37c-420a-9cf8-a0552b204a71",
      "name": "Invalido NOMBRE HABITO VACIO",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "3f462906-3232-4515-a2f9-68ad75e6194f",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        32592
      ],
      "id": "443bb154-93ca-4432-a10f-d7832a2d772b",
      "name": "IF TIENE HABITOS?"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Ups üòÖ primero debes de crear un habito.\n\nPuedes hacerlo desde el men√∫ de h√°bitos usando la opci√≥n 1.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        32736
      ],
      "id": "9e25d875-deaf-4768-812b-85ce865bdcb1",
      "name": "NO TIENE HABITOS",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "3f462906-3232-4515-a2f9-68ad75e6194f",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        33024
      ],
      "id": "27275bd3-c1e5-419e-a6f1-7df19692f310",
      "name": "IF TIENE HABITOS?1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Genial üòä vamos con tus h√°bitos üîÅ\n\n¬øQu√© deseas hacer?\n\n1. Crear un nuevo h√°bito\n\n2. Ver mis h√°bitos\n\n3. Activar / desactivar un h√°bito\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear un nuevo h√°bito).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        32736
      ],
      "id": "350322c9-74a6-4411-85a2-bc46fe7a5c19",
      "name": "Men√∫ Habitos5",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_HABITOS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        32736
      ],
      "id": "85a02fe4-6678-456d-9f30-4324231617cd",
      "name": "Update State MENU_HABITOS5",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "5630fc3c-757e-40b0-8323-6ff5372bde8a",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "5",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        35344
      ],
      "id": "a21976fc-a9b0-4807-b84e-6ab5cb5d2db4",
      "name": "IF_Listas"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_LISTAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        35344
      ],
      "id": "f6406242-ddf4-44bc-9cc3-6cbda2d8ad01",
      "name": "Update State MENU_LISTAS",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        35584
      ],
      "id": "90f341d4-a8ef-4660-9e7f-5a3ca846e04e",
      "name": "IF_menu_listas_opcion_1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        35872
      ],
      "id": "4c85e86d-0a20-4924-9b6e-0150e34f1584",
      "name": "IF_menu_listas_opcion_2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "3",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        36400
      ],
      "id": "9351ce50-3866-4afe-beb0-659783ee6961",
      "name": "IF_menu_listas_opcion_3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "26055ed2-afa9-44d1-a964-3c0b488a582c",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "4",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        36592
      ],
      "id": "eac2a2a3-f85b-4d8d-92b2-8a6de01ebd5e",
      "name": "IF_menu_listas_opcion_4"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Genial üòä vamos a crear tu lista.\n\nPaso 1 de 2 ‚Äî Nombre\n\n¬øC√≥mo se llamar√° la lista?\n\nEscribe un nombre corto y claro.\n\nEjemplo:\nCompras del supermercado\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        35536
      ],
      "id": "e5a5b4d8-fc46-49c6-ab97-303c6d35aff7",
      "name": "Crear Lista Paso 1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "CREAR_LISTA",
            "paso_actual": "1"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        35536
      ],
      "id": "7b5f9a17-71f2-4c46-b23d-ec1143188953",
      "name": "Update State CREAR LISTAS - PASO 1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "befa34cd-bb19-4c26-94a2-8c4711de9bb9",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        37024
      ],
      "id": "249402b5-37dc-4715-89b6-a08ace020f1f",
      "name": "IF no cancelar crear lista?"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "datos_parciales": "={{\n{\"nombre_lista\":$('Telegram Trigger1').item.json.message.text,\n\"creado_por\":$('Telegram Trigger1').item.json.message.from.id}\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        36832
      ],
      "id": "28ec79ee-0fad-4ded-afd7-5b2be8b98ff5",
      "name": "Update DATOS PARCIALES NOMBRE LISTA",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Revisa la informaci√≥n de tu lista üëÄ\n\nNombre: {{$json.datos_parciales.nombre_lista}}\n\n¬øQu√© deseas hacer?\n\n1. Confirmar y guardar\n\n9. Cancelar\n\nüí° Sugerencia:\nTe recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        36832
      ],
      "id": "fcce4240-b4c7-4c83-90af-a6e9e0b6f6b1",
      "name": "Crear LISTA Paso 2",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "paso_actual": "2"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        36832
      ],
      "id": "b915c847-36f6-4f1c-9a6f-d2d9646b7380",
      "name": "Update State CREAR LISTA- PASO 2",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        37024
      ],
      "id": "f5e4e624-d2f6-4d3c-896f-16259f3444ac",
      "name": "Get row(s) in sheet4",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "id_lista"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        4896,
        37024
      ],
      "id": "1c43942d-5bb0-4107-b59f-ae4bcd455382",
      "name": "Crypto2"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "¬°Listo! üéâ\n\nTu lista fue creada correctamente.\n\nVolviendo al men√∫ de listas",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        37024
      ],
      "id": "5cbc5e32-3039-468b-ba0f-6ec55d9e7e36",
      "name": "Habito Guardado Correctamente1",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1968167309,
          "mode": "list",
          "cachedResultName": "LISTAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1968167309"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "creado_por": "={{ $json.datos_parciales.parseJson().creado_por }}",
            "id_lista": "={{ $json.id_lista }}",
            "nombre_lista": "={{ $json.datos_parciales.parseJson().nombre_lista }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_lista",
              "displayName": "id_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre_lista",
              "displayName": "nombre_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        37024
      ],
      "id": "502efe7d-c60c-415e-b69e-4e5da4d7faa7",
      "name": "Append LISTA",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto üòä vamos con tus listas üóÇÔ∏è\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva lista\n\n2. Ver mis listas\n\n3. Agregar √≠tems a una lista\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva lista).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        37024
      ],
      "id": "b7b584b8-8107-4ba6-a22d-c5afade5d7ee",
      "name": "Men√∫ Listas1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_LISTAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5792,
        37024
      ],
      "id": "5c7d851b-9b0a-43f2-b31e-2681e7cf798f",
      "name": "Update State MENU_LISTAS1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.paso_actual }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    },
                    "id": "5dd6228f-228c-4aa8-8216-762179799a50"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "6082eeb4-8f82-44e9-b24e-fb33addcb845",
                    "leftValue": "={{ $json.paso_actual }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        36928
      ],
      "id": "2686441c-59e0-4b69-90fd-aa6a86e11c86",
      "name": "Pasos Listas"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto üòä vamos con tus listas üóÇÔ∏è\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva lista\n\n2. Ver mis listas\n\n3. Agregar √≠tems a una lista\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva lista).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        37216
      ],
      "id": "ea477ace-c6b8-46c5-998f-f43f1fe9a104",
      "name": "Men√∫ Listas2",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_LISTAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        37216
      ],
      "id": "740f95cd-f39e-4fc8-a1f9-714c5efde2ad",
      "name": "Update State MENU_LISTAS2",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        4896,
        35840
      ],
      "id": "69c1e734-76e0-4c70-aae5-d861cc75f04a",
      "name": "Loop Over Items4"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1968167309,
          "mode": "list",
          "cachedResultName": "LISTAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1968167309"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        35920
      ],
      "id": "6448e568-5c82-4cfb-b85c-7717aa4505b9",
      "name": "Get row(s) Traer Listas",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto üòä vamos con tus listas üóÇÔ∏è\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva lista\n\n2. Ver mis listas\n\n3. Agregar √≠tems a una lista\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva lista).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        35536
      ],
      "id": "9c914576-7195-4275-90f4-c5dcacf333e2",
      "name": "Men√∫ Listas3",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_LISTAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        35536
      ],
      "id": "af4fa8f4-1462-48e9-b440-79f4524049c7",
      "name": "Update State MENU_LISTAS3",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1968167309,
          "mode": "list",
          "cachedResultName": "LISTAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1968167309"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        36448
      ],
      "id": "13fdc5e8-1078-4dc8-9100-333ee4066cdf",
      "name": "Get row(s) Traer Listas1",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Ups üòÖ primero debes de crear un habito.\n\nPuedes hacerlo desde el men√∫ de h√°bitos usando la opci√≥n 1.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        36160
      ],
      "id": "19435134-0c6c-4c9d-94c7-337414f42c97",
      "name": "NO TIENE LISTAS",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto üòä vamos con tus listas üóÇÔ∏è\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva lista\n\n2. Ver mis listas\n\n3. Agregar √≠tems a una lista\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva lista).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        36160
      ],
      "id": "8ec786c3-6b68-45c4-9a74-0b0d5c5626a3",
      "name": "Men√∫ Listas5",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_LISTAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        36160
      ],
      "id": "9597f565-6381-4720-b705-917ad631f2e4",
      "name": "Update State MENU_LISTAS5",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "655ef5ab-d91a-4659-9bbc-50b18c8526e1",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        35920
      ],
      "id": "0f1a2abd-74bf-4aea-a819-e83f246010c7",
      "name": "IF THERES LISTAS?"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        4896,
        36544
      ],
      "id": "a8f080a7-b051-4d2a-94d1-a5a250b6a1ad",
      "name": "Loop Over Items5"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "655ef5ab-d91a-4659-9bbc-50b18c8526e1",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        36448
      ],
      "id": "46716a4f-4a55-4adb-8bf2-48c40f7746df",
      "name": "IF THERES LISTAS?1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=-------------------------------------------------------------\nID: {{ $json.id_lista }}\nNombre Lista: {{ $json.nombre_lista }}\n\n-------------------------------------------------------------",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        36544
      ],
      "id": "ca424551-4508-478d-b7a3-7a113e1c8457",
      "name": "Mostrar Lista Mensaje5",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "21be4a91-3f6d-429e-8d68-767909c66757",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        28464
      ],
      "id": "9f4ffdba-b12f-49b7-9e81-40ffec7d9fe9",
      "name": "HAY TAREAS"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "21be4a91-3f6d-429e-8d68-767909c66757",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        28944
      ],
      "id": "42588172-9e88-4257-be84-865b5619e855",
      "name": "HAY TAREAS1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Ups üòÖ parece que no tienes ninguna tarea sin completar.\n\nVolviendo al men√∫ de Tareas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        28752
      ],
      "id": "8303985d-8a02-42a2-971b-5c63b20544c6",
      "name": "NO TIENE TAREAS SIN COMPLETAR",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Ups üòÖ parece que no tienes ninguna tarea.\n\nVolviendo al men√∫ de Tareas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        28560
      ],
      "id": "56e04f7d-f38b-4850-ab95-067b745a38e1",
      "name": "NO TIENE TAREAS SIN COMPLETAR1",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto, vamos con tus tareas üìù\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva tarea\n\n2. Ver mis tareas\n\n3. Cambiar estado de una tarea\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva tarea).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        28656
      ],
      "id": "6944b0c1-abf2-4f51-941b-5e055ed84c6f",
      "name": "Men√∫ Tareas8",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_TAREAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        28656
      ],
      "id": "d3e548b6-20e7-4b76-9f0e-877cbfad74fd",
      "name": "Update State MENU_TAREAS7",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "paso_actual": "1",
            "pantalla_actual": "ADD_ITEM_LISTA"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        36352
      ],
      "id": "0977a1e7-d0a3-435b-a7ab-0af78a739281",
      "name": "Update State COMPLETAR TAREA - PASO 2",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Dame el id de la lista para que le a√±adamos items üòÅ.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        36352
      ],
      "id": "41c6f53c-d455-4b42-9a2b-c898fbc845ce",
      "name": "Pedir ID Lista para A√±adir Item",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1968167309,
          "mode": "list",
          "cachedResultName": "LISTAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1968167309"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id_lista",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.text }}"
            },
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4224,
        37504
      ],
      "id": "543999e5-462a-4ac8-bd7d-9f84ea029a6f",
      "name": "Get Lista por ID",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "ddd619b2-6740-45de-a958-a8bf36816a53",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4448,
        37504
      ],
      "id": "2b837342-fbbe-415f-b182-d5b2d020efe5",
      "name": "Existe la lista y es del user?"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Genial üòä vamos a crear tu √≠tem.\n\nCada mensaje ser√° un √≠tem y cuando est√©s list@ escribe:\n\n0. Guardar √çtems\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        37408
      ],
      "id": "244e3635-b339-47cd-9334-245541627b99",
      "name": "AGREGAR ITEM A LISTA PASO 1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "AGREGAR_ITEM_A_LISTA",
            "paso_actual": "1"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        37408
      ],
      "id": "b076856f-6db4-4c44-8e29-01058efc5bbc",
      "name": "Update State AGREGAR ITEM A LISTA - PASO ",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=Oh oh, no hemos encontrado ninguna lista con esa ID ü•∫\n\nVolviendo al men√∫ listas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        37600
      ],
      "id": "930dacd7-4012-4dc2-869d-a5da7bfd2024",
      "name": "VOLVIENDO MENU LISTA",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto üòä vamos con tus listas üóÇÔ∏è\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva lista\n\n2. Ver mis listas\n\n3. Agregar √≠tems a una lista\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva lista).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        37600
      ],
      "id": "dcd29a42-1def-4770-9225-9439cb79b38a",
      "name": "Men√∫ Listas4",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_LISTAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        37600
      ],
      "id": "349ca36f-4f0e-4335-8fba-27624974f6a1",
      "name": "Update State MENU_LISTAS4",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "befa34cd-bb19-4c26-94a2-8c4711de9bb9",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4224,
        37984
      ],
      "id": "daa19a15-44ca-4c9f-9019-7c55e8261ead",
      "name": "IF no cancelar crear lista?1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "befa34cd-bb19-4c26-94a2-8c4711de9bb9",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4448,
        37888
      ],
      "id": "873e4f41-6352-4b4b-bf6f-2e5d78a54102",
      "name": "IF seguir a√±adiendo √≠tems"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "datos_parciales": "={{\n{\n\"lista_id\":$('Existe la lista y es del user?').item.json.id_lista,\n\"items\":[]\n}\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        37408
      ],
      "id": "1a6997e5-6872-4d36-a783-4dee2bf4aa33",
      "name": "Update DATOS PARCIALES LISTA ID",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Est√° bien üòä\n\nHe cancelado la creaci√≥n de la lista.\n\nVolviendo al men√∫ listas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        37216
      ],
      "id": "031ca850-2288-4ee2-97c0-7411b170d5fa",
      "name": "Cancelado Creaci√≥n Lista",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto üòä vamos con tus listas üóÇÔ∏è\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva lista\n\n2. Ver mis listas\n\n3. Agregar √≠tems a una lista\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva lista).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        38176
      ],
      "id": "98ee0548-1519-4d3a-ac19-2fc47c2d671b",
      "name": "Men√∫ Listas6",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_LISTAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        38176
      ],
      "id": "aeb813d7-649a-4a7e-a602-5f323f0d5333",
      "name": "Update State MENU_LISTAS6",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Est√° bien üòä\n\nHe cancelado la adici√≥n de items.\n\nVolviendo al men√∫ listas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        38176
      ],
      "id": "ae0efdfe-398f-4bd8-a383-b6726bb594ea",
      "name": "Cancelado Adici√≥n de √çtems",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "datos_parciales": "={{ $json.datos_parciales }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        37792
      ],
      "id": "4b9afecf-72a0-4583-b499-dff171709b3e",
      "name": "Update DATOS PARCIALES LISTA ID1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// 1. Obtener datos_parciales (puede venir como objeto o string)\nlet datos = $json.datos_parciales;\n\nif (typeof datos === 'string') {\n  datos = JSON.parse(datos);\n}\n\n// 2. Agregar el nuevo item desde Telegram\ndatos.items.push({\n  nombre_item: $node[\"Telegram Trigger1\"].json.message.text\n});\n\n// 3. Devolver el item manteniendo TODO lo dem√°s\nreturn {\n  json: {\n    ...$json,\n    datos_parciales: datos\n  }};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4672,
        37792
      ],
      "id": "792ca2dd-51e3-4c72-887b-f5f69914a3cb",
      "name": "Code in JavaScript",
      "executeOnce": false
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"objetos\": {{$json.datos_parciales.parseJson().items}}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4672,
        37984
      ],
      "id": "2a994747-edf5-4573-ad92-c222945973ac",
      "name": "Parse Datos Parciales"
    },
    {
      "parameters": {
        "jsCode": "const salida = [];\n\nconst datos = $input.first().json.objetos;\n\nfor (const entrada of datos) {\n  salida.push({\n    json: {\n      nombre_item: entrada.nombre_item\n    }\n  });\n}\n\nreturn salida;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4896,
        37984
      ],
      "id": "4433a5f6-0b26-41d7-b5a3-a079b600ad12",
      "name": "Code in JavaScript1",
      "executeOnce": false
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        5120,
        37984
      ],
      "id": "d36c31ff-cede-4086-98f3-86ca9b3ff95e",
      "name": "Loop Over Items6"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 495463117,
          "mode": "list",
          "cachedResultName": "ITEMS_LISTA",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=495463117"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_item": "={{ $json.id_item }}",
            "id_lista": "={{ $('IF seguir a√±adiendo √≠tems').item.json.datos_parciales.parseJson().lista_id}}",
            "item": "={{ $json.nombre_item }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_item",
              "displayName": "id_item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_lista",
              "displayName": "id_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "item",
              "displayName": "item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5568,
        37984
      ],
      "id": "cf4692dd-115c-4203-b96c-6495773e270d",
      "name": "Append ITEM_LISTA",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "id_item"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        5344,
        37888
      ],
      "id": "7e28d6fc-d7fa-4997-80ad-9afb55bd7c68",
      "name": "Crypto3"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=-------------------------------------------------------------\n\nNombre: {{ $json.nombre }}\nFrecuencia: {{ $json.frecuencia }}\nHora de recordatorio: {{ $json.hora_recordatorio }}\nEstado: {{ $json.estado }} {{ $json.estado == 'ACTIVO' ? '‚úÖ' : '‚õî' }}\n\n-------------------------------------------------------------",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        32400
      ],
      "id": "4b7b5026-817f-4414-a213-96c9e02f91e7",
      "name": "Mostrar Habitos Mensaje2",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=\nitem: {{ $json.item }}\n",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5792,
        35792
      ],
      "id": "663b8777-8bd8-4549-86c8-e1f57e6f2381",
      "name": "Mostrar Listas √çtem Mensaje1",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 495463117,
          "mode": "list",
          "cachedResultName": "ITEMS_LISTA",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=495463117"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id_lista",
              "lookupValue": "={{ $('Loop Over Items4').item.json.id_lista }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        35728
      ],
      "id": "84f75161-e339-4f49-965e-38f6ed9c0dc8",
      "name": "Get row(s) in sheet1",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "=-------------------------------------------------------------\n\nNombre Lista: {{ $json.nombre_lista }}\n",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        35728
      ],
      "id": "5c2c2b49-0bd3-4642-a3cb-0034d4bda9ce",
      "name": "Mostrar Listas Mensaje",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto üòÅ\n\nlos √≠tems han sido a√±adidos a la lista\n\nVolviendo al men√∫ listas.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        37504
      ],
      "id": "5ca236cb-d45f-4d42-aba7-add5346f07d7",
      "name": "Confirmaci√≥n √çtems Puestos",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
        "text": "Perfecto üòä vamos con tus listas üóÇÔ∏è\n\n¬øQu√© deseas hacer?\n\n1. Crear una nueva lista\n\n2. Ver mis listas\n\n3. Agregar √≠tems a una lista\n\n4. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo 1 (Crear una nueva lista).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        37504
      ],
      "id": "09885791-1d4f-40c6-a1fe-fe5eced33851",
      "name": "Men√∫ Listas7",
      "webhookId": "e53a7f73-09d7-4b20-aa71-6cea408b1691",
      "executeOnce": false,
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_LISTAS"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5792,
        37504
      ],
      "id": "ca163ef7-ae08-4810-a017-efaa6ed02612",
      "name": "Update State MENU_LISTAS7",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        36640
      ],
      "id": "38fd0e5d-1a13-4ca1-8833-a63450cc7f56",
      "name": "Menu Principal_3",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.from.id }}",
            "pantalla_actual": "MENU_PRINCIPAL"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        36640
      ],
      "id": "687d52be-11cf-4ea7-a935-cd65ff1d7493",
      "name": "Update State MENU_PRINCIPAL4",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "a6dd3cbf-543b-4374-94dc-3b6a0cbcdce2",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5568,
        35728
      ],
      "id": "086d1b8d-f3b8-48cc-91b1-761ac3008569",
      "name": "not empty?"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"timestamp\": {{$now}},\n  \"telegram_user\": {{ $json.telegram_user }},\n  \"pantalla\": {{ $json.pantalla_actual }},\n  \"opcion_elegida\": {{ $('Telegram Trigger1').item.json.message.text }},\n  \"resultado\": {{ \"opcion \" +  $('Telegram Trigger1').item.json.message.text + \" del menu \" +$('verificar_sesi√≥n').item.json.pantalla_actual + \" ejecutada correctamente\"}}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4448,
        32400
      ],
      "id": "9fff06a5-7b57-48e2-b02f-1430d5d6ccb9",
      "name": "Edit To Log"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "96CkwDJcwArTtA-CZJMvh",
          "mode": "list",
          "cachedResultUrl": "/workflow/96CkwDJcwArTtA-CZJMvh",
          "cachedResultName": "My Sub-Workflow 2"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        4672,
        32400
      ],
      "id": "a99fb441-6eaa-4316-8431-bf1b7fadbe06",
      "name": "Call 'My Sub-Workflow 2'"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"timestamp\": {{$now}},\n  \"telegram_user\": {{ $json.telegram_user }},\n  \"pantalla\": {{ $json.pantalla_actual }},\n  \"opcion_elegida\": {{ $('Telegram Trigger1').item.json.message.text }},\n  \"resultado\": {{ \"opcion \" +  $('Telegram Trigger1').item.json.message.text + \" del menu \" +$('verificar_sesi√≥n').item.json.pantalla_actual + \" ejecutada correctamente\"}}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4448,
        35728
      ],
      "id": "25dc7d40-4cb9-465b-91a8-65c16ba4edd1",
      "name": "Edit To Log1"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "96CkwDJcwArTtA-CZJMvh",
          "mode": "list",
          "cachedResultUrl": "/workflow/96CkwDJcwArTtA-CZJMvh",
          "cachedResultName": "My Sub-Workflow 2"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        4672,
        35728
      ],
      "id": "acbcac52-f7b6-4b70-931b-be1d597658a6",
      "name": "Call 'My Sub-Workflow 2'1"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"timestamp\": {{$now}},\n  \"telegram_user\": {{ $json.telegram_user }},\n  \"pantalla\": {{ $json.pantalla_actual }},\n  \"opcion_elegida\": {{ $('Telegram Trigger1').item.json.message.text }},\n  \"resultado\": {{ \"opcion \" +  $('Telegram Trigger1').item.json.message.text + \" del menu \" +$('verificar_sesi√≥n').item.json.pantalla_actual + \" ejecutada correctamente\"}}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4448,
        28272
      ],
      "id": "0519622f-4eb3-42ea-9bf2-5faee11684f1",
      "name": "Edit To Log2"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "96CkwDJcwArTtA-CZJMvh",
          "mode": "list",
          "cachedResultUrl": "/workflow/96CkwDJcwArTtA-CZJMvh",
          "cachedResultName": "My Sub-Workflow 2"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        4672,
        28272
      ],
      "id": "9ba94f9d-4de4-45b4-ab99-91fdd18e7d97",
      "name": "Call 'My Sub-Workflow 2'2"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"timestamp\": {{$now}},\n  \"telegram_user\": {{ $json.telegram_user }},\n  \"pantalla\": {{ $json.pantalla_actual }},\n  \"opcion_elegida\": {{ $('Telegram Trigger1').item.json.message.text }},\n  \"resultado\": {{ \"opcion \" +  $('Telegram Trigger1').item.json.message.text + \" del menu \" +$('verificar_sesi√≥n').item.json.pantalla_actual + \" ejecutada correctamente\"}}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4448,
        27504
      ],
      "id": "afb0a690-610c-4750-82d0-4d9923e88c91",
      "name": "Edit To Log3"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "96CkwDJcwArTtA-CZJMvh",
          "mode": "list",
          "cachedResultUrl": "/workflow/96CkwDJcwArTtA-CZJMvh",
          "cachedResultName": "My Sub-Workflow 2"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        4672,
        27504
      ],
      "id": "604d2ebc-c015-467d-a8e7-f245bce8b941",
      "name": "Call 'My Sub-Workflow 2'3"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        40480
      ],
      "id": "4cc51285-7978-4272-840a-7473aece9a84",
      "name": "Menu Principal",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=Ups üò¨ ya tienes una cita agendada\nen esa misma fecha y hora.\n\nPor favor escribe otra hora.\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5792,
        38176
      ],
      "id": "32dbb512-210b-4108-843b-53e0ccd2979a",
      "name": "Error Doble Reserva",
      "webhookId": "a60929b2-6f11-4032-926d-05a0c072384d",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ $json.canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        39808
      ],
      "id": "ba7e8df4-952c-4b35-b0d7-c6ac40601857",
      "name": "Agendar Cita Paso 6 Confirmar",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Perfecto üòä\n\nPaso 5 de 6 ‚Äî Canal\n\n¬øC√≥mo ser√° la atenci√≥n?\n\n1. Presencial\n\n2. Virtual\n\n3. Llamada\n\n4. Cancelar\n\nüí° Sugerencia:\nNormalmente se usa 2 (Virtual).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        39520
      ],
      "id": "9c2acbf7-b82a-47b0-a703-dee21214749f",
      "name": "Agendar Cita Paso 5",
      "webhookId": "68cb4abc-ec1d-4a8a-953b-da48a167af0b",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Muy bien üëç\n\nPaso 4 de 6 ‚Äî Motivo\n\nCu√©ntame brevemente el motivo de la cita.\n\nEjemplo: Asesor√≠a t√©cnica\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        39328
      ],
      "id": "a8da87fc-2915-483d-9a8a-8c29e3df935c",
      "name": "Agendar Cita Paso 4",
      "webhookId": "68cb4abc-ec1d-4a8a-953b-da48a167af0b",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "Genial üòä\n\nPaso 3 de 6 ‚Äî Nombre\n\n¬øA nombre de qui√©n es la cita?\n\nEscribe el nombre completo.\n\nEjemplo: Pedro G√≥mez\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        6016,
        39040
      ],
      "id": "68c69572-c575-44cc-9e4b-35c101b7875f",
      "name": "Agendar Cita Paso 3",
      "webhookId": "68cb4abc-ec1d-4a8a-953b-da48a167af0b",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la hora no tiene un formato v√°lido.\n\nRecuerda usar formato 24 horas:\nHH:MM\n\nEjemplo: 14:30\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        39136
      ],
      "id": "fe7ff778-7cdb-4a67-9cc7-2dbe6f4a4a8b",
      "name": "Hora Invalida",
      "webhookId": "89a3d27f-d5de-425c-8c71-1bdf700a711e",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Perfecto üëç\n\nPaso 2 de 6 ‚Äî Hora\n\n¬øA qu√© hora ser√° la cita?\n\nFormato 24 horas: HH:MM\nEjemplo: 14:30\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        38368
      ],
      "id": "e84b9562-8e82-4dac-afba-405941b18099",
      "name": "Agendar Cita Paso 2",
      "webhookId": "51955384-d352-46f0-a7db-4ba879bc682f",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Perfecto, vamos con tu agenda üìÖ\n\n¬øQu√© deseas hacer?\n\n1. Agendar una nueva cita\n\n2. Consultar tu agenda\n\n3. Reprogramar una cita\n\n4. Cancelar una cita\n\n5. Marcar una cita como completada\n\n6. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo la opci√≥n 1 (Agendar una nueva cita).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        40288
      ],
      "id": "5b5f1a6b-7513-4539-9060-1a59b427197a",
      "name": "Men√∫ Agenda",
      "webhookId": "95c2e7db-d561-4644-9f1a-dfd17f305b61",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "2",
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  try {\n    data = $json[\"datos_parciales\"] ? JSON.parse($json[\"datos_parciales\"]) : {};\n  } catch (e) {\n    data = {};\n  }\n\n  const mensaje = $('Telegram Trigger1').item.json.message.text;\n\n  data.fecha = mensaje;\n\n  return JSON.stringify(data);\n})()\n}}",
            "pantalla_actual": "=AGENDAR"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        38368
      ],
      "id": "58994d50-ad74-472b-bf22-5fd3f935e4c5",
      "name": "Agendar_paso_1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        38368
      ],
      "id": "d6582435-05de-4e08-bbd1-97a7a8e41e2e",
      "name": "Cancelar_agendamiento",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  \n  // 1. RESCATAR: Leemos la sesi√≥n desde el nodo seguro (verificar_sesi√≥n)\n  // As√≠ no importa si venimos de un IF, un Code o un Filter.\n  try {\n    // Aseg√∫rate de que 'verificar_sesi√≥n' sea el nombre de tu nodo verde\n    const rawData = $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"];\n    data = rawData ? JSON.parse(rawData) : {};\n  } catch (e) {\n    data = {};\n  }\n\n  // 2. AGREGAR: Leemos la hora usando la referencia absoluta al Trigger\n  // Usamos $node[\"Nombre\"] en vez de $('Nombre').item para evitar errores\n  const horaTelegram = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n\n  data.hora = horaTelegram;\n\n  // 3. RETORNAR\n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
            "paso_actual": "3"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5792,
        39040
      ],
      "id": "9a0b6e18-2344-403a-8d54-fafab2fcc4d5",
      "name": "Agendar_paso_2",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  try {\n    data = $json[\"datos_parciales\"] ? JSON.parse($json[\"datos_parciales\"]) : {};\n  } catch (e) {\n    data = {};\n  }\n\n  const mensaje = $('Telegram Trigger1').item.json.message.text;\n\n  data.nombre = mensaje;\n\n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "4"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        39328
      ],
      "id": "76efa9ce-7dc0-43b3-80a0-f883d6284e3c",
      "name": "Agendar_paso_3",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  try {\n    data = $json[\"datos_parciales\"] ? JSON.parse($json[\"datos_parciales\"]) : {};\n  } catch (e) {\n    data = {};\n  }\n\n  const mensaje = $('Telegram Trigger1').item.json.message.text;\n\n  data.motivo = mensaje;\n\n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "5"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        39520
      ],
      "id": "80196c51-e5d2-42c1-acf0-c1512a00dc67",
      "name": "Agendar_paso_4",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json[\"paso_actual\"].toString() }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "27c28973-9ef6-49bf-8f43-efd8ee1d30b2"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "bc90d83a-3bca-4d2e-8b84-dd245e0fcf5e",
                    "leftValue": "={{ $json[\"paso_actual\"].toString() }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "06e2a91d-cba1-4a92-8f1a-f8c3d73b9b17",
                    "leftValue": "={{ $json[\"paso_actual\"].toString() }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ad24f2c7-509e-449d-8cc3-c3ae986befca",
                    "leftValue": "={{ $json[\"paso_actual\"].toString() }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "36ef200f-aac4-4028-9ac9-bcb26be001a6",
                    "leftValue": "={{ $json[\"paso_actual\"].toString() }}",
                    "rightValue": "5",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4672,
        39520
      ],
      "id": "f1185328-26da-441e-a7e9-a6cf2349e32e",
      "name": "Monitor_edici√≥n"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  // Intentamos leer lo que hay. Si est√° vac√≠o o da error, iniciamos vacio.\n  try {\n    data = JSON.parse($json[\"datos_parciales\"]);\n  } catch (e) {\n    data = {};\n  }\n  \n  // AQU√ç AGREGAMOS EL DATO NUEVO (Cambia 'fecha' seg√∫n el nodo)\n  data.canal = \"presencial\"\n  \n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "",
            "pantalla_actual": "VERIFICACION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        39712
      ],
      "id": "5eb2597d-a0ab-4bf2-9daf-835693d4ad44",
      "name": "Agendar_paso_5 (presencial)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  // Intentamos leer lo que hay. Si est√° vac√≠o o da error, iniciamos vacio.\n  try {\n    data = JSON.parse($json[\"datos_parciales\"]);\n  } catch (e) {\n    data = {};\n  }\n  \n  // AQU√ç AGREGAMOS EL DATO NUEVO (Cambia 'fecha' seg√∫n el nodo)\n  data.canal = \"virtual\";\n  \n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "",
            "pantalla_actual": "VERIFICACION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        39904
      ],
      "id": "78c27094-083c-42c6-9d80-105b4f91bcb3",
      "name": "Agendar_paso_5 (virtual)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  // Intentamos leer lo que hay. Si est√° vac√≠o o da error, iniciamos vacio.\n  try {\n    data = JSON.parse($json[\"datos_parciales\"]);\n  } catch (e) {\n    data = {};\n  }\n  \n  // AQU√ç AGREGAMOS EL DATO NUEVO (Cambia 'fecha' seg√∫n el nodo)\n  data.canal = \"llamada\";\n  \n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "",
            "pantalla_actual": "VERIFICACION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        40096
      ],
      "id": "2683d3a3-8e48-432d-8831-1bb49149f296",
      "name": "Agendar_paso_5 (llamada)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "9cc5a521-6683-43af-a5e1-802bd6b92274",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4448,
        39056
      ],
      "id": "7a387bde-c05b-4a8e-984d-5d06ce28d46a",
      "name": "IF_cancelar_agendamiento"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (presencial)\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5344,
        39712
      ],
      "id": "2ea4f325-6eb6-4979-8aaa-49d661c478c0",
      "name": "field_presencial"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (virtual)\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5344,
        39904
      ],
      "id": "1e84264e-c113-4d72-b481-62236c2b64ab",
      "name": "field_virtual"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (llamada)\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5344,
        40096
      ],
      "id": "6b56175a-96f6-45ad-a7a9-840dd668b9b2",
      "name": "field_llamada"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cita": "={{ 'CITA-' + $now.format('yyyyMMddHHmmss') }}",
            "fecha": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).fecha }}",
            "hora": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).hora }}",
            "nombre": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).nombre }}",
            "motivo": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).motivo }}",
            "creado_por": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}",
            "timestamp_creacion": "={{$now}}",
            "estado": "Pendiente",
            "canal": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).canal }}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "recordatorio_enviado",
              "displayName": "recordatorio_enviado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        50944
      ],
      "id": "18a02e1e-12f9-4f87-8d64-9e98e0e172cd",
      "name": "Append_cita",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "eb38a67e-f4fe-4761-b573-11dc55c8e227",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "={{ \"1\" }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        40384
      ],
      "id": "cc7c32d7-9ad8-4bd7-b91b-3a4dbf95b24e",
      "name": "IF_agendar_cita"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CITAS",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        40288
      ],
      "id": "722337ba-fcfa-4180-9667-50c63a24bbfa",
      "name": "Actualizar_estado (MENU_CITAS)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "4cbc81a2-8cf4-405f-9e1c-0061a99bcafe"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8af760ed-a14c-48e3-815f-7750da444a02",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8aee58a1-a925-4798-ab0a-3bbd70e9b5cb",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d5478f88-f019-4760-899e-5aca37f0901d",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"4\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "562ad6ff-08b0-4905-b876-4875ba64a11c",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"5\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4f6bc30e-1d43-4e8b-97c6-11d3b1364835",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"6\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        52784
      ],
      "id": "ade2f5da-0066-4fce-b0b7-ec4cc1cd5c61",
      "name": "Switch_MENU_CITAS"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "AGENDAR",
            "paso_actual": "1"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        51712
      ],
      "id": "f0a07edb-bd1c-41c2-af85-9cf13a6e4d75",
      "name": "Actualizar_estado (AGENDAR)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        53440
      ],
      "id": "57477148-f221-4630-b95a-3bad90f412de",
      "name": "Actualizar_estado (MENU_PRINCIPAL) /SWITCH MENU_CITAS",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Operaci√≥n cancelada. Est√°s en el men√∫ principal.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        38368
      ],
      "id": "a1b87706-7dd1-4222-a611-15109cfba36a",
      "name": "Cancelar_agendamiento_message",
      "webhookId": "51955384-d352-46f0-a7db-4ba879bc682f",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Empecemos a crear tu cita üòä\n\nPaso 1 de 6 ‚Äî Fecha\n\n¬øCu√°l es la fecha de la cita?\n\nFormato: YYYY-MM-DD\nEjemplo: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        51712
      ],
      "id": "895a8a81-2695-4eda-af24-af4faa6c3584",
      "name": "Agendar Cita Paso inicial",
      "webhookId": "51955384-d352-46f0-a7db-4ba879bc682f",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=¬°Listo! Tu cita qued√≥ agendada correctamente.\n\nID de la cita: {{ $('Append_cita').item.json.id_cita }}\n\n¬øQu√© deseas hacer ahora?\n1. Volver a Agenda\n2. Ir al men√∫ principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        50944
      ],
      "id": "59d17d19-7a04-468b-b248-2963b5f5abd9",
      "name": "Mensaje_registro_exitoso",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "a7189d17-b037-404f-baf4-24eed23819e6"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "41448d46-c520-42a0-9394-a4ef6269320b",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "746bee75-46a6-4597-a700-00477ecf3b07",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4896,
        39984
      ],
      "id": "e9d7a9fd-0023-4644-a497-e1a50aefd649",
      "name": "Switch_tipo_canal"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{\"1\"}}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "93dabcdb-4b32-4dd8-8c73-731828d793d3"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f315a1ec-da4f-4a2f-b6e1-75159a79e01a",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f4d361a8-4163-4764-8739-d51cebd886b3",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{\"3\"}}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        51120
      ],
      "id": "e5d8e044-9f3b-4954-a687-637a1f03d8bc",
      "name": "Switch_edicion_creaci√≥n"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "689583d8-cb58-4338-9cde-e5c1a6e78c8d"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8bf08cda-2e27-42c1-baff-56c13179eb64",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        51520
      ],
      "id": "75ee6b24-b498-41b3-9721-4e6c480831dd",
      "name": "Switch_CONFIRMACION_CITA"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CITAS",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        51328
      ],
      "id": "599be2d3-5142-48bc-ad13-c8f1494d878a",
      "name": "Actualizar_estado (volver MENU_CITAS)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        51520
      ],
      "id": "3f9a0cf8-83fc-44e8-8591-26c8510748ba",
      "name": "Actualizar_estado (volver MENU_PRINCIPAL)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Perfecto, vamos con tu agenda üìÖ\n\n¬øQu√© deseas hacer?\n\n1. Agendar una nueva cita\n\n2. Consultar tu agenda\n\n3. Reprogramar una cita\n\n4. Cancelar una cita\n\n5. Marcar una cita como completada\n\n6. Volver al men√∫ principal\n\nüí° Sugerencia:\nTe recomiendo la opci√≥n 1 (Agendar una nueva cita).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        51328
      ],
      "id": "9be3daa1-d729-41b1-af27-8db661e3eb81",
      "name": "Mostrar_Menu_agenda",
      "webhookId": "95c2e7db-d561-4644-9f1a-dfd17f305b61",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        51520
      ],
      "id": "83731a09-29b1-48ec-a985-0e938d266b95",
      "name": "Mostrar_menu_principal",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "CONFIRMACION_CITA",
            "paso_actual": "0",
            "datos_parciales": ""
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        50944
      ],
      "id": "b2d61371-65e9-4870-b216-208e6c9c395c",
      "name": "Actualizar_estado (CONFIRMACION_CITA)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=‚úèÔ∏è *Modo Edici√≥n*\n\n¬øQu√© dato quieres corregir?\n\n1. Nombre\n2. Fecha\n3. Hora\n4. Motivo\n5. Canal\n6. üîô Volver sin cambios",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        51136
      ],
      "id": "4b8ab317-9794-4d1f-9f19-1cd7a5f01cd9",
      "name": "Mensaje_edicion_cita",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "28f0bbc3-8195-4dbd-85cb-dd11c85789a3"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e8f021de-f6d2-4c70-9231-5194c2f1da57",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5215c1bb-1f54-4b04-95a1-21469533279f",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "c9e79605-7c9c-4b8b-a37d-2923bf6a3291",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"4\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "eb617738-ec83-4d86-87ec-96db7c23bb74",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"5\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "1cf6c36b-abbc-498b-ba67-5987245d9847",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"6\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        42656
      ],
      "id": "dbe68c49-6215-4fcc-8db0-4a4560fe03d8",
      "name": "Switch_edici√≥n_cita"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üìÖ Por favor, escribe la nueva fecha (Ej: 2025-12-25):",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        42496
      ],
      "id": "d5189476-7ef3-4121-bae6-3cc236b8b8f1",
      "name": "Mensaje_nueva_fecha",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "EDITAR_FECHA",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        42496
      ],
      "id": "bf781229-4b1e-4c8c-a840-63e0aac12fd3",
      "name": "Actualizar_estado (EDITAR FECHA)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "EDITAR_NOMBRE",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        41920
      ],
      "id": "e82202b5-8648-4a0c-ae02-81e90b81fbbc",
      "name": "Actualizar_estado (EDITAR_NOMBRE)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üìÖ Por favor, escribe un nuevo nombre:",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        41920
      ],
      "id": "fed8f02a-636b-4d7a-a495-18e36d892950",
      "name": "Mensaje_nuevo_nombre",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "EDITAR_HORA",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        42112
      ],
      "id": "af9d0e09-1a7e-4d95-a597-ecb2da010f80",
      "name": "Actualizar_estado (EDITAR_HORA)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "= Por favor, escribe la nueva hora (Ej: 14:30):",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        42112
      ],
      "id": "0c7ece1a-4471-4399-bde0-2c927bc0405f",
      "name": "Mensaje_nueva_hora",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "datos_parciales": "={{\n(() => {\n  const rawInfo = $node[\"verificar_sesi√≥n\"] ? $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"] : \"\";\n  \n  let data = {};\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) {\n          data = {};\n      }\n  }\n\n  const nuevoDato = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n  \n  data.fecha = nuevoDato; \n\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        43264
      ],
      "id": "34ae1391-47bb-4b78-9f82-eaa0974963ff",
      "name": "Actualizar_campo (fecha)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_EDITAR",
            "paso_actual": "6"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        51136
      ],
      "id": "62a82295-5c16-4459-a09b-37b4723b730b",
      "name": "Actualizar_estado (MENU_EDITAR)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ JSON.parse($json[\"datos_parciales\"]).canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        43264
      ],
      "id": "49300224-a421-4422-8bc1-dde0f9fc1c8f",
      "name": "Agendar Cita Paso 6 Confirmar (EDITAR_FECHA)",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "datos_parciales": "={{\n(() => {\n  const rawInfo = $node[\"verificar_sesi√≥n\"] ? $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"] : \"\";\n  \n  let data = {};\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) {\n          data = {};\n      }\n  }\n\n  const nuevoDato = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n  \n  data.nombre = nuevoDato; \n\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        43744
      ],
      "id": "b805218d-d734-4807-b859-bb05e7abb805",
      "name": "Actualizar_campo (nombre)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ JSON.parse($json[\"datos_parciales\"]).canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        43744
      ],
      "id": "7dc3f93d-c750-445e-a6b0-504db2f29469",
      "name": "Agendar Cita Paso 6 Confirmar (EDITAR_NOMBRE)",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ JSON.parse($json[\"datos_parciales\"]).canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        43936
      ],
      "id": "d3c9eded-e49a-4bc5-8ea4-873b37692127",
      "name": "Agendar Cita Paso 6 Confirmar (EDITAR_HORA)",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ JSON.parse($json[\"datos_parciales\"]).canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        44320
      ],
      "id": "5dc48676-7dbd-4437-872b-de1675729043",
      "name": "Agendar Cita Paso 6 Confirmar (EDITAR_MOTIVO)",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "datos_parciales": "={{\n(() => {\n  const rawInfo = $node[\"verificar_sesi√≥n\"] ? $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"] : \"\";\n  \n  let data = {};\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) {\n          data = {};\n      }\n  }\n\n  const nuevoDato = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n  \n  data.motivo = nuevoDato; \n\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        44320
      ],
      "id": "90495976-2bc2-414f-8df5-2a716ec3dd0c",
      "name": "Actualizar_campo (motivo)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "datos_parciales": "={{\n(() => {\n  const rawInfo = $node[\"verificar_sesi√≥n\"] ? $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"] : \"\";\n  \n  let data = {};\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) {\n          data = {};\n      }\n  }\n\n  const nuevoDato = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n  \n  data.hora = nuevoDato; \n\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        43936
      ],
      "id": "ce46acdd-e827-4f32-a838-c5f827a9ea87",
      "name": "Actualizar_campo (hora)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  // Intentamos leer lo que hay. Si est√° vac√≠o o da error, iniciamos vacio.\n  try {\n    data = JSON.parse($json[\"datos_parciales\"]);\n  } catch (e) {\n    data = {};\n  }\n  \n  // AQU√ç AGREGAMOS EL DATO NUEVO (Cambia 'fecha' seg√∫n el nodo)\n  data.canal = \"virtual\";\n  \n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "",
            "pantalla_actual": "VERIFICACION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        50368
      ],
      "id": "a1f55aa4-2eae-4727-a18e-3e2014de0bf6",
      "name": "Agendar_paso_5 (virtual)1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (presencial)1\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4896,
        50176
      ],
      "id": "f2e950c2-41ee-45ed-ac94-ef36022fa71d",
      "name": "field_presencial1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (virtual)1\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4896,
        50368
      ],
      "id": "6bcb89d7-8056-45cf-85fa-6f6c81b68eb0",
      "name": "field_virtual1"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  // Intentamos leer lo que hay. Si est√° vac√≠o o da error, iniciamos vacio.\n  try {\n    data = JSON.parse($json[\"datos_parciales\"]);\n  } catch (e) {\n    data = {};\n  }\n  \n  // AQU√ç AGREGAMOS EL DATO NUEVO (Cambia 'fecha' seg√∫n el nodo)\n  data.canal = \"llamada\";\n  \n  return JSON.stringify(data);\n})()\n}}",
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "",
            "pantalla_actual": "VERIFICACION"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        50560
      ],
      "id": "71d01dc3-2d15-4306-9859-3e873524c91a",
      "name": "Agendar_paso_5 (llamada)1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "876f334e-7aea-408a-a110-a88c69f6e76e",
              "name": "canal",
              "value": "={{ JSON.parse($node[\"Agendar_paso_5 (llamada)1\"].json[\"datos_parciales\"]).canal }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4896,
        50560
      ],
      "id": "8651f009-8f56-4c4a-9b05-0d48d217e096",
      "name": "field_llamada1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).motivo }}\nüì° *Canal:* {{ $json.canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        50464
      ],
      "id": "912805c3-8fa9-4979-b192-c70dc0bf96cf",
      "name": "Agendar Cita Paso 6 Confirmar (EDITAR_CANAL)",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "a7189d17-b037-404f-baf4-24eed23819e6"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "41448d46-c520-42a0-9394-a4ef6269320b",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "746bee75-46a6-4597-a700-00477ecf3b07",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        50624
      ],
      "id": "e2362acf-1b2b-49f4-9f90-5da5c9c8bb56",
      "name": "Switch_editar_tipo_canal"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "datos_parciales": "={{\n(() => {\n  const rawInfo = $node[\"verificar_sesi√≥n\"] ? $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"] : \"\";\n  \n  let data = {};\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) {\n          data = {};\n      }\n  }\n\n  const nuevoDato = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"];\n  \n  data.canal = \"presencial\"; \n\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        50176
      ],
      "id": "f4b4c8f0-19df-48c8-90d1-cd8b08e85e90",
      "name": "Actualizar_campo (motivo)1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=¬øC√≥mo ser√° la atenci√≥n?\n\n1. Presencial\n\n2. Virtual\n\n3. Llamada\n\n4. Cancelar\n\nüí° Sugerencia:\nNormalmente se usa 2 (Virtual).",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        42688
      ],
      "id": "5d6a78b0-f89f-4e11-87f4-cee421f7b41d",
      "name": "Mensaje_nuevo_canal",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "EDITAR_CANAL",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        42688
      ],
      "id": "359b9d52-65f5-444b-9317-683dbc64d601",
      "name": "Actualizar_estado (EDITAR_CANAL)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "EDITAR_MOTIVO",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        42304
      ],
      "id": "76a52459-231b-4b65-a47e-98fe3be0685d",
      "name": "Actualizar_estado (EDITAR_MOTIVO)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Por favor, escribe un nuevo motivo: ",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        42304
      ],
      "id": "25359f71-38d5-4427-bb4a-72bbcd458506",
      "name": "Mensaje_nuevo_motivo",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "VERIFICACION",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        43072
      ],
      "id": "741e64f9-fa36-4bb5-adfc-c758cdc23bf2",
      "name": "Actualizar_estado (VALIDACION)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Volviendo...",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        43072
      ],
      "id": "e4690025-2922-4b0e-9ddf-e9479a39ad4d",
      "name": "Mensaje_cancelaci√≥n_edici√≥n",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Revisa la informaci√≥n de tu cita üëÄ\n\nüë§ *Nombre:*  {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).nombre }}\nüìÖ *Fecha:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).fecha }}\n‚è∞ *Hora:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).hora }}\nüìù *Motivo:* {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).motivo }}\nüì° *Canal:*  {{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).canal }}\n\n¬øQu√© deseas hacer?\n  1. Confirmar y guardar\n  2. Editar informaci√≥n\n  3. Cancelar\n\nüí° Sugerencia: Te recomiendo 1 (Confirmar y guardar).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        43072
      ],
      "id": "10df3372-402b-4d57-a270-d9b533b4f9e0",
      "name": "Agendar Cita Paso 6 Confirmar1",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Volviendo al men√∫ principal...",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        53440
      ],
      "id": "f5d8738d-9f38-4166-b624-c0e269a08550",
      "name": "mensaje_regreso_MENU_CITAS",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups, esa opci√≥n no existe en este men√∫ üòÖ\n\nPor favor escribe uno de los n√∫meros que ves en pantalla.\n\nEst√°s en: {{ $json.pantalla_actual }}\nOpciones disponibles: 0 al 8\n\nüëâ Tip: escribe solo el n√∫mero (por ejemplo: 1).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        53632
      ],
      "id": "5b093938-5040-4de1-a136-7335fa9413d6",
      "name": "Opci√≥n_no_valida (MENU_CITAS)",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups, esa opci√≥n no existe en este men√∫ üòÖ\n\nPor favor escribe uno de los n√∫meros que ves en pantalla.\n\nEst√°s en: {{ $json.pantalla_actual }}\nOpciones disponibles: 0 al 8\n\nüëâ Tip: escribe solo el n√∫mero (por ejemplo: 1).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        42880
      ],
      "id": "3d3acc63-93a0-4351-a517-5ac1714b94fd",
      "name": "Opci√≥n_no_valida (MENU_EDITAR)",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        51904
      ],
      "id": "28f39c7c-5eb7-4ba4-83c6-be1efbddfc7f",
      "name": "Obtener_citas",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üì≠ *No tienes citas pendientes.*\n\nTu agenda est√° libre por ahora. Si quieres agendar una, elige la opci√≥n 1 en el men√∫ anterior.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        52000
      ],
      "id": "b3dd88ea-eaa9-4977-a1ec-74432897d756",
      "name": "Mensaje_sin_citas",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "={{ $json.texto_final }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        51520
      ],
      "id": "730041dc-4f1e-4f6b-bfc2-6a5c984cf3ef",
      "name": "Mensaje_citas_resultado",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "Pendiente"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        53056
      ],
      "id": "a47ab1de-652f-4f5d-a58a-7d6e5a92dce3",
      "name": "Obtener_citas1",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "641737a1-1452-4fd6-a1fb-c7272fbe711c",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4896,
        51904
      ],
      "id": "c0e86d08-ec1c-407d-8a65-c4eb6f2db5bc",
      "name": "IF_revisar_citas1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üì≠ *No tienes citas para reprogramar.*",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        53152
      ],
      "id": "adb4aad9-fff1-416d-874d-49f7b74bd475",
      "name": "Mensaje_sin_citas_reprogramar",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "641737a1-1452-4fd6-a1fb-c7272fbe711c",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4896,
        53056
      ],
      "id": "e1178311-d606-4018-98c2-2c539e172d28",
      "name": "IF_revisar_citas_reprogramar"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "REPROGRAMAR_FECHA",
            "paso_actual": "0",
            "datos_parciales": "={{ JSON.stringify({ \"id_cita_editar\":  $('Telegram Trigger1').item.json.message.text}) }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        44512
      ],
      "id": "d21a4fd3-8178-49e9-a0ff-f099b910fc85",
      "name": "Actualizar_estado (REPROGRAMAR_FECHA)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=‚úÖ ID recibido. ¬øPara qu√© Nueva Fecha la deseas? (Ej: 2026-02-15)",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        44512
      ],
      "id": "4a794887-820d-4571-817e-73c365a13483",
      "name": "Mensaje_reprogramar_citas",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "REPROGRAMAR_HORA",
            "paso_actual": "0",
            "datos_parciales": "={{\n(() => {\n  let data = {};\n  const rawInfo = $node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"];\n  \n  if (rawInfo) {\n      try {\n          data = typeof rawInfo === 'string' ? JSON.parse(rawInfo) : rawInfo;\n      } catch (e) { data = {}; }\n  }\n\n  data.nueva_fecha = $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"]; \n\n  // 3. RETORNAR\n  return JSON.stringify(data);\n})()\n}}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        45472
      ],
      "id": "6dae666f-f2a7-4dff-8cfc-1ddc22ca22c7",
      "name": "Actualizar_estado (REPROGRAMAR_HORA)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üìÖ Fecha guardada. ¬øA qu√© Nueva Hora? (Ej: 15:30)",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        45472
      ],
      "id": "cceee3a2-8599-4905-bab5-15ee79bfa5f6",
      "name": "Mensaje_reprogramar_hora",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cita": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).id_cita_editar }}",
            "fecha": "={{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).nueva_fecha }}",
            "hora": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"] }}"
          },
          "matchingColumns": [
            "id_cita"
          ],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        44704
      ],
      "id": "744892c1-9fe7-478e-8d3f-ce5e8058da54",
      "name": "Reprogramar_cita",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CITAS",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        44704
      ],
      "id": "29daba5b-aa6d-4a29-8759-7d9ba30ffc8d",
      "name": "Actualizar_estado-reprogramar (volver MENU_CITAS)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "\nlet mensaje = \"üìÖ *Tu Agenda Actual:*\\n\\n\";\n\nfor (let i = 0; i < items.length; i++) {\n  const cita = items[i].json;\n  \n  // 3. Construimos el bloque de texto para cada cita\n  mensaje += `*${i + 1}.* üóì ${cita.fecha || \"Sin fecha\"} - ‚è∞ ${cita.hora || \"Sin hora\"}\\n`;\n  mensaje += `    üë§ Nombre: ${cita.nombre}\\n`;\n  mensaje += `    üìù Motivo: ${cita.motivo}\\n`;\n  mensaje += `    üîπ Estado: \\`${cita.estado}\\`\\n`; \n  mensaje += `    üÜî ID: \\`${cita.id_cita}\\`\\n`; \n  mensaje += `    -------------------------\\n`;\n}\n\nreturn [{ json: { texto_final: mensaje } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5120,
        52960
      ],
      "id": "e4ce5cca-e8d8-4045-85c9-c86d1e901b3a",
      "name": "Obtener_formater_citas (REPROGRAMAR_CITA)"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "={{ $('Obtener_formater_citas (REPROGRAMAR_CITA)').item.json.texto_final }}\n\nüëÜ Arriba tienes tus citas.\n\n‚úçÔ∏è Por favor, **copia y pega el ID** de la cita que deseas cambiar (Ej: `CITA-20260124...`).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        52960
      ],
      "id": "790ae8da-c5e1-4379-8c09-05170e45b75e",
      "name": "Mensaje_solicitar_cita_id",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
            "pantalla_actual": "REPROGRAMAR_ESPERAR_ID",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        52960
      ],
      "id": "a9b4cc04-7b8a-4eec-b90b-ecd00d0b3e6d",
      "name": "Actualizar_estado (REPROGRAMAR_ESPERAR_ID)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üîÑ *¬°Cita Reprogramada con √âxito!*  Se ha actualizado la fecha y hora de tu cita.  ¬øQu√© deseas hacer ahora? \n\n1. Agendar nueva \n2. Consultar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        44704
      ],
      "id": "6fb28d3f-bcdf-48d4-898d-c0923a2adcf7",
      "name": "Mensaje_reprogramar_cita_resultado",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "Pendiente"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        52288
      ],
      "id": "a613047a-46a5-4eba-b3ec-d4188f086551",
      "name": "Obtener_citas2",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "641737a1-1452-4fd6-a1fb-c7272fbe711c",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4896,
        52288
      ],
      "id": "1cd63017-322c-450e-b509-b4bffac9b082",
      "name": "IF_revisar_citas_cancelar"
    },
    {
      "parameters": {
        "jsCode": "\nlet mensaje = \"üìÖ *Tu Agenda Actual:*\\n\\n\";\n\nfor (let i = 0; i < items.length; i++) {\n  const cita = items[i].json;\n\n  mensaje += `*${i + 1}.* üóì ${cita.fecha || \"Sin fecha\"} - ‚è∞ ${cita.hora || \"Sin hora\"}\\n`;\n  mensaje += `    üë§ Nombre: ${cita.nombre}\\n`;\n  mensaje += `    üìù Motivo: ${cita.motivo}\\n`;\n  mensaje += `    üîπ Estado: \\`${cita.estado}\\`\\n`; \n  mensaje += `    üÜî ID: \\`${cita.id_cita}\\`\\n`; \n  mensaje += `    -------------------------\\n`;\n}\n\nreturn [{ json: { texto_final: mensaje } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5120,
        52192
      ],
      "id": "dfc13be5-e6c9-4eb6-a184-12d73e79885f",
      "name": "Obtener_cancelar_citas (CANCELAR_CITA)"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
            "pantalla_actual": "CANCELAR_ESPERAR_ID",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        52192
      ],
      "id": "89ab85ac-8ed2-456d-b89c-445e9874e357",
      "name": "Actualizar_estado (CANCELAR_ESPERAR_ID)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "={{ $node[\"Obtener_cancelar_citas (CANCELAR_CITA)\"].json[\"texto_final\"] }}\n\nüëÜ Aqu√≠ tienes tus citas activas.\n\nüóëÔ∏è Para cancelar una, por favor **copia y pega el ID** de la cita (Ej: `CITA-2025...`).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        52192
      ],
      "id": "08ac1aaa-5108-485a-9f37-34c74a126b9f",
      "name": "Mensaje_solicitar_cita_id_cancelar",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üóëÔ∏è *¬°Cita Cancelada!*\n\nLa cita ha sido eliminada de tu agenda activa.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        45280
      ],
      "id": "fc3b62cb-83cf-45c1-88af-3cb42b7db0bc",
      "name": "Mensaje_cancelar_cita_resultado",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cita": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"] }}",
            "estado": "Cancelada"
          },
          "matchingColumns": [
            "id_cita"
          ],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        45280
      ],
      "id": "0c299300-1dcf-49f3-a201-bb39500b2665",
      "name": "Actualizar_campo (CANCELAR)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CITAS",
            "paso_actual": "0",
            "datos_parciales": "-"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        45280
      ],
      "id": "c71dde2a-3ee9-452b-aae1-f7fe11ba6922",
      "name": "Actualizar_estado_cancelar (MENU_CITAS)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}"
            },
            {
              "lookupColumn": "estado",
              "lookupValue": "Pendiente"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        52672
      ],
      "id": "b5569897-a086-4903-99d2-63f8e46315ef",
      "name": "Obtener_citas3",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "641737a1-1452-4fd6-a1fb-c7272fbe711c",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4896,
        52672
      ],
      "id": "95a541cc-d26f-4e05-b7ed-f8a791fb19d8",
      "name": "IF_revisar_citas_completar"
    },
    {
      "parameters": {
        "jsCode": "\nlet mensaje = \"üìÖ *Tu Agenda Actual:*\\n\\n\";\n\nfor (let i = 0; i < items.length; i++) {\n  const cita = items[i].json;\n\n  mensaje += `*${i + 1}.* üóì ${cita.fecha || \"Sin fecha\"} - ‚è∞ ${cita.hora || \"Sin hora\"}\\n`;\n  mensaje += `    üë§ Nombre: ${cita.nombre}\\n`;\n  mensaje += `    üìù Motivo: ${cita.motivo}\\n`;\n  mensaje += `    üîπ Estado: \\`${cita.estado}\\`\\n`; \n  mensaje += `    üÜî ID: \\`${cita.id_cita}\\`\\n`; \n  mensaje += `    -------------------------\\n`;\n}\n\nreturn [{ json: { texto_final: mensaje } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5120,
        52576
      ],
      "id": "5362d6ef-c1b3-4345-9c5c-9d86045f6379",
      "name": "Obtener_completar_citas (CCOMPLETAR_CITA)"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
            "pantalla_actual": "COMPLETAR_ESPERAR_ID",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        52576
      ],
      "id": "e0c86b09-5709-4c77-bfa4-40e393690ded",
      "name": "Actualizar_estado (COMPLETAR_ESPERAR_ID)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "={{ $node[\"Obtener_completar_citas (CCOMPLETAR_CITA)\"].json[\"texto_final\"] }}\n\nüëÜ Aqu√≠ tienes tus citas pendientes.\n\n‚úÖ Para marcar una como realizada, **copia y pega el ID** de la cita (Ej: `CITA-2025...`).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        52576
      ],
      "id": "50d17123-ae13-459f-a832-88f85da19cb6",
      "name": "Mensaje_solicitar_cita_id_completar",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cita": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"] }}",
            "estado": "Completada"
          },
          "matchingColumns": [
            "id_cita"
          ],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        45088
      ],
      "id": "c8711752-1c6c-485c-82e9-7a8608ce76c7",
      "name": "Actualizar_campo (COMPLETAR)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CITAS",
            "paso_actual": "0",
            "datos_parciales": "-"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        45088
      ],
      "id": "4e184ce9-2145-4861-afd5-190b98ec336a",
      "name": "Actualizar_estado_completar (MENU_CITAS)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üéâ *¬°Excelente! Cita marcada como completada.*\n\nSe ha guardado en tu historial.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        45088
      ],
      "id": "0f639cde-67db-4708-9d77-5c3a260402e0",
      "name": "Mensaje_completar_cita_resultado",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üì≠ *No tienes citas para cancrlar.*\n\nTu agenda est√° libre por ahora. Si quieres agendar una, elige la opci√≥n 1 en el men√∫ anterior.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        52384
      ],
      "id": "7e220f12-b305-4255-b301-804173b3065b",
      "name": "Mensaje_sin_citas_cancelar",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üì≠ *No tienes citas pendientes.*\n\nTu agenda est√° libre por ahora. Si quieres agendar una, elige la opci√≥n 1 en el men√∫ anterior.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        52768
      ],
      "id": "573654b6-9f4d-4640-84cd-eabf2873f62d",
      "name": "Mensaje_sin_citas_completar",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "38f29dd4-22dc-4f60-8034-104b08f759c2"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "91595c7f-cb48-4f06-a331-8d8016e10989",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "52b8306b-4fc7-497d-8f26-c75ab916b7ac",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"6\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "7822bff0-b809-448a-bc3b-546eeb2ea936",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"7\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5900d2d6-4eb6-42a5-b6e7-0792e9b6745e",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"8\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        41232
      ],
      "id": "cfc56d6d-6bb2-4322-84a9-b8bbd2b16a95",
      "name": "Switch_menu_principal"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_CONFIGURACION",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        41536
      ],
      "id": "87338106-dcff-4d53-a75c-224d4936b1dc",
      "name": "Actualizar_estado (MENU_CONFIGURACION)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=‚öôÔ∏è *Configuraci√≥n*\n\nAqu√≠ puedes gestionar tu cuenta y el bot.\n\n1. üë§ Ver mi perfil\n2Ô∏è. üîÑ Reiniciar conversaci√≥n (Si algo falla)\n3Ô∏è. üîô Volver al men√∫ principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        41536
      ],
      "id": "9735ac2d-7d7f-409d-9946-24af2a3b8a75",
      "name": "Mensaje_menu_configuracion",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e69cfef1-495d-4e90-9e9d-5ff6ea637623"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f4c25ecd-267c-4c0f-a971-b5b38d38d2b4",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "9f5e1107-b9bc-4848-a57f-2a6b8146238e",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        49872
      ],
      "id": "96088ccd-0a50-42e2-ae1c-5e22b0487a23",
      "name": "Switch_menu_configuracion"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üë§ *Tu Perfil de Usuario*\n\n*Nombre:* {{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"first_name\"] }}\n*Apellido:* {{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"last_name\"] }}\n*ID de Usuario:* `{{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}`\n*Idioma:* {{ $node[\"Telegram Trigger1\"].json[\"message\"][\"from\"][\"language_code\"] }}\n\n‚ÑπÔ∏è _Este ID es √∫nico y sirve para identificar tu agenda._",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        49600
      ],
      "id": "7a2b3862-35a9-458b-a4ea-8203c605eb09",
      "name": "Mensaje_user_info",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "",
            "datos_parciales": "={}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        49792
      ],
      "id": "05749565-7cca-4f3c-8c3d-810795216048",
      "name": "Actualizar_estado_reinicio (MENU_PRINCIPAL)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üîÑ *¬°Bot Reiniciado!*\n\nHe borrado la memoria temporal de nuestra conversaci√≥n. Estamos listos para empezar de nuevo.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        49792
      ],
      "id": "dc2806f2-309c-4d2d-9f6e-6f552260e406",
      "name": "Mensaje_user_reinicio",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=Hola, soy AgendaBot üëã\n\nEstoy aqu√≠ para ayudarte a organizar tus citas, tareas y recordatorios\nde forma sencilla y sin complicaciones.\n\nPuedes escribirme en cualquier momento.\nPara avanzar, solo tienes que escribir el n√∫mero de la opci√≥n que quieras usar.\n\nMen√∫ principal:\n0. Ayuda\n1. Agenda (citas)\n2. Tareas\n3. Recordatorios\n4. H√°bitos\n5. Listas\n6. Reportes\n7. Configuraci√≥n\n8. Administrador",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        49792
      ],
      "id": "4cb67b4c-2e74-40c0-8681-ca046aada30d",
      "name": "Mensaje_user_menu_principal",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        49984
      ],
      "id": "8746cfaa-f256-497b-a124-b0df5a9410b2",
      "name": "Menu Principal_regreso",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "e556100d-4272-4a61-8297-59b04fba537a",
              "leftValue": "={{ $json.rol }}",
              "rightValue": "administrador",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4896,
        40768
      ],
      "id": "caa18ab8-a391-4dd3-85e9-344b2254c2fe",
      "name": "If_es_ADMIN?"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2006573822,
          "mode": "list",
          "cachedResultName": "USUARIOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=2006573822"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "rol",
              "lookupValue": "administrador"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        40768
      ],
      "id": "d306ab97-5e91-4f13-99a0-646ed3b3eabb",
      "name": "Obtener_usuario",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=‚õî *Acceso Denegado*\n\nEsta opci√≥n est√° reservada √∫nicamente para administradores del sistema.\n\nüëÆ‚Äç‚ôÇÔ∏è Tu intento ha sido registrado.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        41824
      ],
      "id": "bc521f71-2399-457a-8da8-02fa7e3334b4",
      "name": "Mensaje_denegacion_permiso",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_ADMIN",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        40672
      ],
      "id": "d059dce6-322d-4e95-bad9-c36a21bbcd82",
      "name": "Actualizar_estado (MENU_ADMIN)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üïµÔ∏è‚Äç‚ôÇÔ∏è *Panel de Administrador*\n\nBienvenido, Jefe. ¬øQu√© deseas supervisar?\n\n1Ô∏è. üåç Ver TODAS las citas (Global)\n2Ô∏è. üìä Ver Estad√≠sticas (Usuarios/Citas)\n3Ô∏è. üì¢ Enviar Anuncio Global (Broadcast)\n4Ô∏è. üîô Volver al Men√∫ Principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        40672
      ],
      "id": "af0883d0-1e8b-4018-94ef-2d8cbae488fc",
      "name": "Mensaje_MENU_ADMIN",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "19ceeda5-942f-465e-85e4-7fc624f631ed"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28eafc6a-73a5-46c5-b43b-4e312f7742c5",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "84e5e911-17f3-43cc-a901-71de7f7bea54",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4ffed133-ead8-46d0-b73d-7e2de83accc0",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"4\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        49152
      ],
      "id": "35acb0be-353f-468c-a143-edbfc358aa96",
      "name": "Switch_ADMIN"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        48640
      ],
      "id": "308dba87-3bed-43b1-936b-bf101f345824",
      "name": "Obtener_citas_global",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "641737a1-1452-4fd6-a1fb-c7272fbe711c",
              "leftValue": "={{ $input.all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4896,
        48640
      ],
      "id": "4d66265d-26ff-4ba8-a049-53d068577e13",
      "name": "IF_revisar_citas_global"
    },
    {
      "parameters": {
        "jsCode": "\nlet mensaje = \"üìÖ *Tu Agenda Actual:*\\n\\n\";\n\nfor (let i = 0; i < items.length; i++) {\n  const cita = items[i].json;\n\n  mensaje += `*${i + 1}.* üóì ${cita.fecha || \"Sin fecha\"} - ‚è∞ ${cita.hora || \"Sin hora\"}\\n`;\n  mensaje += `    üë§ Nombre: ${cita.nombre}\\n`;\n  mensaje += `    üìù Motivo: ${cita.motivo}\\n`;\n  mensaje += `    üîπ Estado: \\`${cita.estado}\\`\\n`; \n  mensaje += `    üÜî ID: \\`${cita.id_cita}\\`\\n`; \n  mensaje += `    -------------------------\\n`;\n}\n\nreturn [{ json: { texto_final: mensaje } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5120,
        48544
      ],
      "id": "eeaff733-3188-46f8-bde8-6999dce5b540",
      "name": "Obtener_citas (global)"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=No hay citas agendadas globalmente.\n\n(ADMIN)",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        48832
      ],
      "id": "adc8d9a9-65ba-441b-b15f-abd74ef7462b",
      "name": "Mensaje_sin citas_global",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=AGENDAMIENTOS GLOBALES:\n\n{{ $json.texto_final }}\n\nADMIN",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        48544
      ],
      "id": "ba060b7b-6ca4-4a4e-8664-1271064cf736",
      "name": "Mensaje_citas_global",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        49408
      ],
      "id": "b5b71f6c-806c-4e58-b75b-8606911c3879",
      "name": "Obtener_citas_global_estadisticas",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        49408
      ],
      "id": "ebcacc10-d2c1-4f41-9dfe-175f4476b989",
      "name": "Obtener_sesiones_global_estadisticas",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let usuariosRaw = [];\nlet citasRaw = [];\n\ntry {\n    usuariosRaw = $items(\"Obtener_sesiones_global_estadisticas\"); \n} catch (e) {}\n\ntry {\n    citasRaw = $items(\"Obtener_citas_global_estadisticas\"); \n} catch (e) {\n    citasRaw = [];\n}\n\nconst usuariosReales = usuariosRaw.filter(u => u.json.telegram_user && u.json.telegram_user !== \"\");\n\nconst citasReales = citasRaw.filter(c => c.json.id_cita && c.json.id_cita !== \"\");\n\nconst citasPendientes = citasReales.filter(c => c.json.estado === 'Pendiente').length;\n\nconst msg = `üìä *Estad√≠sticas del Bot*\n\nüë• *Usuarios Reales:* ${usuariosReales.length}\nüìÖ *Citas Totales:* ${citasReales.length}\n‚è≥ *Pendientes:* ${citasPendientes}\n\n‚úÖ _Datos verificados._`;\n\nreturn [{ json: { msg: msg } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5120,
        49408
      ],
      "id": "7fb6f698-cc51-4d99-8361-ae03910cbda5",
      "name": "Formatear_campos_estadisticas",
      "executeOnce": true
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "={{ $json[\"msg\"] }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        49408
      ],
      "id": "3efae5f1-cfdf-4d29-97cf-72352afc887e",
      "name": "Mensaje_sin citas_global1",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "ADMIN_BROADCAST",
            "paso_actual": "0",
            "datos_parciales": "-"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        48832
      ],
      "id": "21796a84-a6a7-4dcf-837d-0050f189febd",
      "name": "Actualizar_estado (ADMIN_BROADCAST)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üì¢ *Nuevo Anuncio Global*\n\nPor favor, escribe el mensaje que quieres enviar a TODOS los usuarios.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        48832
      ],
      "id": "f8abb36c-ad9d-4d17-9db5-47f97477c4b5",
      "name": "Mensaje_solicitar_broadcast_global",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "ADMIN_BROADCAST_CONFIRMAR",
            "paso_actual": "0",
            "datos_parciales": "={{ JSON.stringify({ \"mensaje_broadcast\": $node[\"Telegram Trigger1\"].json[\"message\"][\"text\"] }) }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4448,
        45952
      ],
      "id": "9287db1b-85ac-42f1-b347-332e9cc90c04",
      "name": "Actualizar_estado (ADMIN_BROADCAST_CONFIRMAR)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=üëÅÔ∏è *VISTA PREVIA DEL ANUNCIO:*\n--------------------------------\n{{ $('Telegram Trigger1').item.json.message.text }}\n--------------------------------\n\n¬øEst√°s seguro de enviar esto a todos los usuarios?\n1. ‚úÖ S√ç, ENVIAR AHORA\n2. ‚ùå NO, CANCELAR",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        45952
      ],
      "id": "f43b7d7c-1ac5-4635-8e06-1e64ed8f103f",
      "name": "Mensaje_previo_global",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "9226d60b-f282-4492-900b-6dbd5ab3dc54"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "aa959bfe-d3e3-406a-bd96-da0c69bc03a6",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        47584
      ],
      "id": "61cc114c-609f-4cf4-ac41-1655a30f2c26",
      "name": "Switch_confirmar_mensaje_global"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_ADMIN",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        47680
      ],
      "id": "10251044-aa67-4abb-9cfb-1f83fff437a0",
      "name": "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=Operaci√≥n cancelada.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        47680
      ],
      "id": "5a188019-8263-4d66-a83c-7345675d9e8c",
      "name": "Mensaje_cancelaci√≥n_global",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        47488
      ],
      "id": "7a289b54-1631-4149-a3de-2967db453e25",
      "name": "Obtener_sesiones_mensaje_global",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "031761d0-329c-4c50-a02e-55f8162049f6",
              "leftValue": "={{ $json.telegram_user }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.3,
      "position": [
        4896,
        47488
      ],
      "id": "1e6817f4-2f28-4355-8acf-f34850a28abe",
      "name": "Filter"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_ADMIN",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5344,
        47488
      ],
      "id": "77c32c4f-8888-4a16-a6e6-e6a928b0a818",
      "name": "Actualizar_estado_exitoso (MENU_ADMIN)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json[\"telegram_user\"] }}",
        "text": "=üì¢ *Anuncio Importante:*\n\nüì¢ *Anuncio Importante:*\n\n{{ JSON.parse($node[\"verificar_sesi√≥n\"].json[\"datos_parciales\"]).mensaje_broadcast }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        47488
      ],
      "id": "f3772cae-756f-4644-a26b-419283bf31f8",
      "name": "Mensaje_envio_global",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Mensaje enviado con exito, has sido devuelto al panel del administrador\n\nüïµÔ∏è‚Äç‚ôÇÔ∏è *Panel de Administrador*\n\n1Ô∏è. üåç Ver TODAS las citas (Global)\n2Ô∏è. üìä Ver Estad√≠sticas (Usuarios/Citas)\n3Ô∏è. üì¢ Enviar Anuncio Global (Broadcast)\n4Ô∏è. üîô Volver al Men√∫ Principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5568,
        47488
      ],
      "id": "e52cebd7-b29c-4a9f-8e6c-fdb5ad3a0c61",
      "name": "Mensaje_MENU_ADMIN1",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        49216
      ],
      "id": "35604618-3a26-4e27-b561-55d90ae28ccf",
      "name": "Actualizar_estado_cancelaci√≥n (MENU_PRINCIPAL)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=Saliendo al Men√∫ principal...\n(ADMIN)",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        49216
      ],
      "id": "f1c84047-5df3-4b45-92ac-822dff4b22d0",
      "name": "Mensaje_salir_admin",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        49216
      ],
      "id": "e2aa4454-9b68-4fba-b848-cadcec1c2e98",
      "name": "Menu Principal1",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        41728
      ],
      "id": "2b3d5798-ef33-419e-aa97-1ef64d9c8e51",
      "name": "Menu Principal2",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.from.first_name }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        38944
      ],
      "id": "d56394e2-f8e8-4adb-b282-a1beb0f118e0",
      "name": "Obtener_citas_verificacion_dovle_reserva",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "1cd39e6d-23ff-4171-a149-57e5fbb9bf61",
              "leftValue": "={{ $json[\"conflictCount\"] }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5568,
        38944
      ],
      "id": "67a8c01f-64e3-4355-9371-c0a19dab9c2d",
      "name": "If_citas_repetidas_fecha"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^\\d{4}-\\d{2}-\\d{2}$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4896,
        38656
      ],
      "id": "4244eb8c-4ff3-4f45-814d-09a06187687d",
      "name": "If_validar_formato_fecha"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^([01]\\d|2[0-3]):[0-5]\\d$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4896,
        39040
      ],
      "id": "b642ca82-6465-4c1b-af27-e02320444d60",
      "name": "If_validar_formato_hora"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "2c064515-ed9d-4706-aafd-b6338a08fcdf",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "={{ $now.setZone('America/Bogota').toFormat('yyyy-MM-dd') }}",
              "operator": {
                "type": "dateTime",
                "operation": "afterOrEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        45568
      ],
      "id": "ad176d40-7a85-4dcf-a4f5-1abf4db24375",
      "name": "If_validar_fecha_reprogramar1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^\\d{4}-\\d{2}-\\d{2}$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4448,
        45664
      ],
      "id": "2c91ae97-1639-4e9d-a1bc-12c2304b4e86",
      "name": "If_validar_formato_fecha_reprogramar1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la fecha no tiene el formato correcto.\n\nRecuerda usar: YYYY-MM-DD\nEjemplo: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        45760
      ],
      "id": "6c710861-9f88-4654-8548-61190caa99b2",
      "name": "Fecha Invalida_reprogramar1",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Hmm ü§î esa fecha ya pas√≥.\n\nPor favor ingresa una fecha futura.\n\nEjemplo: 2026-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        45760
      ],
      "id": "47fefa21-465e-4cb3-915b-dea3c70c4b07",
      "name": "Fecha en el pasado_reprogramar1",
      "webhookId": "431e9db7-ea8c-443c-bb82-65fa90992bd9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^([01]\\d|2[0-3]):[0-5]\\d$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4448,
        44800
      ],
      "id": "8826f34a-12a3-408e-b9db-7f6e2d060ccf",
      "name": "If_validar_formato_hora_reprogramar"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la hora no tiene un formato v√°lido.\n\nRecuerda usar formato 24 horas:\nHH:MM\n\nEjemplo: 14:30\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        44896
      ],
      "id": "378199ab-9b7d-4814-be46-b0ca2bd8dc9b",
      "name": "Hora Invalida_reprogramar",
      "webhookId": "89a3d27f-d5de-425c-8c71-1bdf700a711e",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^([01]\\d|2[0-3]):[0-5]\\d$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4448,
        44032
      ],
      "id": "b6415856-e6c2-407d-a52f-d58552499b6e",
      "name": "If_validar_formato_hora_actualizar"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la hora no tiene un formato v√°lido.\n\nRecuerda usar formato 24 horas:\nHH:MM\n\nEjemplo: 14:30\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        44128
      ],
      "id": "9f30938c-ddf5-49d2-a1d0-14444cb38051",
      "name": "Hora Invalida_actualizar",
      "webhookId": "89a3d27f-d5de-425c-8c71-1bdf700a711e",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la fecha no tiene el formato correcto.\n\nRecuerda usar: YYYY-MM-DD\nEjemplo: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        43552
      ],
      "id": "13bf9017-af0d-4375-be7b-e052c5f79253",
      "name": "Fecha Invalida_reprogramar",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Hmm ü§î esa fecha ya pas√≥.\n\nPor favor ingresa una fecha futura.\n\nEjemplo: 2026-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        43552
      ],
      "id": "7824b8ec-0d7b-4da7-81a4-f14ab1e98f61",
      "name": "Fecha en el pasado_reprogramar",
      "webhookId": "431e9db7-ea8c-443c-bb82-65fa90992bd9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8720a747-a549-41da-a2b5-4b7a230b865d",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "=^\\d{4}-\\d{2}-\\d{2}$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4448,
        43456
      ],
      "id": "4d4a0ad9-4507-42bf-b18a-17aced243498",
      "name": "If_validar_formato_fecha_reprogramar"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "2c064515-ed9d-4706-aafd-b6338a08fcdf",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "={{ $now.setZone('America/Bogota').toFormat('yyyy-MM-dd') }}",
              "operator": {
                "type": "dateTime",
                "operation": "afterOrEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        43360
      ],
      "id": "2ea45746-88bf-46ad-8dbf-417ad46f485c",
      "name": "If_fecha_v√°lida_reprogramar"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_RECORDATORIOS",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        41152
      ],
      "id": "32bb812f-3863-4104-9dba-65c5124178df",
      "name": "Actualizar_estado (MENU_RECORDATORIOS)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "11f20b04-e6fd-4377-8a88-119ba53234a8"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "404735d4-b0ce-49f1-a877-311c79b0535f",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e6b3ddff-3dca-4ac5-8876-6f0ee8bc8d1e",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        47088
      ],
      "id": "cb56a418-d69d-4096-85af-e249e2c8c6f1",
      "name": "Switch_menu_recordatorios"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "REC_CAMBIAR_TIEMPO",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        46720
      ],
      "id": "80a6aa3c-4ebc-40df-9530-9150bf6d0cad",
      "name": "Actualizar_estado (REC_CAMBIAR_TIEMPO)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json[\"telegram_user\"] }}",
        "text": "=‚è±Ô∏è *Selecciona la antelaci√≥n:*\n\n¬øCu√°nto tiempo antes de la cita quieres recibir el mensaje?\n\n1. ‚ö° 30 Minutos antes\n2. üïê 1 Hora antes\n3. üìÖ 1 D√≠a antes (24h)\n4. üîô Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        46720
      ],
      "id": "a1839ab2-1f69-4082-9625-cc3df499f1d6",
      "name": "Mensaje_submenu_recordatorio",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "preferencia_aviso": "30"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencia_aviso",
              "displayName": "preferencia_aviso",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "alertas_activas",
              "displayName": "alertas_activas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        47872
      ],
      "id": "ddf181c4-0138-43a6-9926-1b96755074da",
      "name": "Cambiar_preferencia (30 min)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_RECORDATORIOS",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        48256
      ],
      "id": "ac6d8adc-a7f8-4482-873e-40a09939b56e",
      "name": "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)1",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üîî *Configuraci√≥n de Recordatorios*\n\nAqu√≠ decides cu√°ndo quieres que te avise de tus citas.\n\n‚öôÔ∏è *Tu configuraci√≥n actual:*\n‚Ä¢ Tiempo: {{ $node[\"verificar_sesi√≥n\"].json[\"preferencia_aviso\"] || 60 }} min antes.\n‚Ä¢ Estado: {{ $node[\"verificar_sesi√≥n\"].json[\"alertas_activas\"] == \"FALSE\" ? \"üîï Apagado\" : \"üîî Encendido\" }}\n\n1Ô∏è. Cambiar tiempo de aviso (30min / 1h / 1 d√≠a)\n2Ô∏è. Apagar/Encender notificaciones\n3Ô∏è. üîô Volver al men√∫ principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        41152
      ],
      "id": "696c1c47-1237-47f5-972d-44013b94e407",
      "name": "Mensaje_Menue_recordatorios",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üîî *Configuraci√≥n de Recordatorios*\n\nAqu√≠ decides cu√°ndo quieres que te avise de tus citas.\n\n‚öôÔ∏è *Tu configuraci√≥n actual:*\n‚Ä¢ Tiempo: {{ $node[\"verificar_sesi√≥n\"].json[\"preferencia_aviso\"] || 60 }} min antes.\n‚Ä¢ Estado: {{ $node[\"verificar_sesi√≥n\"].json[\"alertas_activas\"] == \"FALSE\" ? \"üîï Apagado\" : \"üîî Encendido\" }}\n\n1Ô∏è. Cambiar tiempo de aviso (30min / 1h / 1 d√≠a)\n2Ô∏è. Apagar/Encender notificaciones\n3Ô∏è. üîô Volver al men√∫ principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        48256
      ],
      "id": "55b4d023-1e28-4b88-9160-0cf63741d682",
      "name": "Mensaje_Menu_recordatorios_volver",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ee38d133-05be-48b9-900a-0e5b727d53db"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d85c1447-d74f-4104-921b-d94884eb77e6",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "3bfb9a3f-a83b-4c67-8316-6833a0006b65",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4d10898c-8f21-46e7-b20b-c09bf3312d41",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"4\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        48224
      ],
      "id": "dd2f7ac9-8867-4c1a-ad58-305b75418d23",
      "name": "Switch_preferencia_recordatorios"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "preferencia_aviso": "60"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencia_aviso",
              "displayName": "preferencia_aviso",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "alertas_activas",
              "displayName": "alertas_activas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        48064
      ],
      "id": "cd3ebc59-ae53-403b-80a2-f60a28f57c65",
      "name": "Cambiar_preferencia (1h)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "preferencia_aviso": "1440"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencia_aviso",
              "displayName": "preferencia_aviso",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "alertas_activas",
              "displayName": "alertas_activas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        48256
      ],
      "id": "f88ddd49-5800-4d04-a501-81e4c8c81134",
      "name": "Cambiar_preferencia (1D)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_RECORDATORIOS",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        48448
      ],
      "id": "af3a66a2-974d-49ce-93f9-297c11c9d6ae",
      "name": "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)3",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=‚úÖ Configuraci√≥n actualizada",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        48256
      ],
      "id": "54e4fd5c-ff2a-45e3-8166-8135e6300041",
      "name": "Mensaje_preferencia_cambiada",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "paso_actual": "0",
            "timestamp_ultima_interaccion": "={{$now}}",
            "alertas_activas": "={{ $node[\"verificar_sesi√≥n\"].json[\"alertas_activas\"] == \"TRUE\" ? \"FALSE\" : \"TRUE\" }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "preferencia_aviso",
              "displayName": "preferencia_aviso",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "alertas_activas",
              "displayName": "alertas_activas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        46912
      ],
      "id": "50436399-0b51-489b-be58-d00f2a48de78",
      "name": "Cambiar_aviso",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json[\"telegram_user\"] }}",
        "text": "=üîÑ *Cambio realizado*\n\nEl estado de tus notificaciones ha cambiado.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        46912
      ],
      "id": "719c6dda-e3f6-414f-bba3-778b9120337f",
      "name": "Mensaje_cambiar_aviso",
      "webhookId": "21ceb000-bd6f-4287-8ed6-a0a8e7cef777",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "datos_parciales": "={}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "preferencia_aviso",
              "displayName": "preferencia_aviso",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "alertas_activas",
              "displayName": "alertas_activas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        47296
      ],
      "id": "b6b99812-fd8e-4682-91c7-436e596969e6",
      "name": "Actualizar_estado_recordatorios (MENU_PRINCIPAL)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"][\"id\"] }}",
        "text": "=Hola, soy AgendaBot üëã\n\nEstoy aqu√≠ para ayudarte a organizar tus citas, tareas y recordatorios\nde forma sencilla y sin complicaciones.\n\nPuedes escribirme en cualquier momento.\nPara avanzar, solo tienes que escribir el n√∫mero de la opci√≥n que quieras usar.\n\nMen√∫ principal:\n0. Ayuda\n1. Agenda (citas)\n2. Tareas\n3. Recordatorios\n4. H√°bitos\n5. Listas\n6. Reportes\n7. Configuraci√≥n\n8. Administrador",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        47296
      ],
      "id": "f43ca8f1-8500-49cf-ba48-df203c642349",
      "name": "Mensaje_volver_recordatorio_menu_principal",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        38368
      ],
      "id": "537ad695-d227-47f0-85d1-9be1da228009",
      "name": "Menu Principal3",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=üîî *Configuraci√≥n de Recordatorios*\n\nAqu√≠ decides cu√°ndo quieres que te avise de tus citas.\n\n‚öôÔ∏è *Tu configuraci√≥n actual:*\n‚Ä¢ Tiempo: {{ $node[\"verificar_sesi√≥n\"].json[\"preferencia_aviso\"] || 60 }} min antes.\n‚Ä¢ Estado: {{ $node[\"verificar_sesi√≥n\"].json[\"alertas_activas\"] == \"FALSE\" ? \"üîï Apagado\" : \"üîî Encendido\" }}\n\n1Ô∏è. Cambiar tiempo de aviso (30min / 1h / 1 d√≠a)\n2Ô∏è. Apagar/Encender notificaciones\n3Ô∏è. üîô Volver al men√∫ principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        46912
      ],
      "id": "462a80a0-6851-45d2-98c1-3c92ee73d3cd",
      "name": "Mensaje_Menu_recordatorios_aviso",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('Telegram Trigger1').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        46144
      ],
      "id": "96ab6b62-699a-4396-be38-c9b14e968782",
      "name": "Obtener_citas_reportes",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const citas = $input.all().map(item => item.json);\nconst ZONA_HORARIA = 'America/Bogota';\n\nif (citas.length === 0) {\n  return [{ json: { mensaje: \"üì≠ **Sin Historial**\\n\\nA√∫n no tienes citas registradas en nuestro sistema.\" } }];\n}\n\nlet total = citas.length;\nlet pendientes = 0;\nlet canceladas = 0;\nlet finalizadas = 0;\n\nconst listaPendientes = [];\nconst listaHistorial = [];\n\nconst ahora = DateTime.now().setZone(ZONA_HORARIA);\n\nfor (const c of citas) {\n  const estado = (c.estado || \"\").toLowerCase();\n  \n  let horaLimpia = c.hora ? c.hora.toString().trim() : \"00:00\";\n  if (horaLimpia.indexOf(':') === 1) horaLimpia = \"0\" + horaLimpia;\n  const fechaIso = `${c.fecha}T${horaLimpia}:00`;\n  const fechaObj = DateTime.fromISO(fechaIso, { zone: ZONA_HORARIA });\n\n  if (estado.includes('cancel')) {\n    canceladas++;\n  } else if (fechaObj.isValid && fechaObj > ahora && estado !== 'finalizada') {\n    pendientes++;\n    listaPendientes.push({ fecha: c.fecha, hora: c.hora, obj: fechaObj });\n  } else {\n    finalizadas++;\n    listaHistorial.push({ fecha: c.fecha, hora: c.hora, estado: c.estado, obj: fechaObj });\n  }\n}\n\nlistaPendientes.sort((a, b) => a.obj - b.obj);\n\nlistaHistorial.sort((a, b) => b.obj - a.obj);\n\nlet msg = `üìä **TU REPORTE DE ACTIVIDAD**\\n`;\nmsg += `-----------------------------\\n`;\nmsg += `üìÖ Total Citas: **${total}**\\n`;\nmsg += `‚úÖ Asistidas/Pasadas: **${finalizadas}**\\n`;\nmsg += `‚è≥ Pendientes: **${pendientes}**\\n`;\nmsg += `üö´ Canceladas: **${canceladas}**\\n\\n`;\n\nif (listaPendientes.length > 0) {\n  const proxima = listaPendientes[0];\n  msg += `üöÄ **Tu Pr√≥xima Cita:**\\n`;\n  msg += `üóì ${proxima.fecha} a las ${proxima.hora}\\n\\n`;\n}\n\nif (listaHistorial.length > 0) {\n  msg += `üìú **Historial Reciente:**\\n`;\n  for (let i = 0; i < Math.min(3, listaHistorial.length); i++) {\n    const h = listaHistorial[i];\n    msg += `‚Ä¢ ${h.fecha} - ${h.estado || 'Finalizada'}\\n`;\n  }\n} else {\n    msg += `üìú **Historial:** A√∫n no tienes citas pasadas.`;\n}\n\nreturn [{ json: { mensaje: msg } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4896,
        46144
      ],
      "id": "22b98fa1-2ad4-4cfb-9c1c-55bbebf0716c",
      "name": "Procesar_reporte"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"]['id'] }}",
        "text": "={{ $json[\"mensaje\"] }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        46144
      ],
      "id": "1af9f7bb-de1f-4e97-a29b-87a11cdd6660",
      "name": "Mensaje_reporte",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "",
            "datos_parciales": "={}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        49984
      ],
      "id": "d2c93a30-62b0-4d19-9e50-ab8ca844f8e5",
      "name": "Actualizar_estado_regreso (MENU_PRINCIPAL)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_PRINCIPAL",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f3f4f434-051e-44c0-8efc-a4999d4e9480"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "2b381b4c-36e3-43b7-a1e6-85fdc2cab3f7",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "AGENDAR",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4bc74d3f-e04d-4ba8-9ea2-b5c552e58045",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "VER_TAREAS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "c2c1da07-4dec-40ba-b975-8136a3d1716c",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_CITAS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5fe7b320-8cd9-4a51-a352-8e9597ae88d6",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "CONFIRMACION_CITA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "3036d160-6de1-42bf-9fab-2ec09275ba88",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_EDITAR",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "2b4b63cb-c605-4e31-928f-9c2ac0eb4bda",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "EDITAR_FECHA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f402180b-d94f-4ccf-944b-b7ed7af32094",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "EDITAR_NOMBRE",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "0bc45694-e9b0-47bf-977f-0f96875fe1d7",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "EDITAR_HORA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "2d3b638b-f9f4-4afc-8cc9-4bc37c907729",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "EDITAR_MOTIVO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "6cd9ea69-7844-440c-80c2-410ae0acf72a",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "EDITAR_CANAL",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "00ceec0c-d319-4ab9-8370-44251b5c6d05",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "REPROGRAMAR_ESPERAR_ID",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "3f79320d-4e00-4702-b9a4-2dd5cc8918e8",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "REPROGRAMAR_FECHA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "82494dc6-c6e0-41cc-a649-5cb6ac55d6eb",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "REPROGRAMAR_HORA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "dd1ab552-b179-421e-8dc1-2c21d6d7927e",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "CANCELAR_ESPERAR_ID",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "9b801476-b0c3-4ad0-8adc-a6614f99e7dc",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "COMPLETAR_ESPERAR_ID",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b677689b-5a9f-4903-82c3-7df31b4d1481",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_CONFIGURACION",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "11e32e75-854d-49ed-b1d7-0c4514db52b9",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_ADMIN",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "498d9634-699d-49e5-b15f-765b8b30cb99",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "ADMIN_BROADCAST",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "945cbe81-f3ed-4902-aa28-6f16a3c87e20",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "ADMIN_BROADCAST_CONFIRMAR",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "3f69b34a-8995-42af-9e55-2e381ba4add1",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_RECORDATORIOS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "c9971cec-3f0a-45d9-a4f8-81bd234b5997",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "REC_CAMBIAR_TIEMPO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ddcef87a-cd81-48a7-b7ea-66819e839969",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "MENU_REPORTES",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b00819aa-a7f2-4748-bf6f-93c6e28ba189",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "CONFIRMACION_REPORTES",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "853c6c63-8af7-4cc7-a5ad-82a3925d3d97",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "VERIFICACION",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4224,
        45296
      ],
      "id": "615ee853-6cde-40ea-8202-9260010384b3",
      "name": "CEREBRO_PRINCIPAL1"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Hmm ü§î esa fecha ya pas√≥.\n\nPor favor ingresa una fecha futura.\n\nEjemplo: 2026-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        38656
      ],
      "id": "935c8b0f-a1ed-40e3-83bb-dede6f14ce88",
      "name": "Fecha en el pasado1",
      "webhookId": "431e9db7-ea8c-443c-bb82-65fa90992bd9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups üòÖ la fecha no tiene el formato correcto.\n\nRecuerda usar: YYYY-MM-DD\nEjemplo: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5120,
        38752
      ],
      "id": "7a448d0e-dcfd-4dc2-8532-f6eff195c1d8",
      "name": "Fecha Invalida2",
      "webhookId": "032cae0e-0c44-46ea-ab8d-e61649d9bca9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Ups, esa opci√≥n no existe en este men√∫ üòÖ\n\nPor favor escribe uno de los n√∫meros que ves en pantalla.\n\nEst√°s en: {{ $json.pantalla_actual }}\nOpciones disponibles: 0 al 8\n\nüëâ Tip: escribe solo el n√∫mero (por ejemplo: 1).",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4448,
        50176
      ],
      "id": "58452c8d-8259-4137-bdd6-12d2e8abd78b",
      "name": "Opci√≥n No Valida1",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Hola, soy AgendaBot üëã\n\nEstoy aqu√≠ para ayudarte a organizar tus citas, tareas y recordatorios\nde forma sencilla y sin complicaciones.\n\nPuedes escribirme en cualquier momento.\nPara avanzar, solo tienes que escribir el n√∫mero de la opci√≥n que quieras usar.\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nTip r√°pido:\nescribe solo el n√∫mero (por ejemplo: 1) y presiona enviar.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4896,
        40480
      ],
      "id": "e059145d-a5a9-4385-b44f-76629e8e6bce",
      "name": "Bienvenida1",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "\nlet mensaje = \"üìÖ *Tu Agenda Actual:*\\n\\n\";\n\nfor (let i = 0; i < items.length; i++) {\n  const cita = items[i].json;\n  \n  // 3. Construimos el bloque de texto para cada cita\n  mensaje += `*${i + 1}.* üóì ${cita.fecha || \"Sin fecha\"} - ‚è∞ ${cita.hora || \"Sin hora\"}\\n`;\n  mensaje += `    üë§ Nombre: ${cita.nombre}\\n`;\n  mensaje += `    üìù Motivo: ${cita.motivo}\\n`;\n  mensaje += `    üîπ Estado: \\`${cita.estado}\\`\\n`; \n  mensaje += `    üÜî ID: \\`${cita.id_cita}\\`\\n`;\n  mensaje += `    -------------------------\\n`;\n}\n\nmensaje += \"\\n¬øQu√© deseas hacer ahora? (Elige una opci√≥n del men√∫ anterior)\";\n\nreturn [{ json: { texto_final: mensaje } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5120,
        51520
      ],
      "id": "b72cfa50-4fa0-4c61-b75d-9b9298f16876",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "jsCode": "// 1. Traemos todas las citas\nconst citas = $input.all();\n\nlet fechaDeseada = \"\";\nlet horaDeseada = \"\";\n\ntry {\n    // Obtenemos los datos del usuario\n    fechaDeseada = JSON.parse($items(\"verificar_sesi√≥n\")[0].json[\"datos_parciales\"]).fecha;\n    horaDeseada = $items(\"Telegram Trigger1\")[0].json[\"message\"][\"text\"];\n} catch (e) { }\n\n// FUNCI√ìN DE AYUDA: Limpia la hora para quedarse solo con HH:MM\n// Convierte \"14:30:00\" -> \"14:30\" y \"14:30\" -> \"14:30\"\nconst limpiarHora = (h) => {\n    if (!h) return \"\";\n    return h.toString().trim().substring(0, 5); // Toma solo los primeros 5 caracteres\n};\n\n// 2. Buscamos conflictos usando la hora limpia\nconst conflictos = citas.filter(item => {\n    const c = item.json;\n    \n    // Normalizamos las horas antes de comparar\n    const horaSheet = limpiarHora(c.hora);\n    const horaUser = limpiarHora(horaDeseada);\n\n    // LOGICA DE COLISI√ìN:\n    // - Misma Fecha\n    // - Misma Hora (ignorando segundos)\n    // - Estado NO es 'Cancelada' (Ocupado si es Pendiente, Completada, etc.)\n    return c.fecha == fechaDeseada && \n           horaSheet == horaUser && \n           c.estado != 'Cancelada';\n});\n\n// 3. Devolvemos el resultado\nreturn [{\n    json: {\n        conflictCount: conflictos.length,\n        debug: `Compar√© ${fechaDeseada} ${limpiarHora(horaDeseada)} con ${citas.length} citas.` // Info extra para ti\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5344,
        38944
      ],
      "id": "a3967d48-c46e-4436-9410-a1176dd60bd2",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "2c064515-ed9d-4706-aafd-b6338a08fcdf",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "={{ $now.setZone('America/Bogota').toFormat('yyyy-MM-dd') }}",
              "operator": {
                "type": "dateTime",
                "operation": "afterOrEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        5120,
        38560
      ],
      "id": "bc772ff4-b98f-43f1-b210-67b7a677b0ae",
      "name": "If1"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"timestamp\": {{$now}},\n  \"telegram_user\": {{ $json.telegram_user }},\n  \"pantalla\": {{ $json.pantalla_actual }},\n  \"opcion_elegida\": {{ $('Telegram Trigger1').item.json.message.text }},\n  \"resultado\": {{ \"opcion \" +  $('Telegram Trigger1').item.json.message.text + \" del menu \" +$('verificar_sesi√≥n').item.json.pantalla_actual + \" ejecutada correctamente\"}}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4672,
        49024
      ],
      "id": "9558e0a0-9023-4133-b910-4af808f413a3",
      "name": "Edit To Log4"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "96CkwDJcwArTtA-CZJMvh",
          "mode": "list",
          "cachedResultUrl": "/workflow/96CkwDJcwArTtA-CZJMvh",
          "cachedResultName": "My Sub-Workflow 2"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        4896,
        49024
      ],
      "id": "457f70b8-d5e4-49d6-89ce-753a13965640",
      "name": "Call 'My Sub-Workflow 2'4"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"timestamp\": {{$now}},\n  \"telegram_user\": {{ $json.telegram_user }},\n  \"pantalla\": {{ $json.pantalla_actual }},\n  \"opcion_elegida\": {{ $('Telegram Trigger1').item.json.message.text }},\n  \"resultado\": {{ \"opcion \" +  $('Telegram Trigger1').item.json.message.text + \" del menu \" +$('verificar_sesi√≥n').item.json.pantalla_actual + \" ejecutada correctamente\"}}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4672,
        47104
      ],
      "id": "e0c97cac-9a92-4e2d-8c49-8ff666f1a1e6",
      "name": "Edit To Log5"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "96CkwDJcwArTtA-CZJMvh",
          "mode": "list",
          "cachedResultUrl": "/workflow/96CkwDJcwArTtA-CZJMvh",
          "cachedResultName": "My Sub-Workflow 2"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        4896,
        47104
      ],
      "id": "70dbacd4-7df0-4d8f-adea-dbc083d9840c",
      "name": "Call 'My Sub-Workflow 2'5"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"timestamp\": {{$now}},\n  \"telegram_user\": {{ $json.telegram_user }},\n  \"pantalla\": {{ $json.pantalla_actual }},\n  \"opcion_elegida\": {{ $('Telegram Trigger1').item.json.message.text }},\n  \"resultado\": {{ \"opcion \" +  $('Telegram Trigger1').item.json.message.text + \" del menu \" +$('verificar_sesi√≥n').item.json.pantalla_actual + \" ejecutada correctamente\"}}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4672,
        41344
      ],
      "id": "a5d5812d-0867-4196-a8f4-6d9d39578f1b",
      "name": "Edit To Log6"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "96CkwDJcwArTtA-CZJMvh",
          "mode": "list",
          "cachedResultUrl": "/workflow/96CkwDJcwArTtA-CZJMvh",
          "cachedResultName": "My Sub-Workflow 2"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        4896,
        41344
      ],
      "id": "48a4de16-eb59-41ad-b6dc-a6e0a65e23f5",
      "name": "Call 'My Sub-Workflow 2'6"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"timestamp\": {{$now}},\n  \"telegram_user\": {{ $json.telegram_user }},\n  \"pantalla\": {{ $json.pantalla_actual }},\n  \"opcion_elegida\": {{ $('Telegram Trigger1').item.json.message.text }},\n  \"resultado\": {{ \"opcion \" +  $('Telegram Trigger1').item.json.message.text + \" del menu \" +$('verificar_sesi√≥n').item.json.pantalla_actual + \" ejecutada correctamente\"}}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4672,
        53248
      ],
      "id": "33ec5f9d-f709-4296-a766-6cd0a012e387",
      "name": "Edit To Log7"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "96CkwDJcwArTtA-CZJMvh",
          "mode": "list",
          "cachedResultUrl": "/workflow/96CkwDJcwArTtA-CZJMvh",
          "cachedResultName": "My Sub-Workflow 2"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        4896,
        53248
      ],
      "id": "2b0603d9-cf23-494a-995b-887a06dd81d1",
      "name": "Call 'My Sub-Workflow 2'7"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=Al parecer no elegiste correctamente, elige las opciones del 1 al 3 unicamente para continuar con la agendaci√≥n de la cita.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4672,
        50752
      ],
      "id": "dec45b46-e3d5-4d70-bece-37c15e36dc76",
      "name": "Mensaje_elecci√≥n_incorrecta_editar",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "b017c2c5-0b9c-4443-8e51-5dd620bc6acc",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "03d3e139-dcff-4110-af25-5b9ff2019dc0",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "4",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "2090b930-34f1-4d89-a19a-87ff2ba65345",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "e7f67aa4-af4b-4fdc-9c9b-40e35ecae011",
              "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
              "rightValue": "5",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        4672,
        41728
      ],
      "id": "5ba3f73b-6313-4d5e-8ae4-f94f66c37dc9",
      "name": "IF NO MENU ARRIBA"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_REPORTES",
            "paso_actual": "0"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        40960
      ],
      "id": "de819a95-0b84-4d8e-a7cd-bc8cb566a8ab",
      "name": "Actualizar_estado (MENU_REPORTES)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "a14f07c5-0e52-4ee5-8b2c-a8715f59741a"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "02f4dc0b-f4e4-4947-840e-5e3d4eb9c54c",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "97e11887-89b8-4ad9-a2be-a28c05f9fd24",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"3\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4448,
        46416
      ],
      "id": "fc9ff1aa-3578-4d19-852b-d8a1e93a2446",
      "name": "Switch_menu_reportes"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        46528
      ],
      "id": "a2d765d3-154b-4f11-ba51-c2af9e822a93",
      "name": "Actualizar_estado_volver_reportes (MENU_PRINCIPAL)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2006573822,
          "mode": "list",
          "cachedResultName": "USUARIOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=2006573822"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4672,
        46336
      ],
      "id": "cef13e4a-9807-4d87-b20f-aba485d04321",
      "name": "Obtener_usuarios_general",
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "\nconst usuarios = $('Obtener_usuarios_general').all();\nconst citas = $('Obtener_citas_general').all();\n\nlet totalCitasGlobal = citas.length;\n\nlet totalInteraccionesGlobal = 0;\nlet usuarioMasActivo = { nombre: \"Nadie\", total: 0 };\n\nlet detalleUsuarios = [];\n\nfor (const itemUsuario of usuarios) {\n  const u = itemUsuario.json; \n  const idUser = u.telegram_user; \n  const misCitas = citas.filter(c => c.json.telegram_user == idUser).length;\n\n  const misInteracciones = misCitas; \n\n  totalInteraccionesGlobal += misInteracciones;\n\n  const actividadTotal = misCitas; \n  if (actividadTotal > usuarioMasActivo.total) {\n    usuarioMasActivo = { nombre: u.nombre, total: actividadTotal };\n  }\n\n  detalleUsuarios.push({\n    nombre: u.nombre,\n    citas: misCitas,\n    interacciones: misInteracciones\n  });\n}\n\nlet mensaje = `üìä *REPORTE DE PRODUCTIVIDAD*\\n\\n`;\n\n// Parte General\nmensaje += `üèÜ *Usuario M√°s Activo:* ${usuarioMasActivo.nombre} (${usuarioMasActivo.total} movimientoss)\\n`;\nmensaje += `üìÖ *Total Citas:* ${totalCitasGlobal}\\n`;\nmensaje += `üí¨ *Interacciones Totales:* ${totalInteraccionesGlobal}\\n`;\nmensaje += `----------------------------------\\n`;\nmensaje += `üë• *DETALLE POR USUARIO:*\\n`;\n\ndetalleUsuarios.forEach(d => {\n  mensaje += `üë§ *${d.nombre}*\\n`;\n  mensaje += `  üìÖ Citas: ${d.citas}\\n`;\n  mensaje += `  üí¨ Interacci√≥n: ${d.interacciones}\\n\\n`;\n});\n\nreturn [\n  {\n    json: {\n      reporte_texto: mensaje\n    }\n  }\n];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5120,
        46336
      ],
      "id": "f375c6b2-3f10-46b2-98fa-2f5302665702",
      "name": "Procesar_reporte_general"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger1\"].json[\"message\"][\"chat\"]['id'] }}",
        "text": "={{ $json[\"reporte_texto\"] }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5344,
        46336
      ],
      "id": "ac575244-b450-47fd-ac70-dbd63b13e76a",
      "name": "Mensaje_reporte_general",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4896,
        46336
      ],
      "id": "61844109-dc66-412c-88e8-3626d0fc24b3",
      "name": "Obtener_citas_general",
      "executeOnce": true,
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4880,
        46512
      ],
      "id": "ad0df017-a004-45bc-8875-e8833030f0dd",
      "name": "Menu Principal_vovler",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Opci√≥n no valida...",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4656,
        46688
      ],
      "id": "76a38f52-063a-4e6a-a789-25af38f30531",
      "name": "Opcion_no_valida_reportes",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"1\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "37557415-b3d2-4e80-85b4-53a37c9551d1"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "51290ae5-a4dc-45fc-aab4-d5b5ba0f877f",
                    "leftValue": "={{ $('Telegram Trigger1').item.json.message.text }}",
                    "rightValue": "={{ \"2\" }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        4432,
        46160
      ],
      "id": "5961d995-1852-41c1-9fcf-f59f517f84d1",
      "name": "Switch_CONFIRMACION_REPORTES"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "Opci√≥n no valida...",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4688,
        46352
      ],
      "id": "602755f0-3c6a-4e09-a6f3-50a94fa398bf",
      "name": "Opcion_no_valida_reportes1",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_REPORTES",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4752,
        46080
      ],
      "id": "0e56abf7-3a82-4ca9-b1ba-008fddaac125",
      "name": "Actualizar_estado_confirmacion_reportes (MENU_REPORTES)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog",
          "mode": "list",
          "cachedResultName": "Agenda_bot_sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1301766078,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1lbVT2-3mihfAwOVcJHO2MWlbExKG3T3PULHCbHlEFog/edit#gid=1301766078"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
            "pantalla_actual": "MENU_PRINCIPAL",
            "paso_actual": "0",
            "datos_parciales": "="
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5136,
        46480
      ],
      "id": "dc5f3104-9101-40f2-87cc-ab2f7c989efc",
      "name": "Actualizar_estado_confirmacion_reportes (MENU_PRINCIPAL)",
      "credentials": {
        "googleApi": {
          "id": "TKEaGzvwjswCudtp",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "¬øEn qu√© te puedo ayudar hoy? üòä\n\nMen√∫ principal:\n0. Ayuda\n\n1. Agenda (citas)\n\n2. Tareas\n\n3. Recordatorios\n\n4. H√°bitos\n\n5. Listas\n\n6. Reportes\n\n7. Configuraci√≥n\n\n8. Administrador\n\nüí° Sugerencia:\nSi quieres empezar r√°pido, te recomiendo la opci√≥n 1 (Agenda).",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5328,
        46512
      ],
      "id": "3497a4b0-8af2-4012-924b-8fccd8d2f762",
      "name": "Menu Principal_vovler1",
      "webhookId": "e85291c3-1b7e-48ad-8b3b-5569eb31d4c9",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "text": "=MENU_REPORTES \n\n1. Obtener reporte individual  \n2. Productividad por usuario (Reporte completo) \n3. Salir a menu principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        5008,
        40960
      ],
      "id": "b1b066ab-5870-4c79-a5ea-8afe822baa2c",
      "name": "Mensaje_MENU_ADMIN2",
      "webhookId": "53686d34-b4e3-4ec5-8047-9eba5a560364",
      "credentials": {
        "telegramApi": {
          "id": "TVMsqzTwYmmoWeFy",
          "name": "Telegram account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "verificar_usuario": {
      "main": [
        [
          {
            "node": "IF_usuario_existe",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger1": {
      "main": [
        [
          {
            "node": "verificar_usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verificar_sesi√≥n": {
      "main": [
        [
          {
            "node": "IF_sesion_iniciada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_usuario_existe": {
      "main": [
        [
          {
            "node": "verificar_sesi√≥n",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Crear Usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_sesion_iniciada": {
      "main": [
        [
          {
            "node": "Append_session",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "CEREBRO_PRINCIPAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append_session": {
      "main": [
        [
          {
            "node": "CEREBRO_PRINCIPAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CEREBRO_PRINCIPAL": {
      "main": [
        [
          {
            "node": "IF_ayuda",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_habitos",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_tarea",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_Listas",
            "type": "main",
            "index": 0
          },
          {
            "node": "CEREBRO_PRINCIPAL1",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [],
        [
          {
            "node": "IF_menu_ayuda_opcion_1",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_menu_ayuda_opcion_2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF_menu_tareas_opcion_1",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_menu_tareas_opcion_2",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_menu_tareas_opcion_3",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_menu_tareas_opcion_4",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_menu_tareas_opcion_no_valida",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF no cancelar crear tarea?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF_menu_habitos_opcion_1",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_menu_habitos_opcion_2",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_menu_habitos_opcion_3",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_menu_habitos_opcion_4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update row Marcar Tarea Completada",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Bienvenida",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s) in sheet2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF no cancelar crear habito?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF_menu_listas_opcion_1",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_menu_listas_opcion_2",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_menu_listas_opcion_3",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF_menu_listas_opcion_4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF no cancelar crear lista?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Lista por ID",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF no cancelar crear lista?1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "CEREBRO_PRINCIPAL1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_ayuda": {
      "main": [
        [
          {
            "node": "Men√∫ Ayuda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_tarea": {
      "main": [
        [
          {
            "node": "Men√∫ Tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_habitos": {
      "main": [
        [
          {
            "node": "Men√∫ Habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_ayuda_opcion_1": {
      "main": [
        [
          {
            "node": "Menu Principal_",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_ayuda_opcion_2": {
      "main": [
        [
          {
            "node": "Mensaje de Salida",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Ayuda": {
      "main": [
        [
          {
            "node": "Update State MENU_AYUDA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menu Principal_": {
      "main": [
        [
          {
            "node": "Update State MENU_PRINCIPAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje de Salida": {
      "main": [
        [
          {
            "node": "Update State BIENVENIDA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Tareas": {
      "main": [
        [
          {
            "node": "Update State MENU_TAREAS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_tareas_opcion_1": {
      "main": [
        [
          {
            "node": "Crear Tarea Paso 1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Tarea Paso 1": {
      "main": [
        [
          {
            "node": "Update State CREAR TAREA - PASO 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Tareas": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES TITULO",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha Formato Valido?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Confirmar tarea?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Tarea Paso 2": {
      "main": [
        [
          {
            "node": "Update State CREAR HABITO- PASO 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Tarea Paso 3": {
      "main": [
        [
          {
            "node": "Update State CREAR TAREA - PASO 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update DATOS PARCIALES TITULO": {
      "main": [
        [
          {
            "node": "Crear Tarea Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "PARSE AND ADD PRIORIDAD ALTA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "PARSE AND ADD PRIORIDAD MEDIA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "PARSE AND ADD PRIORIDAD BAJA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "TEXTO CANCELACION TAREA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PARSE AND ADD PRIORIDAD ALTA": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES PRIORIDAD",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PARSE AND ADD PRIORIDAD MEDIA": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES PRIORIDAD",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PARSE AND ADD PRIORIDAD BAJA": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES PRIORIDAD",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Tareas1": {
      "main": [
        [
          {
            "node": "Update State MENU_TAREAS1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TEXTO CANCELACION TAREA": {
      "main": [
        [
          {
            "node": "Men√∫ Tareas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Habitos": {
      "main": [
        [
          {
            "node": "Update State MENU_HABITOS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fecha Formato Valido?": {
      "main": [
        [
          {
            "node": "Fecha Futura?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha Invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fecha Futura?": {
      "main": [
        [
          {
            "node": "PARSE AND ADD FECHA OBJETIVO",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha en el pasado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PARSE AND ADD FECHA OBJETIVO": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES E1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update DATOS PARCIALES E1": {
      "main": [
        [
          {
            "node": "Crear Tarea PASO 3 Confirmaci√≥n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update DATOS PARCIALES PRIORIDAD": {
      "main": [
        [
          {
            "node": "Crear Tarea Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Tarea PASO 3 Confirmaci√≥n": {
      "main": [
        [
          {
            "node": "Update State CREAR TAREA - PASO 4  ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Confirmar tarea?": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado Creaci√≥n Tarea Texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Crypto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crypto": {
      "main": [
        [
          {
            "node": "Append TAREA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append TAREA": {
      "main": [
        [
          {
            "node": "Tarea Guardada Correctamente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_tareas_opcion_2": {
      "main": [
        [
          {
            "node": "Get row(s) Traer Tareas",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Men√∫ Tareas5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mostrar Tarea Mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mostrar Tarea Mensaje": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado Creaci√≥n Tarea Texto": {
      "main": [
        [
          {
            "node": "Men√∫ Tareas2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Tareas2": {
      "main": [
        [
          {
            "node": "Update State MENU_TAREAS2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado Creaci√≥n Tarea Texto1": {
      "main": [
        [
          {
            "node": "Men√∫ Tareas4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Tareas4": {
      "main": [
        [
          {
            "node": "Update State MENU_TAREAS4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menu Principal_1": {
      "main": [
        [
          {
            "node": "Update State MENU_PRINCIPAL1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_tareas_opcion_4": {
      "main": [
        [
          {
            "node": "Menu Principal_1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Pedir ID Tarea para completar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mostrar Tarea Mensaje1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mostrar Tarea Mensaje1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_tareas_opcion_3": {
      "main": [
        [
          {
            "node": "Get row(s) Traer Tareas No Completadas2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pedir ID Tarea para completar": {
      "main": [
        [
          {
            "node": "Update State COMPLETAR TAREA - PASO 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Tareas5": {
      "main": [
        [
          {
            "node": "Update State MENU_TAREAS5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row Marcar Tarea Completada": {
      "main": [
        [
          {
            "node": "Se actualizo correcto?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Se actualizo correcto?": {
      "main": [
        [
          {
            "node": "TAREA ACTUALIZADA TEXTO",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "VOLVIENDO MENU TAREAS TEXTO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Tareas6": {
      "main": [
        [
          {
            "node": "Update State MENU_TAREAS6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VOLVIENDO MENU TAREAS TEXTO": {
      "main": [
        [
          {
            "node": "Men√∫ Tareas6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Usuario": {
      "main": [
        [
          {
            "node": "IF_sesion_iniciada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Bienvenida": {
      "main": [
        [
          {
            "node": "Update State MENU_PRINCIPAL2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TAREA ACTUALIZADA TEXTO": {
      "main": [
        [
          {
            "node": "Men√∫ Tareas6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_tareas_opcion_no_valida": {
      "main": [
        [
          {
            "node": "Opci√≥n No Valida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Opci√≥n No Valida": {
      "main": [
        [
          {
            "node": "Men√∫ Tareas7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_habitos_opcion_1": {
      "main": [
        [
          {
            "node": "CREAR HABITO PASO 1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CREAR HABITO PASO 1": {
      "main": [
        [
          {
            "node": "Update State CREAR HABITO - PASO 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF no cancelar crear tarea?": {
      "main": [
        [
          {
            "node": "Pasos Tareas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado Creaci√≥n Tarea Texto1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF no cancelar crear habito?": {
      "main": [
        [
          {
            "node": "Pasos Habitos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado Creaci√≥n Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado Creaci√≥n Habito": {
      "main": [
        [
          {
            "node": "Men√∫ Habitos1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Habitos1": {
      "main": [
        [
          {
            "node": "Update State MENU_HABITOS1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Habitos": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha Formato Valido?1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s) in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update DATOS PARCIALES Nombre HABITO": {
      "main": [
        [
          {
            "node": "Crear Habito Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "PARSE AND ADD PRIORIDAD ALTA1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "PARSE AND ADD PRIORIDAD MEDIA1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "PARSE AND ADD PRIORIDAD BAJA1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PARSE AND ADD PRIORIDAD ALTA1": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES FRECUENCIA Crear Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PARSE AND ADD PRIORIDAD MEDIA1": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES FRECUENCIA Crear Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PARSE AND ADD PRIORIDAD BAJA1": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES FRECUENCIA Crear Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_habitos_opcion_2": {
      "main": [
        [
          {
            "node": "Get row(s) Traer Habitos",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update DATOS PARCIALES FRECUENCIA Crear Habito": {
      "main": [
        [
          {
            "node": "Crear Habito Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Habito Paso 3": {
      "main": [
        [
          {
            "node": "Update State CREAR HABITO - PASO 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Habito Paso 2": {
      "main": [
        [
          {
            "node": "Update State CREAR HABITO - PASO 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fecha Formato Valido?1": {
      "main": [
        [
          {
            "node": "PARSE AND ADD Hora Recordatorio Habito",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha Invalida1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PARSE AND ADD Hora Recordatorio Habito": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES HORA Crear Habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update DATOS PARCIALES HORA Crear Habito": {
      "main": [
        [
          {
            "node": "Crear Habito PASO 3 Confirmaci√≥n1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Habito PASO 3 Confirmaci√≥n1": {
      "main": [
        [
          {
            "node": "Update State CREAR TAREA - PASO 4  1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Habitos2": {
      "main": [
        [
          {
            "node": "Update State MENU_HABITOS2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet3": {
      "main": [
        [
          {
            "node": "Crypto1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crypto1": {
      "main": [
        [
          {
            "node": "Append HABITO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append HABITO": {
      "main": [
        [
          {
            "node": "Habito Guardado Correctamente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habito Guardado Correctamente": {
      "main": [
        [
          {
            "node": "Men√∫ Habitos2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menu Principal_2": {
      "main": [
        [
          {
            "node": "Update State MENU_PRINCIPAL3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_habitos_opcion_4": {
      "main": [
        [
          {
            "node": "Menu Principal_2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) Traer Tareas": {
      "main": [
        [
          {
            "node": "HAY TAREAS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) Traer Tareas No Completadas2": {
      "main": [
        [
          {
            "node": "HAY TAREAS1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [
          {
            "node": "Men√∫ Habitos3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mostrar Habitos Mensaje2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) Traer Habitos": {
      "main": [
        [
          {
            "node": "IF TIENE HABITOS?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Habitos3": {
      "main": [
        [
          {
            "node": "Update State MENU_HABITOS3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items3": {
      "main": [
        [
          {
            "node": "Pedir ID Habito para Toogle",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mostrar Tarea Mensaje3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mostrar Tarea Mensaje3": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_habitos_opcion_3": {
      "main": [
        [
          {
            "node": "Get row(s) Traer Habitos1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) Traer Habitos1": {
      "main": [
        [
          {
            "node": "IF TIENE HABITOS?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pedir ID Habito para Toogle": {
      "main": [
        [
          {
            "node": "Update State COMPLETAR TAREA - PASO ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Se actualizo correcto?1": {
      "main": [
        [
          {
            "node": "HABITO ACTUALIZADA TEXTO1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "VOLVIENDO MENU TAREAS TEXTO1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VOLVIENDO MENU TAREAS TEXTO1": {
      "main": [
        [
          {
            "node": "Men√∫ Habitos4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet2": {
      "main": [
        [
          {
            "node": "Update row Marcar Habito Activado / Desactivado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row Marcar Habito Activado / Desactivado": {
      "main": [
        [
          {
            "node": "Se actualizo correcto?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HABITO ACTUALIZADA TEXTO1": {
      "main": [
        [
          {
            "node": "Men√∫ Habitos4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Habitos4": {
      "main": [
        [
          {
            "node": "Update State MENU_HABITOS4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES Nombre HABITO",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Invalido NOMBRE HABITO VACIO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF TIENE HABITOS?": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "NO TIENE HABITOS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF TIENE HABITOS?1": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "NO TIENE HABITOS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Habitos5": {
      "main": [
        [
          {
            "node": "Update State MENU_HABITOS5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NO TIENE HABITOS": {
      "main": [
        [
          {
            "node": "Men√∫ Habitos5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_Listas": {
      "main": [
        [
          {
            "node": "Men√∫ Listas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Listas": {
      "main": [
        [
          {
            "node": "Update State MENU_LISTAS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_listas_opcion_1": {
      "main": [
        [
          {
            "node": "Crear Lista Paso 1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Lista Paso 1": {
      "main": [
        [
          {
            "node": "Update State CREAR LISTAS - PASO 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF no cancelar crear lista?": {
      "main": [
        [
          {
            "node": "Pasos Listas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado Creaci√≥n Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update DATOS PARCIALES NOMBRE LISTA": {
      "main": [
        [
          {
            "node": "Crear LISTA Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear LISTA Paso 2": {
      "main": [
        [
          {
            "node": "Update State CREAR LISTA- PASO 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet4": {
      "main": [
        [
          {
            "node": "Crypto2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crypto2": {
      "main": [
        [
          {
            "node": "Append LISTA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Habito Guardado Correctamente1": {
      "main": [
        [
          {
            "node": "Men√∫ Listas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append LISTA": {
      "main": [
        [
          {
            "node": "Habito Guardado Correctamente1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Listas1": {
      "main": [
        [
          {
            "node": "Update State MENU_LISTAS1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasos Listas": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES NOMBRE LISTA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s) in sheet4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Listas2": {
      "main": [
        [
          {
            "node": "Update State MENU_LISTAS2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items4": {
      "main": [
        [
          {
            "node": "Men√∫ Listas3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mostrar Listas Mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_listas_opcion_2": {
      "main": [
        [
          {
            "node": "Get row(s) Traer Listas",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) Traer Listas": {
      "main": [
        [
          {
            "node": "IF THERES LISTAS?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_listas_opcion_4": {
      "main": [
        [
          {
            "node": "Menu Principal_3",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Listas3": {
      "main": [
        [
          {
            "node": "Update State MENU_LISTAS3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) Traer Listas1": {
      "main": [
        [
          {
            "node": "IF THERES LISTAS?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_menu_listas_opcion_3": {
      "main": [
        [
          {
            "node": "Get row(s) Traer Listas1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NO TIENE LISTAS": {
      "main": [
        [
          {
            "node": "Men√∫ Listas5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Listas5": {
      "main": [
        [
          {
            "node": "Update State MENU_LISTAS5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF THERES LISTAS?": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "NO TIENE LISTAS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items5": {
      "main": [
        [
          {
            "node": "Pedir ID Lista para A√±adir Item",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mostrar Lista Mensaje5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF THERES LISTAS?1": {
      "main": [
        [
          {
            "node": "Loop Over Items5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "NO TIENE LISTAS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mostrar Lista Mensaje5": {
      "main": [
        [
          {
            "node": "Loop Over Items5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HAY TAREAS": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "NO TIENE TAREAS SIN COMPLETAR1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HAY TAREAS1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "NO TIENE TAREAS SIN COMPLETAR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Tareas8": {
      "main": [
        [
          {
            "node": "Update State MENU_TAREAS7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NO TIENE TAREAS SIN COMPLETAR1": {
      "main": [
        [
          {
            "node": "Men√∫ Tareas8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NO TIENE TAREAS SIN COMPLETAR": {
      "main": [
        [
          {
            "node": "Men√∫ Tareas8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pedir ID Lista para A√±adir Item": {
      "main": [
        [
          {
            "node": "Update State COMPLETAR TAREA - PASO 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Lista por ID": {
      "main": [
        [
          {
            "node": "Existe la lista y es del user?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AGREGAR ITEM A LISTA PASO 1": {
      "main": [
        [
          {
            "node": "Update State AGREGAR ITEM A LISTA - PASO ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Existe la lista y es del user?": {
      "main": [
        [
          {
            "node": "AGREGAR ITEM A LISTA PASO 1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "VOLVIENDO MENU LISTA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Listas4": {
      "main": [
        [
          {
            "node": "Update State MENU_LISTAS4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VOLVIENDO MENU LISTA": {
      "main": [
        [
          {
            "node": "Men√∫ Listas4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF no cancelar crear lista?1": {
      "main": [
        [
          {
            "node": "IF seguir a√±adiendo √≠tems",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancelado Adici√≥n de √çtems",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update State AGREGAR ITEM A LISTA - PASO ": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES LISTA ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF seguir a√±adiendo √≠tems": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Parse Datos Parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado Creaci√≥n Lista": {
      "main": [
        [
          {
            "node": "Men√∫ Listas2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Listas6": {
      "main": [
        [
          {
            "node": "Update State MENU_LISTAS6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelado Adici√≥n de √çtems": {
      "main": [
        [
          {
            "node": "Men√∫ Listas6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Update DATOS PARCIALES LISTA ID1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Datos Parciales": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Loop Over Items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items6": {
      "main": [
        [
          {
            "node": "Confirmaci√≥n √çtems Puestos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Crypto3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append ITEM_LISTA": {
      "main": [
        [
          {
            "node": "Loop Over Items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crypto3": {
      "main": [
        [
          {
            "node": "Append ITEM_LISTA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mostrar Habitos Mensaje2": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "not empty?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mostrar Listas √çtem Mensaje1": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mostrar Listas Mensaje": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Men√∫ Listas7": {
      "main": [
        [
          {
            "node": "Update State MENU_LISTAS7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Confirmaci√≥n √çtems Puestos": {
      "main": [
        [
          {
            "node": "Men√∫ Listas7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menu Principal_3": {
      "main": [
        [
          {
            "node": "Update State MENU_PRINCIPAL4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "not empty?": {
      "main": [
        [
          {
            "node": "Mostrar Listas √çtem Mensaje1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit To Log": {
      "main": [
        [
          {
            "node": "Call 'My Sub-Workflow 2'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit To Log1": {
      "main": [
        [
          {
            "node": "Call 'My Sub-Workflow 2'1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit To Log2": {
      "main": [
        [
          {
            "node": "Call 'My Sub-Workflow 2'2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit To Log3": {
      "main": [
        [
          {
            "node": "Call 'My Sub-Workflow 2'3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_1": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar_agendamiento": {
      "main": [
        [
          {
            "node": "Cancelar_agendamiento_message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_2": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_3": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_4": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Monitor_edici√≥n": {
      "main": [
        [
          {
            "node": "If_validar_formato_fecha",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If_validar_formato_hora",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_tipo_canal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_5 (presencial)": {
      "main": [
        [
          {
            "node": "field_presencial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_5 (virtual)": {
      "main": [
        [
          {
            "node": "field_virtual",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_5 (llamada)": {
      "main": [
        [
          {
            "node": "field_llamada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_cancelar_agendamiento": {
      "main": [
        [
          {
            "node": "Cancelar_agendamiento",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Monitor_edici√≥n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_presencial": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_virtual": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_llamada": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append_cita": {
      "main": [
        [
          {
            "node": "Actualizar_estado (CONFIRMACION_CITA)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_agendar_cita": {
      "main": [
        [
          {
            "node": "Actualizar_estado (MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Bienvenida1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_CITAS)": {
      "main": [
        [
          {
            "node": "Men√∫ Agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_MENU_CITAS": {
      "main": [
        [
          {
            "node": "Actualizar_estado (AGENDAR)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_citas",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_citas1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_citas2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_citas3",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (MENU_PRINCIPAL) /SWITCH MENU_CITAS",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opci√≥n_no_valida (MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (AGENDAR)": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso inicial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_PRINCIPAL) /SWITCH MENU_CITAS": {
      "main": [
        [
          {
            "node": "mensaje_regreso_MENU_CITAS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar_agendamiento_message": {
      "main": [
        [
          {
            "node": "Menu Principal3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_tipo_canal": {
      "main": [
        [
          {
            "node": "Agendar_paso_5 (presencial)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_5 (virtual)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_5 (llamada)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_edicion_creaci√≥n": {
      "main": [
        [
          {
            "node": "Append_cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (MENU_EDITAR)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_CONFIRMACION_CITA": {
      "main": [
        [
          {
            "node": "Actualizar_estado (volver MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (volver MENU_PRINCIPAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (volver MENU_CITAS)": {
      "main": [
        [
          {
            "node": "Mostrar_Menu_agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (volver MENU_PRINCIPAL)": {
      "main": [
        [
          {
            "node": "Mostrar_menu_principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (CONFIRMACION_CITA)": {
      "main": [
        [
          {
            "node": "Mensaje_registro_exitoso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_edici√≥n_cita": {
      "main": [
        [
          {
            "node": "Actualizar_estado (EDITAR_NOMBRE)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (EDITAR FECHA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (EDITAR_HORA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (EDITAR_MOTIVO)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (EDITAR_CANAL)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (VALIDACION)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opci√≥n_no_valida (MENU_EDITAR)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (EDITAR FECHA)": {
      "main": [
        [
          {
            "node": "Mensaje_nueva_fecha",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (EDITAR_NOMBRE)": {
      "main": [
        [
          {
            "node": "Mensaje_nuevo_nombre",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (EDITAR_HORA)": {
      "main": [
        [
          {
            "node": "Mensaje_nueva_hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (fecha)": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_FECHA)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_EDITAR)": {
      "main": [
        [
          {
            "node": "Mensaje_edicion_cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (nombre)": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_NOMBRE)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (motivo)": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_MOTIVO)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (hora)": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_HORA)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_5 (virtual)1": {
      "main": [
        [
          {
            "node": "field_virtual1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_presencial1": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_CANAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_virtual1": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_CANAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_paso_5 (llamada)1": {
      "main": [
        [
          {
            "node": "field_llamada1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "field_llamada1": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar (EDITAR_CANAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_editar_tipo_canal": {
      "main": [
        [
          {
            "node": "Actualizar_campo (motivo)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_5 (virtual)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_5 (llamada)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_elecci√≥n_incorrecta_editar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (motivo)1": {
      "main": [
        [
          {
            "node": "field_presencial1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (EDITAR_CANAL)": {
      "main": [
        [
          {
            "node": "Mensaje_nuevo_canal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (EDITAR_MOTIVO)": {
      "main": [
        [
          {
            "node": "Mensaje_nuevo_motivo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (VALIDACION)": {
      "main": [
        [
          {
            "node": "Mensaje_cancelaci√≥n_edici√≥n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_cancelaci√≥n_edici√≥n": {
      "main": [
        [
          {
            "node": "Agendar Cita Paso 6 Confirmar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas": {
      "main": [
        [
          {
            "node": "IF_revisar_citas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas1": {
      "main": [
        [
          {
            "node": "IF_revisar_citas_reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_revisar_citas1": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_sin_citas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_revisar_citas_reprogramar": {
      "main": [
        [
          {
            "node": "Obtener_formater_citas (REPROGRAMAR_CITA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_sin_citas_reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (REPROGRAMAR_FECHA)": {
      "main": [
        [
          {
            "node": "Mensaje_reprogramar_citas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (REPROGRAMAR_HORA)": {
      "main": [
        [
          {
            "node": "Mensaje_reprogramar_hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reprogramar_cita": {
      "main": [
        [
          {
            "node": "Actualizar_estado-reprogramar (volver MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado-reprogramar (volver MENU_CITAS)": {
      "main": [
        [
          {
            "node": "Mensaje_reprogramar_cita_resultado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_formater_citas (REPROGRAMAR_CITA)": {
      "main": [
        [
          {
            "node": "Actualizar_estado (REPROGRAMAR_ESPERAR_ID)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (REPROGRAMAR_ESPERAR_ID)": {
      "main": [
        [
          {
            "node": "Mensaje_solicitar_cita_id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas2": {
      "main": [
        [
          {
            "node": "IF_revisar_citas_cancelar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_revisar_citas_cancelar": {
      "main": [
        [
          {
            "node": "Obtener_cancelar_citas (CANCELAR_CITA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_sin_citas_cancelar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_cancelar_citas (CANCELAR_CITA)": {
      "main": [
        [
          {
            "node": "Actualizar_estado (CANCELAR_ESPERAR_ID)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (CANCELAR_ESPERAR_ID)": {
      "main": [
        [
          {
            "node": "Mensaje_solicitar_cita_id_cancelar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (CANCELAR)": {
      "main": [
        [
          {
            "node": "Actualizar_estado_cancelar (MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_cancelar (MENU_CITAS)": {
      "main": [
        [
          {
            "node": "Mensaje_cancelar_cita_resultado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas3": {
      "main": [
        [
          {
            "node": "IF_revisar_citas_completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_revisar_citas_completar": {
      "main": [
        [
          {
            "node": "Obtener_completar_citas (CCOMPLETAR_CITA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_sin_citas_completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_completar_citas (CCOMPLETAR_CITA)": {
      "main": [
        [
          {
            "node": "Actualizar_estado (COMPLETAR_ESPERAR_ID)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (COMPLETAR_ESPERAR_ID)": {
      "main": [
        [
          {
            "node": "Mensaje_solicitar_cita_id_completar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_campo (COMPLETAR)": {
      "main": [
        [
          {
            "node": "Actualizar_estado_completar (MENU_CITAS)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_completar (MENU_CITAS)": {
      "main": [
        [
          {
            "node": "Mensaje_completar_cita_resultado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_menu_principal": {
      "main": [
        [
          {
            "node": "IF_agendar_cita",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (MENU_RECORDATORIOS)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit To Log6",
            "type": "main",
            "index": 0
          },
          {
            "node": "Actualizar_estado (MENU_REPORTES)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (MENU_CONFIGURACION)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_usuario",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF NO MENU ARRIBA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_CONFIGURACION)": {
      "main": [
        [
          {
            "node": "Mensaje_menu_configuracion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_menu_configuracion": {
      "main": [
        [
          {
            "node": "Mensaje_user_info",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_reinicio (MENU_PRINCIPAL)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_regreso (MENU_PRINCIPAL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_reinicio (MENU_PRINCIPAL)": {
      "main": [
        [
          {
            "node": "Mensaje_user_reinicio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_user_reinicio": {
      "main": [
        [
          {
            "node": "Mensaje_user_menu_principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_es_ADMIN?": {
      "main": [
        [
          {
            "node": "Actualizar_estado (MENU_ADMIN)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_denegacion_permiso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_usuario": {
      "main": [
        [
          {
            "node": "If_es_ADMIN?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_ADMIN)": {
      "main": [
        [
          {
            "node": "Mensaje_MENU_ADMIN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_ADMIN": {
      "main": [
        [
          {
            "node": "Obtener_citas_global",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_sesiones_global_estadisticas",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (ADMIN_BROADCAST)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_cancelaci√≥n (MENU_PRINCIPAL)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas_global": {
      "main": [
        [
          {
            "node": "IF_revisar_citas_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_revisar_citas_global": {
      "main": [
        [
          {
            "node": "Obtener_citas (global)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mensaje_sin citas_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas (global)": {
      "main": [
        [
          {
            "node": "Mensaje_citas_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas_global_estadisticas": {
      "main": [
        [
          {
            "node": "Formatear_campos_estadisticas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_sesiones_global_estadisticas": {
      "main": [
        [
          {
            "node": "Obtener_citas_global_estadisticas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatear_campos_estadisticas": {
      "main": [
        [
          {
            "node": "Mensaje_sin citas_global1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (ADMIN_BROADCAST)": {
      "main": [
        [
          {
            "node": "Mensaje_solicitar_broadcast_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (ADMIN_BROADCAST_CONFIRMAR)": {
      "main": [
        [
          {
            "node": "Mensaje_previo_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_confirmar_mensaje_global": {
      "main": [
        [
          {
            "node": "Obtener_sesiones_mensaje_global",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)": {
      "main": [
        [
          {
            "node": "Mensaje_cancelaci√≥n_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_sesiones_mensaje_global": {
      "main": [
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "Mensaje_envio_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_exitoso (MENU_ADMIN)": {
      "main": [
        [
          {
            "node": "Mensaje_MENU_ADMIN1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_envio_global": {
      "main": [
        [
          {
            "node": "Actualizar_estado_exitoso (MENU_ADMIN)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_cancelaci√≥n (MENU_PRINCIPAL)": {
      "main": [
        [
          {
            "node": "Mensaje_salir_admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_salir_admin": {
      "main": [
        [
          {
            "node": "Menu Principal1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas_verificacion_dovle_reserva": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_citas_repetidas_fecha": {
      "main": [
        [
          {
            "node": "Error Doble Reserva",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agendar_paso_2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_fecha": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha Invalida2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_hora": {
      "main": [
        [
          {
            "node": "Obtener_citas_verificacion_dovle_reserva",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Hora Invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_fecha_reprogramar1": {
      "main": [
        [
          {
            "node": "Actualizar_estado (REPROGRAMAR_HORA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha en el pasado_reprogramar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_fecha_reprogramar1": {
      "main": [
        [
          {
            "node": "If_validar_fecha_reprogramar1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha Invalida_reprogramar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_hora_reprogramar": {
      "main": [
        [
          {
            "node": "Reprogramar_cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Hora Invalida_reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_hora_actualizar": {
      "main": [
        [
          {
            "node": "Actualizar_campo (hora)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Hora Invalida_actualizar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_validar_formato_fecha_reprogramar": {
      "main": [
        [
          {
            "node": "If_fecha_v√°lida_reprogramar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha Invalida_reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If_fecha_v√°lida_reprogramar": {
      "main": [
        [
          {
            "node": "Actualizar_campo (fecha)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha en el pasado_reprogramar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_RECORDATORIOS)": {
      "main": [
        [
          {
            "node": "Mensaje_Menue_recordatorios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_menu_recordatorios": {
      "main": [
        [
          {
            "node": "Actualizar_estado (REC_CAMBIAR_TIEMPO)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cambiar_aviso",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_recordatorios (MENU_PRINCIPAL)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit To Log5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (REC_CAMBIAR_TIEMPO)": {
      "main": [
        [
          {
            "node": "Mensaje_submenu_recordatorio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cambiar_preferencia (30 min)": {
      "main": [
        [
          {
            "node": "Mensaje_preferencia_cambiada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)1": {
      "main": [
        [
          {
            "node": "Mensaje_Menu_recordatorios_volver",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_preferencia_recordatorios": {
      "main": [
        [
          {
            "node": "Cambiar_preferencia (30 min)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cambiar_preferencia (1h)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cambiar_preferencia (1D)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cambiar_preferencia (1h)": {
      "main": [
        [
          {
            "node": "Mensaje_preferencia_cambiada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cambiar_preferencia (1D)": {
      "main": [
        [
          {
            "node": "Mensaje_preferencia_cambiada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)3": {
      "main": [
        [
          {
            "node": "Mensaje_preferencia_cambiada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_preferencia_cambiada": {
      "main": [
        [
          {
            "node": "Actualizar_estado_cancelaci√≥n (MENU_ADMIN)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cambiar_aviso": {
      "main": [
        [
          {
            "node": "Mensaje_cambiar_aviso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_cambiar_aviso": {
      "main": [
        [
          {
            "node": "Mensaje_Menu_recordatorios_aviso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_recordatorios (MENU_PRINCIPAL)": {
      "main": [
        [
          {
            "node": "Mensaje_volver_recordatorio_menu_principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas_reportes": {
      "main": [
        [
          {
            "node": "Procesar_reporte",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Procesar_reporte": {
      "main": [
        [
          {
            "node": "Mensaje_reporte",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_reporte": {
      "main": [
        []
      ]
    },
    "Actualizar_estado_regreso (MENU_PRINCIPAL)": {
      "main": [
        [
          {
            "node": "Menu Principal_regreso",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CEREBRO_PRINCIPAL1": {
      "main": [
        [
          {
            "node": "Switch_menu_principal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF_cancelar_agendamiento",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "Switch_MENU_CITAS",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_CONFIRMACION_CITA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_edici√≥n_cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If_validar_formato_fecha_reprogramar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_campo (nombre)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If_validar_formato_hora_actualizar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_campo (motivo)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_editar_tipo_canal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (REPROGRAMAR_FECHA)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If_validar_formato_fecha_reprogramar1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If_validar_formato_hora_reprogramar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_campo (CANCELAR)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_campo (COMPLETAR)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_menu_configuracion",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_ADMIN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado (ADMIN_BROADCAST_CONFIRMAR)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_confirmar_mensaje_global",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_menu_recordatorios",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_preferencia_recordatorios",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_menu_reportes",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_CONFIRMACION_REPORTES",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch_edicion_creaci√≥n",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opci√≥n No Valida1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Bienvenida1": {
      "main": [
        [
          {
            "node": "Menu Principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Mensaje_citas_resultado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "If_citas_repetidas_fecha",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Agendar_paso_1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fecha en el pasado1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit To Log4": {
      "main": [
        [
          {
            "node": "Call 'My Sub-Workflow 2'4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit To Log5": {
      "main": [
        [
          {
            "node": "Call 'My Sub-Workflow 2'5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit To Log6": {
      "main": [
        [
          {
            "node": "Call 'My Sub-Workflow 2'6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit To Log7": {
      "main": [
        [
          {
            "node": "Call 'My Sub-Workflow 2'7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tarea Guardada Correctamente": {
      "main": [
        [
          {
            "node": "Men√∫ Tareas2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF NO MENU ARRIBA": {
      "main": [
        [
          {
            "node": "Menu Principal2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado (MENU_REPORTES)": {
      "main": [
        [
          {
            "node": "Mensaje_MENU_ADMIN2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch_menu_reportes": {
      "main": [
        [
          {
            "node": "Obtener_citas_reportes",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener_usuarios_general",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_volver_reportes (MENU_PRINCIPAL)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opcion_no_valida_reportes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_usuarios_general": {
      "main": [
        [
          {
            "node": "Obtener_citas_general",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Procesar_reporte_general": {
      "main": [
        [
          {
            "node": "Mensaje_reporte_general",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener_citas_general": {
      "main": [
        [
          {
            "node": "Procesar_reporte_general",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_volver_reportes (MENU_PRINCIPAL)": {
      "main": [
        [
          {
            "node": "Menu Principal_vovler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje_reporte_general": {
      "main": [
        []
      ]
    },
    "Switch_CONFIRMACION_REPORTES": {
      "main": [
        [
          {
            "node": "Actualizar_estado_confirmacion_reportes (MENU_REPORTES)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualizar_estado_confirmacion_reportes (MENU_PRINCIPAL)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Opcion_no_valida_reportes1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar_estado_confirmacion_reportes (MENU_REPORTES)": {
      "main": [
        []
      ]
    },
    "Actualizar_estado_confirmacion_reportes (MENU_PRINCIPAL)": {
      "main": [
        [
          {
            "node": "Menu Principal_vovler1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "saveExecutionProgress": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "dc8565cd-cb87-4769-9df7-13e67f1870ae",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "7b56dd22bd053bc629e254ec8c77f19d833607fb1c944cdd1420064c01ed41d8"
  },
  "id": "QPCZxDci7on7HlWRodzFF",
  "tags": []
}